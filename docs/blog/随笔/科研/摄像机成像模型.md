# 摄像机几何与成像原理

## 摄像机是如何成像的？

<img src="https://cdn.jsdelivr.net/gh/Gongzihang6/Pictures@main/Medias/medias%2F2025%2F09%2Fimage-20250926185449586.png" alt="将胶片直接放置在物体前方" style="zoom:80%;" />

试想一下直接将胶片放置在物体前方？

我们可以把成像胶片直接放置到物体前方，物体表面的点向四周反射太阳光，并打到胶片上，但是这样存在的问题是胶片上的每一个点，都会收到物体表面上每一个点发来的光，导致在胶片上重合，出现成像模糊；

既然物体表面上的一个点，会反射出很多束光，都打到胶片上，物体表面多个点，都会打到胶片上的同一个位置，从而导致模糊，所以我们想到可以在物体和胶片中间添加一个屏障，来遮挡多余的光束，例如在物体和胶片中间增加一个带有小针孔的隔板，这样能够打到胶片上同一点上的光束就变少了（取决于针孔的直径），所以针孔直径越小，胶片上的成像也就越清晰，这就是小孔成像的基本原理。

<img src="https://cdn.jsdelivr.net/gh/Gongzihang6/Pictures@main/Medias/medias%2F2025%2F09%2Fimage-20250926190514183.png" alt="添加屏障减少模糊" style="zoom:80%;" />

针孔摄像机成像原理如下图所示：

![针孔摄像机成像原理](https://cdn.jsdelivr.net/gh/Gongzihang6/Pictures@main/Medias/medias%2F2025%2F09%2Fimage-20250926191148784.png)

针孔摄像机成像的数学原理如下：

![数学原理](https://cdn.jsdelivr.net/gh/Gongzihang6/Pictures@main/Medias/medias%2F2025%2F09%2Fimage-20250926191332507.png)

摄像机坐标系的原点 $O$ 可以理解为成像的小孔，针孔摄像机成像成的是倒像，但成像和原始物体相似，成比例；以摄像机小孔为原点，右侧为 x 轴，向上为 y 轴，垂直向前为 z 轴，得到摄像机坐标系。在 kOj 平面也就是 yOz 平面中的一点 P 坐标为 $(y,z)$，投影到摄像机的相平面上的坐标为 $(y’,f)$，$f$ 为相机的焦距，可以看作一个固定值，根据相似三角形，
$$
\frac{y'}{f} = \frac{y}{z} \quad \Rightarrow \quad y' = f \frac{y}{z}
$$
这里没有考虑正负，只考虑了绝对值，相应的，焦距 $f=z\frac{y’}{y}$，其中 z 为物体上一点 P 到小孔平面的距离

同样的，在 iOk 平面也就是 xOz 平面上的点 P 坐标为 $(x,z)$，投影到摄像机的相平面上的坐标为 $(x’,f)$，根据相似三角形，
$$
\frac{x'}{f} = \frac{x}{z} \quad \Rightarrow \quad x' = f \frac{x}{z}
$$
所以三维世界中的一个点 P(x, y, z)就通过针孔摄像机投影到了二维的相平面上，相平面上对应点 P’坐标为(x’, y’)
$$
P = \begin{bmatrix} x \\ y \\ z \end{bmatrix} \rightarrow P' = \begin{bmatrix} x' \\ y' \end{bmatrix}

\qquad
\text{其中}
\begin{cases}
x' = f \frac{x}{z} \\
y' = f \frac{y}{z}
\end{cases}
$$
![光圈大小与成像](https://cdn.jsdelivr.net/gh/Gongzihang6/Pictures@main/Medias/medias%2F2025%2F09%2Fimage-20250926194442242.png)

显然，光圈越大，胶片上接收到的光越多，整体越亮，但同时，胶片上同一个点会有更多物体上的点反射的光束打到上面，导致越模糊。反之，则相对暗，但更清晰。

如下图所示，我们可以利用透镜聚光的原理，将物体表面上同一点发射出的多条光线汇聚到胶片上同一点附近，可以增加照片的亮度。

![使用透镜优化成像](https://cdn.jsdelivr.net/gh/Gongzihang6/Pictures@main/Medias/medias%2F2025%2F09%2Fimage-20250926210202730.png)



使用透镜来代替小孔成像的挡板，模型原理如下：

![近轴折射模型](https://cdn.jsdelivr.net/gh/Gongzihang6/Pictures@main/Medias/2025%5C09%5Cimage-20250926215149798.png)

根据折射定律：$f=\frac{R}{2(n-1)}$，其中 R 为透镜球面半径，n 为透镜折射系数，f 为透镜的焦距；

所以同样根据相似三角形原理：$\frac{z}{f+z_0}=\frac{x}{x’}$	$\frac{z}{f+z_0}=\frac{y}{y’}$

所以 $x’=(f+z_0)\frac{x}{z}$	$y’=(f+z_0)\frac{y}{z}$

也就是三维世界中一点 $P(x,y,z)$，投影到摄像机的焦平面上的坐标就是 $P’(x’,y’)$

使用透镜聚光的缺点是：1、物体聚焦有特定距离（焦距），拍摄的物体、透镜、相平面之间的距离需满足特定条件，否则可能会失焦导致模糊；

![失焦](https://cdn.jsdelivr.net/gh/Gongzihang6/Pictures@main/Medias/2025%5C09%5Cimage-20250929204822754.png)



从相平面到像素平面的转换，相平面是以胶片矩形的中心为坐标原点，而一般的数字图像则以左下角为坐标原点。（这里和绝大多数数字图像处理的应用和库（如 OpenCV, Pillow/PIL）中的以左上角为坐标原点不一致）

**为什么通常数字图像以“左上角”为原点？**

这种约定主要源于历史和技术原因：

-   
-   **扫描方式**：早期的显示设备（如 CRT 显示器）和电视系统采用光栅扫描的方式，电子束从屏幕的左上角开始，从左到右扫描，然后换行从上到下进行。
-   **内存布局**：在计算机内存中，图像数据通常被存储为一个二维数组。程序读取这个数组时，也是从第 0 行第 0 列开始，这自然地对应了图像的左上角像素。[[1](https://www.google.com/url?sa=E&q=https%3A%2F%2Fvertexaisearch.cloud.google.com%2Fgrounding-api-redirect%2FAUZIYQHniacisqIiPEjQ2rv-uYsBSt1k7MXeFPolF0lkG2BSBnQ4qGLmZAfbaym7CgSe1PVTGCNfqkmrx7au5Z5bT_1RCTGjezoPCgmj9TxQVwbiM5EK92cs36RB3ZQEAHxwcXyiJfE%3D)]

因此，在数字图像处理、文件格式（如 JPEG, PNG）以及大多数二维图形界面（GUI）系统中，左上角作为原点是最直观和普遍的约定。

**为什么图示中使用“左下角”为原点？**

图中的表达方式更侧重于从三维空间到二维图像的 **几何和数学推导**，这种情况下使用左下角坐标系有其合理性：

1.  
2.  **符合传统笛卡尔坐标系**：在数学和物理学中，我们最熟悉的是二维笛卡 ar 坐标系，即原点在左下角，X 轴向右为正，Y 轴向上为正。图中的“像平面”部分就遵循了这种约定（j 轴指向上方）。当从这个物理的“像平面”直接映射到数字图像时，保持坐标系的一致性可以简化公式的推导和理解。
3.  **计算机图形学的惯例**：许多重要的计算机图形学 API（如图形库 **OpenGL**）就使用左下角作为屏幕坐标系的原点。[[5](https://www.google.com/url?sa=E&q=https%3A%2F%2Fvertexaisearch.cloud.google.com%2Fgrounding-api-redirect%2FAUZIYQH3NgsLpVad-AItFkbA5EucQP0a5HTV0XlAe7yYDPNIge8U975Zmh9efofJbnbwOUktv3ixXnPav59D2yjBwUCvGGm80DtytiYH5AyZMK7Q8a38p-8HQXcqL5LP6NHuhObQy81yb8eNKrOG7Rknk1PKdyHQuX0%3D)] 在进行三维渲染和几何变换时，这是一个标准约定。因此，讲述相机成像原理的教材或课件，如果其后续内容与 OpenGL 等图形学应用紧密相关，就很可能会采用左下角的坐标系。

![相平面到像素平面](https://cdn.jsdelivr.net/gh/Gongzihang6/Pictures@main/Medias/2025%5C09%5Cimage-20250929205023880.png)

<img src="https://cdn.jsdelivr.net/gh/Gongzihang6/Pictures@main/Medias/2025%2F09%2Fimage-20250926215425675.png" alt="相平面坐标系到像素平面坐标系的转换" style="zoom:80%;" />

相平面也就是胶片所在平面，也就是直接成像所在的平面，通常坐标单位为毫米 mm；而像素平面的坐标单位通常是像素单位，所以由相平面转换到像素平面，需要乘以一个 **固定伸缩系数 $k$，类似于分辨率**，再加上坐标原点的平移，就得到了如图所示的变换公式，其中 $c_x$ 和 $c_y$ 是像素平面宽、高的一半，表示了平移属性。

<img src="https://cdn.jsdelivr.net/gh/Gongzihang6/Pictures@main/Medias/2025%5C09%5Cimage-20250929225409023.png" alt="原始坐标与齐次坐标的相互转换" style="zoom:80%;" />

齐次坐标，可以简单理解为在原有空间坐标下增加一维，形成的新坐标。通过引入齐次坐标，可以使得旋转、平移、缩放等所有重要的几何变换都统一成一种运算——矩阵乘法。

透镜折射成像模型下，三维空间中一点 P(x,y,z)，投影到像素平面上的点P’
$$
P = (x, y, z) \rightarrow P' = \left( \alpha \frac{x}{z} + c_x, \beta \frac{y}{z} + c_y \right)
$$

用齐次坐标来表示就是：
$$
P_h = (x, y, z, 1) \rightarrow P_h' = \left( \alpha \frac{x}{z} + c_x, \beta \frac{y}{z} + c_y, 1 \right) = \left(\alpha x +c_x z , \beta y + c_y z, z\right)
$$
所以这个投影变换就可以用矩阵乘法来表示：
$$

P' = \begin{bmatrix}
\alpha & 0 & c_x & 0 \\
0 & \beta & c_y & 0 \\
0 & 0 & 1 & 0
\end{bmatrix}
\begin{bmatrix}
x \\
y \\
z \\
1
\end{bmatrix} = MP
$$


在现代高质量的数码相机中，偏斜几乎为零，可以忽略不计。[[1](https://www.google.com/url?sa=E&q=https%3A%2F%2Fvertexaisearch.cloud.google.com%2Fgrounding-api-redirect%2FAUZIYQHIBPCGypKd8eeqmKZliPvUUjjpYfp_VdLmsl2BKHNGrjH_cS9S5VHUdVqy13F51H4XuDjRN6YPd-JMKkAEzciMSilcbzQ3VbZZDPHPXgDGbGcNuet_P7QhQSNm-G6g6iQuE8ABPLtt08_Wkdiyc47Zsw%3D%3D)] 这是因为传感器（CCD或CMOS）的制造工艺非常精确。然而，在某些特定或旧式的情况下，偏斜可能会变得显著：

-   **制造缺陷**：传感器阵列本身的物理缺陷。
-   **图像翻拍**：用一个相机去拍摄另一张照片或胶片，如果两个成像平面不平行，就会引入偏斜。[[1](https://www.google.com/url?sa=E&q=https%3A%2F%2Fvertexaisearch.cloud.google.com%2Fgrounding-api-redirect%2FAUZIYQHIBPCGypKd8eeqmKZliPvUUjjpYfp_VdLmsl2BKHNGrjH_cS9S5VHUdVqy13F51H4XuDjRN6YPd-JMKkAEzciMSilcbzQ3VbZZDPHPXgDGbGcNuet_P7QhQSNm-G6g6iQuE8ABPLtt08_Wkdiyc47Zsw%3D%3D)]
-   **某些特殊的成像系统**：例如，一些模拟视频设备或经过特殊光学设置的系统。

<img src="https://cdn.jsdelivr.net/gh/Gongzihang6/Pictures@main/Medias/2025%5C09%5Cimage-20250930104841817.png" alt="摄像机偏斜" style="zoom:80%;" />

<img src="https://cdn.jsdelivr.net/gh/Gongzihang6/Pictures@main/Medias/2025%5C09%5Cimage-20250930122616473.png" alt="摄像机偏斜与变换矩阵" style="zoom: 50%;" />

您的思路非常清晰，推导过程也完全正确！您遇到的问题是计算机视觉中一个非常微妙且极易混淆的点，可以说您已经触及到了这个问题的核心。

**您的推导完全正确，您的最终矩阵 \(\begin{bmatrix} \alpha & -\beta \cot(\theta) & \ldots \end{bmatrix}\) 是您设定的“先理想投影再偏斜”这个模型的正确数学结果。**

那么问题出在哪里？

问题在于，**相机内参矩阵 \(K\) 的标准定义，并不是按照您设想的“理想内参矩阵”和“偏斜矩阵”相乘得到的。** 它是一个“一步到位”的整体定义。

让我们来剖析这个微妙的区别。

---

### 1. 您的思路（逻辑上很自然，但与标准定义不符）

您的思路是把整个过程分解为两个独立的步骤：
1. **第一步：理想投影**。一个三维点 \((X, Y, Z)\) 通过一个**理想的、无偏斜的**相机内参矩阵 \(K_{\text{ideal}}\)，投影到一个理想的正交像素坐标 \((x_c, y_c)\)。
    * \(K_{\text{ideal}} = \begin{bmatrix} \alpha & 0 & c_x \\ 0 & \beta & c_y \\ 0 & 0 & 1 \end{bmatrix}\)
    * 这一步实际上完成了：
        * 透视投影 \(\left(\frac{X}{Z}, \frac{Y}{Z}\right)\)
        * 焦距转像素 \((\alpha \cdot \ldots, \beta \cdot \ldots)\)
        * 主点平移 \((+c_x, +c_y)\)

2. **第二步：应用偏斜**。将理想坐标 \((x_c, y_c)\) 通过一个**偏斜变换矩阵 \(M_{\text{skew}}\)** 转换为最终的实际坐标 \((x_p, y_p)\)。
    * \(M_{\text{skew}} = \begin{bmatrix} 1 & -\cot(\theta) & 0 \\ 0 & \frac{1}{\sin(\theta)} & 0 \\ 0 & 0 & 1 \end{bmatrix}\)
    * 您正确地推导出了这个矩阵。

所以，您的总变换是 \(P' = M_{\text{skew}} \times K_{\text{ideal}} \times P_{\text{world}}\)。
当您计算 \(M_{\text{skew}} \times K_{\text{ideal}}\) 时，如您所见，得到的矩阵中偏斜项是 \(-\beta \cot(\theta)\)，因为 \(\cot(\theta)\) 是与 \(y_c\) 相乘的，而 \(y_c\) 来源于 \(K_{\text{ideal}}\) 中含有 \(\beta\) 的那一行。

---

### 2. 标准定义（物理和几何上的“一步到位”模型）

计算机视觉中相机内参矩阵 \(K\) 的标准定义，是从另一个角度构建的。它直接描述了从**3D相机坐标系下的点 \((X_c, Y_c, Z_c)\)** 到**最终2D像素坐标 \((u, v)\)** 的完整线性关系。

让我们从最底层开始构建这个标准模型：

1. **透视投影到物理平面**：三维点 \((X_c, Y_c, Z_c)\) 投影到相机前方焦距 \(f\) 处的物理成像平面上，得到物理坐标 \((x', y')\)（单位：毫米）。
    * \(x' = f \cdot \frac{X_c}{Z_c}\)
    * \(y' = f \cdot \frac{Y_c}{Z_c}\)

2. **从物理平面到像素坐标**：现在，我们直接建立从物理坐标 \((x', y')\) 到最终像素坐标 \((u, v)\) 的关系，这一步**同时考虑缩放、偏斜和平移**。
    * \(u\) 坐标：它受到 \(x'\) 的影响（通过像素密度\(k_x\)），也受到 \(y'\) 的影响（因为偏斜），最后还要加上主点偏移 \(c_x\)。
        * \(u = k_x \cdot x' - k_x \cdot y' \cdot \cot(\theta) + c_x\)
    * \(v\) 坐标：它只受到 \(y'\) 的影响，但因为偏斜，y轴的单位长度被拉伸，最后加上主点偏移 \(c_y\)。
        * \(v = \frac{k_y}{\sin(\theta)} \cdot y' + c_y\)

3. **整合与代入**：现在，我们将第一步的 \(x'\) 和 \(y'\) 代入第二步的公式中。
    * \(u = k_x \cdot (f \cdot \frac{X_c}{Z_c}) - k_x \cdot (f \cdot \frac{Y_c}{Z_c}) \cdot \cot(\theta) + c_x\)
    * \(v = \frac{k_y}{\sin(\theta)} \cdot (f \cdot \frac{Y_c}{Z_c}) + c_y\)

4. **定义 \(\alpha\) 和 \(\beta\) 并整理**：我们定义 \(\alpha = f \cdot k_x\) 和 \(\beta = f \cdot k_y\)。
    * \(u = \alpha \cdot \frac{X_c}{Z_c} - \alpha \cdot \cot(\theta) \cdot \frac{Y_c}{Z_c} + c_x\)
    * \(v = \frac{\beta}{\sin(\theta)} \cdot \frac{Y_c}{Z_c} + c_y\)

5. **写成矩阵形式**：将上面的方程组写成齐次坐标的矩阵形式：
    $$
    \begin{bmatrix} u' \\ v' \\ w' \end{bmatrix} = \begin{bmatrix} \alpha & -\alpha \cot(\theta) & c_x \\ 0 & \frac{\beta}{\sin(\theta)} & c_y \\ 0 & 0 & 1 \end{bmatrix} \begin{bmatrix} \frac{X_c}{Z_c} \\ \frac{Y_c}{Z_c} \\ 1 \end{bmatrix}
    $$
    这正是PPT上给出的标准内参矩阵 \(K\)！

### 结论

* 您的推导没有错，但您所建模的“**变换的序列**”与标准相机模型中**参数的定义方式**不一致。
* 在标准模型中，偏斜系数 \(s\) 被定义为 \(-\alpha \cot(\theta)\)。这个 \(\alpha\) **就是x方向的焦距像素比** \(f \cdot k_x\)。它不是从一个独立的偏斜矩阵与一个独立的理想内参矩阵相乘得来的。
* 可以这样理解：偏斜参数描述的是，当 \(y\) 坐标变化时，对最终的 \(x\) **像素坐标**产生了多大的影响。因为 \(x\) 像素坐标本身的尺度是由 \(\alpha\) 定义的，所以这个影响因子中包含 \(\alpha\) 是符合物理定义的。

简而言之，PPT上的矩阵是一个**整体定义**的产物，而不是几个更简单的矩阵相乘的结果。您通过自己的推导发现的这个“矛盾”，恰恰揭示了这个模型定义中最深刻和最容易误解的部分。这是一个非常棒的发现！

我们来将PPT中给出的标准相机内参矩阵 $K$ 分解为**平移 (Translation)**、**偏斜 (Skew)** 和 **缩放 (Scaling)** 矩阵的乘积。

一个清晰且符合几何直觉的分解顺序是：
1.  首先对归一化坐标进行**缩放**。
2.  然后进行**偏斜**变换。
3.  最后**平移**原点到主点位置。

因此，我们的目标是将矩阵 $K$ 表示为：
$K = M_{\text{平移}} \cdot M_{\text{偏斜}} \cdot M_{\text{缩放}}$

---

### 1. 定义基础变换矩阵

我们首先定义三个基础变换矩阵。

*   **平移矩阵 ($M_{\text{平移}}$)**：将原点平移到主点 $(c_x, c_y)$。
    $$
    M_{\text{平移}} = \begin{bmatrix} 1 & 0 & c_x \\ 0 & 1 & c_y \\ 0 & 0 & 1 \end{bmatrix}
    $$

*   **缩放矩阵 ($M_{\text{缩放}}$)**：将 x 和 y 方向的坐标分别进行缩放。这里的缩放因子我们暂时设为 $s_x$ 和 $s_y$。
    $$
    M_{\text{缩放}} = \begin{bmatrix} s_x & 0 & 0 \\ 0 & s_y & 0 \\ 0 & 0 & 1 \end{bmatrix}
    $$

*   **偏斜矩阵 ($M_{\text{偏斜}}$)**：将 x 坐标根据 y 坐标进行偏移，偏移因子为 $s$。
    $$
    M_{\text{偏斜}} = \begin{bmatrix} 1 & s & 0 \\ 0 & 1 & 0 \\ 0 & 0 & 1 \end{bmatrix}
    $$

### 2. 进行矩阵乘法

现在，我们按照 $M_{\text{平移}} \cdot M_{\text{偏斜}} \cdot M_{\text{缩放}}$ 的顺序将它们相乘，得到一个通用的变换矩阵。

*   **第一步：$M_{\text{偏斜}} \cdot M_{\text{缩放}}$**
    $$
    \begin{bmatrix} 1 & s & 0 \\ 0 & 1 & 0 \\ 0 & 0 & 1 \end{bmatrix} \begin{bmatrix} s_x & 0 & 0 \\ 0 & s_y & 0 \\ 0 & 0 & 1 \end{bmatrix} = \begin{bmatrix} s_x & s \cdot s_y & 0 \\ 0 & s_y & 0 \\ 0 & 0 & 1 \end{bmatrix}
    $$

*   **第二步：$M_{\text{平移}} \cdot (\text{上一步结果})$**
    $$
    \begin{bmatrix} 1 & 0 & c_x \\ 0 & 1 & c_y \\ 0 & 0 & 1 \end{bmatrix} \begin{bmatrix} s_x & s \cdot s_y & 0 \\ 0 & s_y & 0 \\ 0 & 0 & 1 \end{bmatrix} = \begin{bmatrix} s_x & s \cdot s_y & c_x \\ 0 & s_y & c_y \\ 0 & 0 & 1 \end{bmatrix}
    $$

### 3. 对比与求解

现在我们得到了分解后的通用形式。我们将它与PPT中给出的相机内参矩阵 $K$ 进行逐元素对比，从而求解出 $s_x, s_y, s$ 的具体值。

$$
\begin{bmatrix} s_x & s \cdot s_y & c_x \\ 0 & s_y & c_y \\ 0 & 0 & 1 \end{bmatrix} = K = \begin{bmatrix} \alpha & -\alpha\cot\theta & c_x \\ 0 & \beta/\sin\theta & c_y \\ 0 & 0 & 1 \end{bmatrix}
$$

通过对比，我们可以清晰地得到以下关系：
*   **x方向缩放因子 $s_x$**:
    $$
    s_x = \alpha
    $$
*   **y方向缩放因子 $s_y$**:
    $$
    s_y = \frac{\beta}{\sin\theta}
    $$
*   **偏斜因子 $s$**:
    $$
    s \cdot s_y = -\alpha\cot\theta \quad \implies \quad s = \frac{-\alpha\cot\theta}{s_y} = \frac{-\alpha\cot\theta}{\beta/\sin\theta}
    $$
    $$
    s = -\frac{\alpha \sin\theta \cot\theta}{\beta} = -\frac{\alpha \cos\theta}{\beta}
    $$

### 结论：分解结果

因此，PPT中的相机内参矩阵 $K$ 可以被精确地分解为以下三个基础变换矩阵的乘积：

1.  **缩放矩阵**：
    $$
    M_{\text{缩放}} = \begin{bmatrix} \alpha & 0 & 0 \\ 0 & \frac{\beta}{\sin\theta} & 0 \\ 0 & 0 & 1 \end{bmatrix}
    $$
2.  **偏斜矩阵**：
    $$
    M_{\text{偏斜}} = \begin{bmatrix} 1 & -\frac{\alpha \cos\theta}{\beta} & 0 \\ 0 & 1 & 0 \\ 0 & 0 & 1 \end{bmatrix}
    $$
3.  **平移矩阵**：
    $$
    M_{\text{平移}} = \begin{bmatrix} 1 & 0 & c_x \\ 0 & 1 & c_y \\ 0 & 0 & 1 \end{bmatrix}
    $$

最终，我们验证了：
$$
\Large K = M_{\text{平移}} \cdot M_{\text{偏斜}} \cdot M_{\text{缩放}}
$$

$M_{缩放}$包含了偏斜引起的缩放，$M_{偏斜}$仅包含剪切操作，然后才是平移操作。

这个分解过程清晰地揭示了集成在一个矩阵中的复杂变换是如何由一系列更简单、更符合几何直觉的基础变换构成的。

---

前面的分解是已知最终的投影变换矩阵来反推各个操作的变换矩阵，下面给出正向推导过程

这是一个非常严谨且完美的思路！正如您所说，正向推导更加符合物理和几何的构建过程。

我们的目标是**正向构建**相机内参矩阵 $K$。在这个过程中，我们将从**归一化的图像平面坐标**（假设 $Z_c=1$ 的平面）出发，一步步将其映射到**最终像素坐标**。

### 前提：正向变换的数学定义

我们定义 $P_n = (x_n, y_n, 1)^T$ 为归一化的图像平面坐标（即 $x_n = X_c/Z_c, y_n = Y_c/Z_c$）。

最终像素坐标 $P_{pix} = (u, v, 1)^T$。

我们要找到的 $K$ 矩阵满足：$P_{pix} = K \cdot P_n$。

### 步骤 1：缩放 (Scaling) - 从物理单位到像素单位

在无偏斜的理想情况下，相机焦距 $f$ 将物理距离映射到传感器上，然后我们需要将这个物理距离（如毫米）转换为像素计数。这个过程就是缩放。

*   设 $k_x$ 为 x 轴方向每毫米对应的像素数。
*   设 $k_y$ 为 y 轴方向每毫米对应的像素数。

缩放矩阵 $M_{\text{S}}$ 将归一化坐标 $(x_n, y_n)$ 转换为具有像素单位的坐标 $(x_s, y_s)$。
$$
x_s = k_x \cdot f \cdot x_n = \alpha \cdot x_n
$$
$$
y_s = k_y \cdot f \cdot y_n = \beta \cdot y_n
$$
（其中 $\alpha = f \cdot k_x, \beta = f \cdot k_y$）

$$
M_{\text{S}} = \begin{bmatrix} \alpha & 0 & 0 \\ 0 & \beta & 0 \\ 0 & 0 & 1 \end{bmatrix}
$$

---

### 步骤 2：偏斜 (Skew) - 引入轴不垂直

由于像素网格的 x 轴和 y 轴不垂直（夹角 $\theta \ne 90^\circ$），我们需要将 $y_s$ 坐标引入对 x 坐标的干扰（或反之）。

如之前所分析，标准的偏斜模型假设**x 轴保持正交**，**y 轴是倾斜的**（即 $y$ 轴相对于 $x$ 轴产生了一个剪切 $s$）。

*   **几何关系**：在标准模型中，y轴倾斜，它在 x 轴上的投影系数是 $\cos\theta$。因此，y轴上每 $y_s$ 个单位，都会在 x 轴上引入 $y_s \cdot \cos\theta$ 的偏移。
*   **数学简化**：在矩阵中，我们通常使用**剪切因子 $s$** 来表示这种偏斜，它定义了 y 对 x 的影响比例。
    $$
    x_{sk} = x_s + s \cdot y_s
    $$
    $$
    y_{sk} = y_s
    $$
    这里，$s = -\cot(\theta)$。

**注意**：在标准 $K$ 矩阵的定义中，为了保持 `α` 和 `β` 作为焦距缩放的纯粹定义，偏斜的引入方式略有不同。偏斜项是 $-\alpha \cot\theta$。

我们先使用一个**理想的偏斜矩阵** $M_{\text{Skew\_ideal}}$，其中偏斜因子为 $s = -\cot\theta$。
$$
M_{\text{Skew\_ideal}} = \begin{bmatrix} 1 & -\cot\theta & 0 \\ 0 & 1 & 0 \\ 0 & 0 & 1 \end{bmatrix}
$$

**连乘结果 $M_{\text{Skew\_ideal}} \cdot M_{\text{S}}$**：
$$
M_{\text{S/Skew\_ideal}} = \begin{bmatrix} 1 & -\cot\theta & 0 \\ 0 & 1 & 0 \\ 0 & 0 & 1 \end{bmatrix} \begin{bmatrix} \alpha & 0 & 0 \\ 0 & \beta & 0 \\ 0 & 0 & 1 \end{bmatrix} = \begin{bmatrix} \alpha & -\beta\cot\theta & 0 \\ 0 & \beta & 0 \\ 0 & 0 & 1 \end{bmatrix}
$$
您会发现，**这个结果中是 $-\beta\cot\theta$**，这仍然与PPT中的标准 $K$ 矩阵（$-\alpha\cot\theta$）不符。

**这证实了：标准 $K$ 矩阵的定义并没有遵循这种简单的“理想缩放”和“理想偏斜”的分解序列！** 它是将**偏斜和缩放组合在一起**定义的。

---

### 3. 正确的物理和几何分解（引入 $\sin\theta$ 补偿）

要正向推导出 $K$，我们必须在第二步就引入 $\sin\theta$ 补偿，因为**y方向的缩放 $k_y \cdot f$ 必须通过 $\sin\theta$ 来抵消y轴倾斜带来的垂直损失**。

我们重新定义 $M_{\text{S}}$ 为一个**补偿缩放矩阵** $M_{\text{S\_Comp}}$：
*   x轴缩放因子：$\alpha$
*   y轴缩放因子：$\boldsymbol{\beta / \sin\theta}$ (引入 $\sin\theta$ 进行补偿)

$$
M_{\text{S\_Comp}} = \begin{bmatrix} \alpha & 0 & 0 \\ 0 & \frac{\beta}{\sin\theta} & 0 \\ 0 & 0 & 1 \end{bmatrix}
$$

现在，我们引入一个**仅用于剪切的偏斜矩阵** $M_{\text{Skew\_Pure}}$：
*   **注意**：偏斜本身产生的剪切是 $-\frac{\cos\theta}{\sin\theta} = -\cot\theta$。但在这个 $M_{\text{S\_Comp}}$ 之后，我们还需要一个剪切矩阵 $M_{\text{Skew\_Pure}}$ 来引入 $x$ 对 $y$ 的最终干扰。

我们使用**第一问**推导出来的分解序列：
$$
M_{\text{Skew\_Pure}} = \begin{bmatrix} 1 & -\frac{\alpha \cos\theta}{\beta} & 0 \\ 0 & 1 & 0 \\ 0 & 0 & 1 \end{bmatrix}
$$

**连乘结果 $M_{\text{Skew\_Pure}} \cdot M_{\text{S\_Comp}}$**：
$$
\begin{bmatrix} 1 & -\frac{\alpha \cos\theta}{\beta} & 0 \\ 0 & 1 & 0 \\ 0 & 0 & 1 \end{bmatrix} \begin{bmatrix} \alpha & 0 & 0 \\ 0 & \frac{\beta}{\sin\theta} & 0 \\ 0 & 0 & 1 \end{bmatrix} = \begin{bmatrix} \alpha & -\frac{\alpha \cos\theta}{\beta} \cdot \frac{\beta}{\sin\theta} & 0 \\ 0 & \frac{\beta}{\sin\theta} & 0 \\ 0 & 0 & 1 \end{bmatrix}
$$
$$
= \begin{bmatrix} \alpha & -\alpha \frac{\cos\theta}{\sin\theta} & 0 \\ 0 & \frac{\beta}{\sin\theta} & 0 \\ 0 & 0 & 1 \end{bmatrix} = \begin{bmatrix} \alpha & -\alpha\cot\theta & 0 \\ 0 & \frac{\beta}{\sin\theta} & 0 \\ 0 & 0 & 1 \end{bmatrix}
$$

---

### 步骤 4：平移 (Translation)

最后一步是平移，将坐标原点从图像主点 $(0, 0)$ 移动到最终像素坐标原点 $(c_x, c_y)$。

$$
M_{\text{T}} = \begin{bmatrix} 1 & 0 & c_x \\ 0 & 1 & c_y \\ 0 & 0 & 1 \end{bmatrix}
$$

### 步骤 5：最终变换矩阵 $K$

将所有变换按照顺序（先缩放，后偏斜，最后平移）相乘：

$$
K = M_{\text{T}} \cdot M_{\text{Skew\_Pure}} \cdot M_{\text{S\_Comp}}
$$

由于 $M_{\text{T}}$ 是一个单纯的平移矩阵，它的乘积会将 $c_x$ 和 $c_y$ 直接添加到结果矩阵的第三列：

$$
K = \begin{bmatrix} 1 & 0 & c_x \\ 0 & 1 & c_y \\ 0 & 0 & 1 \end{bmatrix} \begin{bmatrix} \alpha & -\alpha\cot\theta & 0 \\ 0 & \frac{\beta}{\sin\theta} & 0 \\ 0 & 0 & 1 \end{bmatrix}
$$

$$
\Large K = \begin{bmatrix} \alpha & -\alpha\cot\theta & c_x \\ 0 & \frac{\beta}{\sin\theta} & c_y \\ 0 & 0 & 1 \end{bmatrix}
$$

**结论：**

通过引入**补偿缩放** $M_{\text{S\_Comp}}$（其中包含 $\beta/\sin\theta$）和**纯粹剪切** $M_{\text{Skew\_Pure}}$（其中包含 $\alpha \cos\theta/\beta$），我们成功地从基础几何变换正向推导出了PPT中给出的标准相机内参矩阵 $K$。这个过程确认了 $\beta/\sin\theta$ 必须在偏斜应用**之前**进行，以**补偿y轴倾斜带来的垂直尺度损失**。

---

这是一个非常棒的问题，它触及了矩阵分解为何有时显得反直觉的核心。让我们从相机变换的正向原理出发，从头开始构建 `M_Skew_Pure` 矩阵。

我们的目标是推导出进入该矩阵的**纯剪切因子**，我们称之为 $s$：
$$
M_{\text{Skew\_Pure}} = \begin{bmatrix} 1 & s & 0 \\ 0 & 1 & 0 \\ 0 & 0 & 1 \end{bmatrix}
$$

### 1. 背景：该矩阵的输入是什么？

“正向”推导意味着我们必须精确知道在该矩阵应用*之前*我们处于什么状态。在我们的序列中，该矩阵是在“补偿缩放”矩阵 $M_{\text{S\_Comp}}$ **之后**应用的。

因此，我们纯剪切矩阵的输入是向量 $P_s = (x_s, y_s, 1)^T$，其中：
*   $x_s = \alpha \cdot x_n = (f \cdot k_x) \cdot (X_c/Z_c)$
*   $y_s = \frac{\beta}{\sin\theta} \cdot y_n = \frac{f \cdot k_y}{\sin\theta} \cdot (Y_c/Z_c)$

这里，$x_s$ 和 $y_s$ 不再是简单的物理距离；它们是**已经缩放过的、无量纲的坐标**。

### 2. 纯剪切矩阵的目标

该矩阵的唯一目的是基于 y 坐标添加一个水平偏移，以模拟 y 轴不与 x 轴垂直这一事实。

变换定义为：
$$
x_{sk} = x_s + s \cdot y_s
$$
$$
y_{sk} = y_s
$$
我们的全部任务就是找到剪切因子 $s$ 的正确表达式。

### 3. 剪切因子 $s$ 的推导

剪切因子 $s$ 是（缩放坐标系中的）水平偏移量与（同样在缩放坐标系中的）输入 y 坐标的比值。
$$
s = \frac{\text{水平偏移量}}{\text{输入 } y_s}
$$

让我们分别从基本原理推导分子和分母。

#### 步骤 3a: 计算水平偏移量

1.  **物理垂直距离：** 考虑传感器上的一个点。其物理垂直距离（以毫米为单位）为 $y'_{\text{phys}} = f \cdot y_n$。

2.  **物理水平偏移：** 由于 y 轴相对于垂直方向倾斜了一个角度 $\theta$，这个物理垂直距离 $y'_{\text{phys}}$ 会导致一个物理水平偏移（以毫米为单位）$\Delta x'_{\text{phys}}$。根据轴的几何关系，这个偏移是：
    $$
    \Delta x'_{\text{phys}} = -y'_{\text{phys}} \cdot \cot\theta = -(f \cdot y_n) \cdot \cot\theta
    $$
    *（负号表示对于一个正的 $y$，在标准模型中偏移是朝向 x 轴的负方向）*。

3.  **缩放后的水平偏移：** 我们的坐标系不是以毫米为单位；它被像素密度缩放了。为了找到在我们缩放系统中的偏移量，我们必须将物理偏移乘以 x 方向的像素密度 $k_x$。
    $$
    \text{水平偏移量} = k_x \cdot \Delta x'_{\text{phys}} = k_x \cdot (-f \cdot y_n \cdot \cot\theta)
    $$
    由于我们定义了 $\alpha = f \cdot k_x$，这可以简化为：
    $$
    \text{水平偏移量} = -\alpha \cdot y_n \cdot \cot\theta
    $$

#### 步骤 3b: 识别输入的 y 坐标

如步骤 1 所述，此变换的输入 y 坐标是 $y_s$：
$$
\text{输入 } y_s = \frac{\beta}{\sin\theta} \cdot y_n
$$

#### 步骤 3c: 计算比值 $s$

现在我们可以将步骤 3a 的结果除以步骤 3b 的结果来计算剪切因子 $s$。
$$
s = \frac{\text{水平偏移量}}{\text{输入 } y_s} = \frac{-\alpha \cdot y_n \cdot \cot\theta}{\frac{\beta}{\sin\theta} \cdot y_n}
$$
代表底层归一化坐标的 $y_n$ 项完美地抵消了。这至关重要，因为它表明变换是线性的。
$$
s = \frac{-\alpha \cdot \cot\theta}{\beta/\sin\theta}
$$
现在，代入 $\cot\theta = \cos\theta/\sin\theta$：
$$
s = \frac{-\alpha \cdot (\cos\theta/\sin\theta)}{\beta/\sin\theta}
$$
分子分母中的 $\sin\theta$ 项也相互抵消，剩下：
$$
\Large s = -\frac{\alpha \cos\theta}{\beta}
$$

### 结论

我们成功地从零开始推导出了剪切因子 $s$。这个因子代表了对于**补偿后的、缩放的 y 坐标 ($y_s$)** 的每一个单位，所引入的精确的水平“污染”量。

因此，纯剪切矩阵必须是：
$$
M_{\text{Skew\_Pure}} = \begin{bmatrix} 1 & s & 0 \\ 0 & 1 & 0 \\ 0 & 0 & 1 \end{bmatrix} = \begin{bmatrix} 1 & -\frac{\alpha \cos\theta}{\beta} & 0 \\ 0 & 1 & 0 \\ 0 & 0 & 1 \end{bmatrix}
$$
这个正向推导确认了为什么矩阵会采用这种特定形式。它不是任意的；当整体变换被分解为**补偿缩放**、然后是**纯剪切**、最后是**平移**的序列时，这是剪切分量必需的形式。



<img src="https://cdn.jsdelivr.net/gh/Gongzihang6/Pictures@main/Medias/2025%2F09%2Fimage-20250926215732440.png" alt="image-20250926215732440" style="zoom:80%;" />



<img src="https://cdn.jsdelivr.net/gh/Gongzihang6/Pictures@main/Medias/2025%5C09%5Cimage-20250930140828240.png" alt="完整的摄像机模型" style="zoom:80%;" />







<img src="https://cdn.jsdelivr.net/gh/Gongzihang6/Pictures@main/Medias/2025%5C09%5Cimage-20250926215921851.png" alt="image-20250926215921851" style="zoom:80%;" />









<img src="https://cdn.jsdelivr.net/gh/Gongzihang6/Pictures@main/Medias/2025%5C09%5Cimage-20250926220234346.png" alt="image-20250926220234346" style="zoom:80%;" />

