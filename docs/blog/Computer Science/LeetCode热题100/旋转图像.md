# [48. æ—‹è½¬å›¾åƒ](https://leetcode.cn/problems/rotate-image/)

ç»™å®šä¸€ä¸ª `n Ã— n` çš„äºŒç»´çŸ©é˜µ `matrix` è¡¨ç¤ºä¸€ä¸ªå›¾åƒã€‚è¯·ä½ å°†å›¾åƒé¡ºæ—¶é’ˆæ—‹è½¬ 90 åº¦ã€‚

ä½ å¿…é¡»åœ¨**[åŸåœ°](https://baike.baidu.com/item/åŸåœ°ç®—æ³•)** æ—‹è½¬å›¾åƒï¼Œè¿™æ„å‘³ç€ä½ éœ€è¦ç›´æ¥ä¿®æ”¹è¾“å…¥çš„äºŒç»´çŸ©é˜µã€‚**è¯·ä¸è¦** ä½¿ç”¨å¦ä¸€ä¸ªçŸ©é˜µæ¥æ—‹è½¬å›¾åƒã€‚



**ç¤ºä¾‹ 1ï¼š**

![img](https://assets.leetcode.com/uploads/2020/08/28/mat1.jpg)

```txt
è¾“å…¥ï¼šmatrix = [[1,2,3],[4,5,6],[7,8,9]]
è¾“å‡ºï¼š[[7,4,1],[8,5,2],[9,6,3]]
```

**ç¤ºä¾‹ 2ï¼š**

![img](https://assets.leetcode.com/uploads/2020/08/28/mat2.jpg)

```txt
è¾“å…¥ï¼šmatrix = [[5,1,9,11],[2,4,8,10],[13,3,6,7],[15,14,12,16]]
è¾“å‡ºï¼š[[15,13,2,5],[14,3,4,1],[12,6,8,9],[16,7,10,11]]
```

**æç¤ºï¼š**

- `n == matrix.length == matrix[i].length`
- `1 <= n <= 20`
- `-1000 <= matrix[i][j] <= 1000`

## æˆ‘çš„æ€è·¯

å°è¯•å°†æ¯ä¸€è¡Œçš„å…ƒç´ å’Œå¯¹åº”åˆ—çš„å…ƒç´ è¿›è¡Œé€å…ƒç´ çš„äº¤æ¢ï¼Œæ‰‹åŠ¨æ¨¡æ‹Ÿæ—‹è½¬è¿‡ç¨‹ï¼Œä½†æ˜¯ï¼š

1ã€**æ—‹è½¬ä¸æ˜¯ç®€å•çš„â€œä¸¤ä¸¤äº¤æ¢â€**ï¼š æ—‹è½¬ 90 åº¦æ¶‰åŠ 4 ä¸ªä½ç½®çš„å¾ªç¯ç§»åŠ¨ï¼ˆFour-way cycleï¼‰ï¼Œè€Œä¸æ˜¯ä¸¤ä¸ªä½ç½®äº’æ¢ã€‚ ä¾‹å¦‚ï¼šä½ç½® A ç§»åŠ¨åˆ° Bï¼ŒB ç§»åŠ¨åˆ° Cï¼ŒC ç§»åŠ¨åˆ° Dï¼ŒD ç§»åŠ¨å› Aã€‚ å¦‚æœåœ¨åŸåœ°ä»…ä»…åšä¸€ä¸ª `temp` äº¤æ¢ï¼Œä½ åªæ˜¯äº¤æ¢äº†ä¸¤ä¸ªæ•°ï¼Œå¹¶æ²¡æœ‰å®Œæˆæ—‹è½¬çš„å¾ªç¯ï¼Œä¸”ä¼šç ´åå°šæœªå¤„ç†çš„æ•°æ®ã€‚

2ã€**æ•°æ®è¦†ç›–ï¼ˆDirty Readï¼‰**ï¼š å½“ä½ ä¿®æ”¹äº† `matrix[i][j]` åï¼Œè¿™ä¸ªä½ç½®åœ¨æ–°çš„ä¸€è½®å¾ªç¯ä¸­å¯èƒ½ä½œä¸ºâ€œæºæ•°æ®â€è¢«è¯»å–ï¼Œä½†æ­¤æ—¶å®ƒå·²ç»æ˜¯â€œä¿®æ”¹åâ€çš„å€¼äº†ï¼ŒåŸå§‹æ•°æ®ä¸¢å¤±ã€‚

```c++
/**
æ€è·¯å¦‚ä¸‹ï¼šå¯¹äºåŸå§‹çŸ©é˜µçš„ç¬¬iè¡Œï¼Œæˆ‘ä»¬é€å…ƒç´ å’Œç¬¬n-iåˆ—è¿›è¡Œäº¤æ¢å³å¯
*/
class Solution {
public:
    void rotate(vector<vector<int>>& matrix) {
        int n = matrix.size();
        for(int i=0;i<n;i++){
            int temp=0;
            for(int j=0;j<n;j++){
                if(j==n-1){
                    temp=matrix[i][0];   // å­˜å‚¨åŸå§‹è¡Œä¸­çš„å…ƒç´ 
                    matrix[i][0]=matrix[j][n-1-i];
                    matrix[j][n-1-i]=temp;
                }
                else{
                    temp=matrix[i][j];   // å­˜å‚¨åŸå§‹è¡Œä¸­çš„å…ƒç´ 
                    matrix[i][j]=matrix[j][n-1-i];
                    matrix[j][n-1-i]=temp;
                }
            }
        }
    }
};
```

## æ­£ç¡®æ€è·¯

è¦åœ¨ **åŸåœ°** æ—‹è½¬å›¾åƒï¼Œæœ€ç®€å•ä¸”ä¸æ˜“å†™é”™ç´¢å¼•çš„æ–¹æ³•æ˜¯å°†æ—‹è½¬åˆ†è§£ä¸ºä¸¤ä¸ªç®€å•çš„æ•°å­¦å˜æ¢æ­¥éª¤ï¼š**å…ˆè½¬ç½®ï¼Œå†æ°´å¹³ç¿»è½¬**ã€‚

### æ­¥éª¤åˆ†è§£

1. è½¬ç½® (Transpose)ï¼š

    å°†çŸ©é˜µçš„è¡Œå’Œåˆ—äº’æ¢ï¼ˆå³æ²¿ä¸»å¯¹è§’çº¿å¯¹ç§°äº¤æ¢ï¼‰ã€‚

    å…¬å¼ï¼š$matrix[i][j] \leftrightarrow matrix[j][i]$

    - å˜æ¢åï¼Œåæ ‡ $(i, j)$ å˜æˆäº† $(j, i)$ã€‚

2. ç¿»è½¬æ¯è¡Œ (Reverse each row)ï¼š

    å°†æ¯ä¸€è¡Œå·¦å³ç¿»è½¬ã€‚

    å…¬å¼ï¼š$matrix[i][j] \leftrightarrow matrix[i][n-1-j]$

    - å˜æ¢åï¼Œåæ ‡ $(j, i)$ å˜æˆäº† $(j, n-1-i)$ã€‚

æœ€ç»ˆç»“æœï¼šåŸå§‹åæ ‡ $(i, j)$ æœ€ç»ˆå˜æˆäº† $(j, n-1-i)$ï¼Œè¿™æ­£æ˜¯é¡ºæ—¶é’ˆæ—‹è½¬ 90 åº¦çš„æ•°å­¦å®šä¹‰ã€‚

```c++
/**
 * ä½œç”¨ï¼šåŸåœ°é¡ºæ—¶é’ˆæ—‹è½¬äºŒç»´çŸ©é˜µ 90 åº¦
 * å®ç°æ€è·¯ï¼š
 * 1. å…ˆè¿›è¡ŒçŸ©é˜µè½¬ç½®ï¼ˆæ²¿å¯¹è§’çº¿äº¤æ¢å…ƒç´ ï¼‰ã€‚
 * 2. å†å¯¹æ¯ä¸€è¡Œè¿›è¡Œåè½¬ï¼ˆå·¦å³é•œåƒï¼‰ã€‚
 * * å¤æ‚åº¦åˆ†æï¼š
 * æ—¶é—´å¤æ‚åº¦ï¼šO(N^2)ï¼Œéœ€è¦éå†æ•´ä¸ªçŸ©é˜µã€‚
 * ç©ºé—´å¤æ‚åº¦ï¼šO(1)ï¼ŒåŸåœ°ä¿®æ”¹ï¼Œæœªç”³è¯·é¢å¤–çŸ©é˜µç©ºé—´ã€‚
 */
class Solution {
public:
    void rotate(vector<vector<int>>& matrix) {
        int n = matrix.size();

        // 1. è½¬ç½®çŸ©é˜µ (Transpose)
        // æ³¨æ„ï¼šj ä» i å¼€å§‹éå†ï¼Œåªéå†å¯¹è§’çº¿å³ä¸Šæ–¹çš„å…ƒç´ ï¼Œé¿å…é‡å¤äº¤æ¢å¤åŸ
        for (int i = 0; i < n; i++) {
            for (int j = i + 1; j < n; j++) {
                // äº¤æ¢ matrix[i][j] å’Œ matrix[j][i]
                swap(matrix[i][j], matrix[j][i]);
            }
        }

        // 2. ç¿»è½¬æ¯ä¸€è¡Œ (Reverse each row)
        // æ¯”å¦‚ [1, 4, 7] å˜æˆ [7, 4, 1]
        for (int i = 0; i < n; i++) {
            // ä½¿ç”¨ std::reverse ç®€åŒ–ä»£ç ï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨åŒæŒ‡é’ˆäº¤æ¢
            reverse(matrix[i].begin(), matrix[i].end());
        }
    }
};

```

### ğŸ’¡ å¦ä¸€ç§æ€è·¯ï¼šç”±å¤–å‘å†…åˆ†å±‚æ—‹è½¬ï¼ˆè¿›é˜¶ï¼‰

### æ ¸å¿ƒåŸç†ï¼šç”±å¤–å‘å†…åˆ†å±‚æ—‹è½¬ï¼ˆæ´‹è‘±å‰¥çš®æ³•ï¼‰

è¿™ç§æ–¹æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯å°†çŸ©é˜µçœ‹ä½œä¸€å±‚å±‚çš„**åŒå¿ƒæ­£æ–¹å½¢ç¯**ï¼ˆç±»ä¼¼äºæ´‹è‘±ï¼‰ã€‚æˆ‘ä»¬ä»æœ€å¤–å±‚å¼€å§‹ï¼Œé€å±‚å‘å†…è¿›è¡Œæ—‹è½¬ã€‚

å¯¹äºæ¯ä¸€å±‚ï¼ˆç¬¬ `i` å±‚ï¼‰ï¼Œæˆ‘ä»¬ä¸éœ€è¦ç§»åŠ¨æ•´è¡Œæ•´åˆ—ï¼Œè€Œæ˜¯åˆ©ç”¨ **æ—‹è½¬ 90 åº¦å…·æœ‰ 4 ä¸ªä½ç½®å¾ªç¯ä¾èµ–** çš„ç‰¹æ€§ï¼Œä¸€æ¬¡æ€§å¤„ç† 4 ä¸ªç›¸å…³çš„å…ƒç´ ã€‚

#### 1. åæ ‡æ¨å¯¼ (Coordinate Mapping)

å‡è®¾çŸ©é˜µå¤§å°ä¸º $n \times n$ï¼Œå½“å‰å¤„ç†çš„æ˜¯ç¬¬ `i` å±‚ï¼ˆä»å¤–å‘å†…æ•°ï¼‰ï¼Œå½“å‰å…ƒç´ åœ¨è¯¥è¡Œçš„åç§»é‡ä¸º `j`ã€‚

è¿™ 4 ä¸ªç›¸å…³è”çš„åæ ‡åœ¨é¡ºæ—¶é’ˆæ—‹è½¬ 90 åº¦æ—¶çš„ç§»åŠ¨è½¨è¿¹å¦‚ä¸‹ï¼š

1. **å·¦ä¸Š (Top-Left)**ï¼š$(i, j)$
2. **å³ä¸Š (Top-Right)**ï¼š$(j, n-1-i)$
3. **å³ä¸‹ (Bottom-Right)**ï¼š$(n-1-i, n-1-j)$
4. **å·¦ä¸‹ (Bottom-Left)**ï¼š$(n-1-j, i)$

ä¸ºäº†åŸåœ°æ—‹è½¬ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ª `temp` å˜é‡æš‚å­˜ï¼Œå¹¶é€†å‘è¦†ç›–ï¼ˆå°†ç›®æ ‡ä½ç½®çš„å€¼å¡«å…¥å½“å‰ä½ç½®ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±ï¼‰ï¼š

- **Step 1:** æš‚å­˜ **å·¦ä¸Š** $\rightarrow$ `temp`
- **Step 2:** **å·¦ä¸‹** å¡«å…¥ **å·¦ä¸Š** $\rightarrow$ `matrix[i][j] = matrix[n-1-j][i]`
- **Step 3:** **å³ä¸‹** å¡«å…¥ **å·¦ä¸‹** $\rightarrow$ `matrix[n-1-j][i] = matrix[n-1-i][n-1-j]`
- **Step 4:** **å³ä¸Š** å¡«å…¥ **å³ä¸‹** $\rightarrow$ `matrix[n-1-i][n-1-j] = matrix[j][n-1-i]`
- **Step 5:** `temp` å¡«å…¥ **å³ä¸Š** $\rightarrow$ `matrix[j][n-1-i] = temp`

```c++
/**
 * ä½œç”¨ï¼šä½¿ç”¨åˆ†å±‚æ—‹è½¬ï¼ˆç”±å¤–å‘å†…ï¼‰ç®—æ³•åŸåœ°æ—‹è½¬çŸ©é˜µ 90 åº¦
 * åŠŸèƒ½ï¼šä¸ä½¿ç”¨é¢å¤–ç©ºé—´ï¼Œé€šè¿‡å››ç‚¹äº¤æ¢æ³•å®Œæˆå›¾åƒæ—‹è½¬
 * å®ç°ç»†èŠ‚ï¼š
 * 1. å¤–å±‚å¾ªç¯æ§åˆ¶â€œå±‚æ•°â€ (layer)ï¼Œä» 0 åˆ° n/2ã€‚
 * 2. å†…å±‚å¾ªç¯æ§åˆ¶æ¯ä¸€å±‚ä¸­çš„â€œå…ƒç´ åç§»â€ (offset)ã€‚
 * 3. æ ¸å¿ƒæ˜¯æ‰¾åˆ°å››ä¸ªå¯¹åº”çš„åæ ‡å¹¶è¿›è¡Œè½®è½¬äº¤æ¢ã€‚
 * * æ—¶é—´å¤æ‚åº¦ï¼šO(N^2) - éå†ä¸€æ¬¡çŸ©é˜µ
 * ç©ºé—´å¤æ‚åº¦ï¼šO(1) - ä»…ä½¿ç”¨å¸¸æ•°çº§é¢å¤–å˜é‡
 */
class Solution {
public:
    void rotate(vector<vector<int>>& matrix) {
        int n = matrix.size();
        
        // i ä»£è¡¨å½“å‰çš„å±‚æ•° (ä»å¤–å‘å†…)ï¼Œåªéœ€éå†åˆ° n/2 å³å¯è¦†ç›–æ‰€æœ‰ç¯
        // ä¾‹å¦‚ n=4ï¼Œi=0(æœ€å¤–åœˆ), i=1(å†…åœˆ)
        for (int i = 0; i < n / 2; i++) {
            
            // j ä»£è¡¨å½“å‰å±‚ä¸­ï¼Œä»ç¬¬ i ä¸ªå…ƒç´ å¼€å§‹ï¼Œåˆ° n-1-i ä¸ªå…ƒç´ ç»“æŸ
            // æ³¨æ„è¾¹ç•Œæ˜¯ < n-1-iï¼Œå› ä¸ºæ¯è¡Œçš„æœ€åä¸€ä¸ªå…ƒç´ å±äºä¸‹ä¸€æ¡è¾¹çš„èµ·å§‹
            for (int j = i; j < n - 1 - i; j++) {
                
                // 1. ä¿å­˜ å·¦ä¸Šè§’ (Top-Left)
                int temp = matrix[i][j];
                
                // 2. å·¦ä¸‹è§’ (Bottom-Left) -> å·¦ä¸Šè§’
                // å¯¹åº”åæ ‡ï¼šè¡Œ=n-1-j, åˆ—=i
                matrix[i][j] = matrix[n - 1 - j][i];
                
                // 3. å³ä¸‹è§’ (Bottom-Right) -> å·¦ä¸‹è§’
                // å¯¹åº”åæ ‡ï¼šè¡Œ=n-1-i, åˆ—=n-1-j
                matrix[n - 1 - j][i] = matrix[n - 1 - i][n - 1 - j];
                
                // 4. å³ä¸Šè§’ (Top-Right) -> å³ä¸‹è§’
                // å¯¹åº”åæ ‡ï¼šè¡Œ=j, åˆ—=n-1-i
                matrix[n - 1 - i][n - 1 - j] = matrix[j][n - 1 - i];
                
                // 5. å¡«è¡¥ å³ä¸Šè§’ï¼Œå°†æš‚å­˜çš„å·¦ä¸Šè§’å€¼æ”¾å…¥
                matrix[j][n - 1 - i] = temp;
            }
        }
    }
};

```

