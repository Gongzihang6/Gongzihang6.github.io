
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="记录、分享">
      
      
        <meta name="author" content="HeRaNO, Zhoier, Ir1d, Xeonacid, wangdehu, ouuan, ranwen, ananbaobeichicun, Ycrpro, dbxxx-oi, HowieHz">
      
      
        <link rel="canonical" href="https://gongzihang6.github.io/blog/Computer%20Science/Algorithm/docs/ds/fenwick/">
      
      
      
      
      <link rel="icon" href="https://s2.loli.net/2025/02/12/aE5ovtzAlNTd9Uh.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Fenwick - Blog of GZH</title>
      
    
    
      <link rel="stylesheet" href="../../../../../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="../../../../../../stylesheets/extra2.css">
    
      <link rel="stylesheet" href="../../../../../../stylesheets/简历.css">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Wcowin/Wcowin.github.io@main/docs/stylesheets/link.css">
    
      <link rel="stylesheet" href="../../../../../../stylesheets/customize.css">
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600&display=swap">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Wcowin/Wcowin.github.io@main/docs/stylesheets/ziti.css">
    
    <script>__md_scope=new URL("../../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-40HC6RYSR1"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-40HC6RYSR1",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-40HC6RYSR1",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../../../../.." title="Blog of GZH" class="md-header__button md-logo" aria-label="Blog of GZH" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 89 89">
  <path d="M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z" />
  <path d="M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z" style="fill-opacity: 0.5" />
  <path d="M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z" />
  <path d="M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z" style="fill-opacity: 0.25" />
</svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Blog of GZH
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Fenwick
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="关闭自动模式"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="关闭自动模式" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo"  aria-label="切换至夜间模式"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="切换至夜间模式" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="切换至日间模式"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="切换至日间模式" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="选择当前语言">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M0 128c0-35.3 28.7-64 64-64h512c35.3 0 64 28.7 64 64v256c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64zm320 0v256h256V128zm-141.7 47.9c-3.2-7.2-10.4-11.9-18.3-11.9s-15.1 4.7-18.3 11.9l-64 144c-4.5 10.1.1 21.9 10.2 26.4s21.9-.1 26.4-10.2l8.9-20.1h73.6l8.9 20.1c4.5 10.1 16.3 14.6 26.4 10.2s14.6-16.3 10.2-26.4zM160 233.2l19 42.8h-38zM448 164c11 0 20 9 20 20v4h60c11 0 20 9 20 20s-9 20-20 20h-2l-1.6 4.5c-8.9 24.4-22.4 46.6-39.6 65.4.9.6 1.8 1.1 2.7 1.6l18.9 11.3c9.5 5.7 12.5 18 6.9 27.4s-18 12.5-27.4 6.9L467 333.8c-4.5-2.7-8.8-5.5-13.1-8.5-10.6 7.5-21.9 14-34 19.4l-3.6 1.6c-10.1 4.5-21.9-.1-26.4-10.2s.1-21.9 10.2-26.4l3.6-1.6c6.4-2.9 12.6-6.1 18.5-9.8L410 286.1c-7.8-7.8-7.8-20.5 0-28.3s20.5-7.8 28.3 0l14.6 14.6.5.5c12.4-13.1 22.5-28.3 29.8-45l-35.2.1h-72c-11 0-20-9-20-20s9-20 20-20h52v-4c0-11 9-20 20-20"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="/" hreflang="zh" class="md-select__link">
              简体中文
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/Mkdocs-Wcowin/en/" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/Mkdocs-Wcowin/ZH-TW/" hreflang="zh-TW" class="md-select__link">
              China(TW)
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256l137.3-137.4c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="分享" aria-label="分享" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Gongzihang6" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    Gongzihang6
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../.." class="md-tabs__link">
        
  
  
    
  
  主页

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../java%E5%9F%BA%E7%A1%80/" class="md-tabs__link">
          
  
  
    
  
  Computer Science

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../MachineLearning/K%E8%BF%91%E9%82%BB%E5%AD%A6%E4%B9%A0%E4%B8%8E%E9%99%8D%E7%BB%B4/" class="md-tabs__link">
          
  
  
    
  
  MachineLearning

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../%E6%AF%8F%E6%97%A5%E8%AF%97%E8%AF%8D/%E8%99%9E%E7%BE%8E%E4%BA%BA%C2%B7%E7%8E%89%E9%98%91%E5%B9%B2%E5%A4%96%E6%B8%85%E6%B1%9F%E6%B5%A6/" class="md-tabs__link">
          
  
  
    
  
  每日诗词

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../%E6%9C%8B%E5%8F%8B%E5%9C%88/" class="md-tabs__link">
          
  
  
    
  
  朋友圈

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../%E9%95%BF%E6%9C%9F%E4%B8%BB%E4%B9%89/fitness/" class="md-tabs__link">
          
  
  
    
  
  长期主义

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../../about/geren/" class="md-tabs__link">
          
  
  
    
  
  关于

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../../.." title="Blog of GZH" class="md-nav__button md-logo" aria-label="Blog of GZH" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 89 89">
  <path d="M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z" />
  <path d="M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z" style="fill-opacity: 0.5" />
  <path d="M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z" />
  <path d="M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z" style="fill-opacity: 0.25" />
</svg>

    </a>
    Blog of GZH
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Gongzihang6" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    Gongzihang6
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    主页
    
  </span>
  
    
  
  
    <span class="md-status md-status--new"></span>
  

  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Computer Science
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Computer Science
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Java
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Java
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E5%9F%BA%E7%A1%80/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Java面向对象基础
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../%E5%B8%B8%E7%94%A8API/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Java集合框架与常用API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E6%8F%90%E9%AB%98/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Java高级技术
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Algorithm
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Algorithm
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%AE%97%E6%B3%95%E5%9F%BA%E7%A1%80/%E5%B9%B6%E6%9F%A5%E9%9B%86/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    并查集
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    LeetCode热题100
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            LeetCode热题100
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode%E7%83%AD%E9%A2%98100/%E5%AD%97%E6%AF%8D%E5%BC%82%E4%BD%8D%E8%AF%8D%E5%88%86%E7%BB%84/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    字母异位词分组
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    LeetCode
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            LeetCode
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/%E4%BA%A4%E6%98%93%E9%80%86%E5%BA%8F%E5%AF%B9%E7%9A%84%E6%80%BB%E6%95%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    交易逆序对的总数
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/%E5%8D%95%E8%AF%8D%E6%8E%A5%E9%BE%99/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    单词接龙
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/%E5%B2%9B%E5%B1%BF%E6%95%B0%E9%87%8F/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    岛屿数量
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/%E5%88%86%E8%80%83%E5%9C%BA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    分考场
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/%E6%8B%89%E9%A9%AC%E8%BD%A6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    拉马车
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/%E5%88%86%E5%B7%A7%E5%85%8B%E5%8A%9B/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    分巧克力
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/k%E5%80%8D%E5%8C%BA%E9%97%B4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    K倍区间
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/%E7%BC%96%E8%BE%91%E8%B7%9D%E7%A6%BB/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    编辑距离
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/%E6%8E%A5%E9%9B%A8%E6%B0%B4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    接雨水
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/%E7%BB%84%E5%90%88%E6%80%BB%E5%92%8C/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    组合总和
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/%E5%85%A8%E6%8E%92%E5%88%97/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    全排列
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/%E4%B9%98%E7%A7%AF%E6%9C%80%E5%A4%A7%E5%AD%90%E6%95%B0%E7%BB%84/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    乘积最大子数组
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/%E6%9C%80%E9%95%BF%E5%9B%9E%E6%96%87%E5%AD%90%E4%B8%B2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5. 最长回文子串
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/%E5%89%8DK%E4%B8%AA%E9%AB%98%E9%A2%91%E5%85%83%E7%B4%A0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    前K个高频元素
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/%E6%9C%80%E5%B0%8F%E6%A0%88/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    最小栈
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/Pow%28x%2Cn%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pow(x,n)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/%E7%BD%91%E7%BB%9C%E5%BB%B6%E8%BF%9F%E6%97%B6%E9%97%B4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    网络延迟时间
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/%E8%AE%A1%E7%AE%97%E8%B4%A8%E6%95%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    计算质数
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/%E5%AF%B9%E8%A7%92%E7%BA%BF%E4%B8%8A%E7%9A%84%E8%B4%A8%E6%95%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    对角线上的质数
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/%E9%9B%B6%E9%92%B1%E5%85%91%E6%8D%A2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    零钱兑换
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/01%E7%9F%A9%E9%98%B5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    01矩阵
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    二分查找
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/%E6%8B%AC%E5%8F%B7%E5%8C%B9%E9%85%8D/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    括号匹配
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/300%E6%9C%80%E9%95%BF%E9%80%92%E5%A2%9E%E5%AD%90%E5%BA%8F%E5%88%97/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    300最长递增子序列
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/115%E4%B8%8D%E5%90%8C%E7%9A%84%E5%AD%90%E5%BA%8F%E5%88%97/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    115不同的子序列
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/712%E4%B8%A4%E4%B8%AA%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%9C%80%E5%B0%8FASCII%E5%88%A0%E9%99%A4%E5%92%8C/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    712两个字符串的最小ASCII删除和
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/516%E6%9C%80%E9%95%BF%E5%9B%9E%E6%96%87%E5%AD%90%E5%BA%8F%E5%88%97/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    516最长回文子序列
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/139%E5%8D%95%E8%AF%8D%E6%8B%86%E5%88%86/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    139单词拆分
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/221%E6%9C%80%E5%A4%A7%E6%AD%A3%E6%96%B9%E5%BD%A2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    221最大正方形
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/2845%E7%BB%9F%E8%AE%A1%E8%B6%A3%E5%91%B3%E5%AD%90%E6%95%B0%E7%BB%84%E7%9A%84%E6%95%B0%E7%9B%AE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2845统计趣味子数组的数目
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/2799%E7%BB%9F%E8%AE%A1%E5%AE%8C%E5%85%A8%E5%AD%90%E6%95%B0%E7%BB%84%E7%9A%84%E6%95%B0%E7%9B%AE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2799统计完全子数组的数目
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/1399%E7%BB%9F%E8%AE%A1%E6%9C%80%E5%A4%A7%E7%BB%84%E7%9A%84%E6%95%B0%E7%9B%AE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1399统计最大组的数目
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/2338%E7%BB%9F%E8%AE%A1%E7%90%86%E6%83%B3%E6%95%B0%E7%BB%84%E7%9A%84%E6%95%B0%E7%9B%AE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2338统计理想数组的数目
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/2179%E7%BB%9F%E8%AE%A1%E6%95%B0%E7%BB%84%E4%B8%AD%E5%A5%BD%E4%B8%89%E5%85%83%E7%BB%84%E6%95%B0%E7%9B%AE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2179统计数组中好三元组数目
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/2537%E7%BB%9F%E8%AE%A1%E5%A5%BD%E5%AD%90%E6%95%B0%E7%BB%84%E7%9A%84%E6%95%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2537统计好子数组的数
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/2140%E8%A7%A3%E5%86%B3%E6%99%BA%E5%8A%9B%E9%97%AE%E9%A2%98/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2140解决智力问题
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/2278%E5%AD%97%E6%AF%8D%E5%9C%A8%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%AD%E7%9A%84%E7%99%BE%E5%88%86%E6%AF%94/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2278字母在字符串中的百分比
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    MachineLearning
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            MachineLearning
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MachineLearning/K%E8%BF%91%E9%82%BB%E5%AD%A6%E4%B9%A0%E4%B8%8E%E9%99%8D%E7%BB%B4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    K近邻学习与降维
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MachineLearning/%E6%A8%A1%E5%9E%8B%E8%AF%84%E4%BC%B0%E4%B8%8E%E5%A4%9A%E5%88%86%E7%B1%BB/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    模型评估与多分类
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MachineLearning/%E5%85%AC%E5%BC%8F%E6%B5%8B%E8%AF%95/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    公式测试
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MachineLearning/%E7%BB%8F%E5%85%B8%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    经典卷积神经网络
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MachineLearning/%E7%90%86%E8%A7%A3YOLO%E7%BD%91%E7%BB%9C%E7%BB%93%E6%9E%84/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    理解YOLO网络结构
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    每日诗词
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            每日诗词
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../%E6%AF%8F%E6%97%A5%E8%AF%97%E8%AF%8D/%E8%99%9E%E7%BE%8E%E4%BA%BA%C2%B7%E7%8E%89%E9%98%91%E5%B9%B2%E5%A4%96%E6%B8%85%E6%B1%9F%E6%B5%A6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    虞美人·玉阑干外清江浦
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../%E6%AF%8F%E6%97%A5%E8%AF%97%E8%AF%8D/%E8%8F%A9%E8%90%A8%E8%9B%AE%C2%B7%E5%9B%9E%E6%96%87%E5%A4%8F%E9%97%BA%E6%80%A8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    菩萨蛮·回文夏闺怨
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../%E6%AF%8F%E6%97%A5%E8%AF%97%E8%AF%8D/%E6%B8%85%E5%B9%B3%E4%B9%90%C2%B7%E5%85%AD%E7%9B%98%E5%B1%B1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    清平乐·六盘山
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../%E6%AF%8F%E6%97%A5%E8%AF%97%E8%AF%8D/%E6%B4%9E%E4%BB%99%E6%AD%8C%C2%B7%E5%92%8F%E6%9F%B3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    洞仙歌·咏柳
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../%E6%AF%8F%E6%97%A5%E8%AF%97%E8%AF%8D/%E7%A7%8B%E5%85%B4%E5%85%AB%E9%A6%96%C2%B7%E5%85%B6%E4%B8%80/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    秋兴八首·其一
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../%E6%AF%8F%E6%97%A5%E8%AF%97%E8%AF%8D/%E4%B8%8E%E5%8F%B2%E9%83%8E%E4%B8%AD%E9%92%A6%E5%90%AC%E9%BB%84%E9%B9%A4%E6%A5%BC%E4%B8%8A%E5%90%B9%E7%AC%9B/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    与史郎中钦听黄鹤楼上吹笛
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../%E6%AF%8F%E6%97%A5%E8%AF%97%E8%AF%8D/%E5%A4%8F%E6%97%A5%E5%8D%97%E4%BA%AD%E6%80%80%E8%BE%9B%E5%A4%A7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    夏日南亭怀辛大
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../%E6%AF%8F%E6%97%A5%E8%AF%97%E8%AF%8D/%E8%A1%8C%E9%A6%99%E5%AD%90%C2%B7%E7%A7%8B%E4%B8%8E/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    行香子·秋与
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../%E6%AF%8F%E6%97%A5%E8%AF%97%E8%AF%8D/%E8%87%AA%E9%A2%98%E9%87%91%E5%B1%B1%E7%94%BB%E5%83%8F/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    自题金山画像
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    朋友圈
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            朋友圈
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../%E6%9C%8B%E5%8F%8B%E5%9C%88/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    朋友圈
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    长期主义
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            长期主义
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../%E9%95%BF%E6%9C%9F%E4%B8%BB%E4%B9%89/fitness/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fitness
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    关于
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            关于
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../about/geren/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    作者个人简介
    
  </span>
  
    
  
  
    <span class="md-status md-status--new"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../about/%E7%AE%80%E5%8E%86/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    个人简历
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../about/zcw/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    支持作者
    
  </span>
  
    
  
  
    <span class="md-status md-status--new"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../about/test/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    功能测试
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      引入
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      树状数组
    </span>
  </a>
  
    <nav class="md-nav" aria-label="树状数组">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      初步感受
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      管辖区间
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      区间查询
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      树状数组与其树形态的性质
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      单点修改
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      建树
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      复杂度分析
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      区间加区间和
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      二维树状数组
    </span>
  </a>
  
    <nav class="md-nav" aria-label="二维树状数组">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      单点修改，子矩阵查询
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      子矩阵加，求子矩阵和
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      权值树状数组及应用
    </span>
  </a>
  
    <nav class="md-nav" aria-label="权值树状数组及应用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#k" class="md-nav__link">
    <span class="md-ellipsis">
      单点修改，查询全局第 \(k\) 小
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      全局逆序对（全局二维偏序）
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      树状数组维护不可差分信息
    </span>
  </a>
  
    <nav class="md-nav" aria-label="树状数组维护不可差分信息">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      区间查询
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      单点更新
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      建树
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tricks" class="md-nav__link">
    <span class="md-ellipsis">
      Tricks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tricks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#thetan" class="md-nav__link">
    <span class="md-ellipsis">
      \(\Theta(n)\) 建树
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      时间戳优化
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      例题
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>Fenwick</h1>

<div class="admonition info">
<p class="admonition-title">💾 AI智能摘要 (DeepSeek)</p>
<p>树状数组是一种高效的数据结构，支持单点修改和区间查询操作，时间复杂度为O(log n)。其核心原理是将前缀信息拆分为若干小区间，利用二进制索引快速合并预存信息。相比线段树，树状数组代码更简洁且常数更小，但功能受限，仅适用于满足结合律和可差分性的运算（如加法、异或）。通过差分技巧，还能处理区间修改和区间求和问题。适用于需要频繁更新和查询前缀信息的场景，如动态统计问题。</p>
</div>
<div class="admonition info">
<p class="admonition-title">📖 阅读信息</p>
<p>阅读时间：<strong>7</strong> 分钟 | 中文字符：<strong>2775</strong> | 有效代码行数：<strong>253</strong></p>
</div>
<h2 id="_1">引入<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>树状数组是一种支持 <strong>单点修改</strong> 和 <strong>区间查询</strong> 的，代码量小的数据结构。</p>
<details class="note">
<summary>什么是「单点修改」和「区间查询」？</summary>
<p>假设有这样一道题：</p>
<p>已知一个数列 <span class="arithmatex">\(a\)</span>，你需要进行下面两种操作：</p>
<ul>
<li>给定 <span class="arithmatex">\(x, y\)</span>，将 <span class="arithmatex">\(a[x]\)</span> 自增 <span class="arithmatex">\(y\)</span>。</li>
<li>给定 <span class="arithmatex">\(l, r\)</span>，求解 <span class="arithmatex">\(a[l \ldots r]\)</span> 的和。</li>
</ul>
<p>其中第一种操作就是「单点修改」，第二种操作就是「区间查询」。</p>
<p>类似地，还有：「区间修改」、「单点查询」。它们分别的一个例子如下：</p>
<ul>
<li>区间修改：给定 <span class="arithmatex">\(l, r, x\)</span>，将 <span class="arithmatex">\(a[l \ldots r]\)</span> 中的每个数都分别自增 <span class="arithmatex">\(x\)</span>；</li>
<li>单点查询：给定 <span class="arithmatex">\(x\)</span>，求解 <span class="arithmatex">\(a[x]\)</span> 的值。</li>
</ul>
<p>注意到，区间问题一般严格强于单点问题，因为对单点的操作相当于对一个长度为 <span class="arithmatex">\(1\)</span> 的区间操作。</p>
</details>
<p>普通树状数组维护的信息及运算要满足 <strong>结合律</strong> 且 <strong>可差分</strong>，如加法（和）、乘法（积）、异或等。</p>
<ul>
<li>结合律：<span class="arithmatex">\((x \circ y) \circ z = x \circ (y \circ z)\)</span>，其中 <span class="arithmatex">\(\circ\)</span> 是一个二元运算符。</li>
<li>可差分：具有逆运算的运算，即已知 <span class="arithmatex">\(x \circ y\)</span> 和 <span class="arithmatex">\(x\)</span> 可以求出 <span class="arithmatex">\(y\)</span>。</li>
</ul>
<p>需要注意的是：</p>
<ul>
<li>模意义下的乘法若要可差分，需保证每个数都存在逆元（模数为质数时一定存在）；</li>
<li>例如 <span class="arithmatex">\(\gcd\)</span>，<span class="arithmatex">\(\max\)</span> 这些信息不可差分，所以不能用普通树状数组处理，但是：<ul>
<li>使用两个树状数组可以用于处理区间最值，见 <a href="http://history.ioinformatics.org/oi/files/volume9.pdf#page=41">Efficient Range Minimum Queries using Binary Indexed Trees</a>。</li>
<li>本页面也会介绍一种支持不可差分信息查询的，<span class="arithmatex">\(\Theta(\log^2n)\)</span> 时间复杂度的拓展树状数组。</li>
</ul>
</li>
</ul>
<p>事实上，树状数组能解决的问题是线段树能解决的问题的子集：树状数组能做的，线段树一定能做；线段树能做的，树状数组不一定可以。然而，树状数组的代码要远比线段树短，时间效率常数也更小，因此仍有学习价值。</p>
<p>有时，在差分数组和辅助数组的帮助下，树状数组还可解决更强的 <strong>区间加单点值</strong> 和 <strong>区间加区间和</strong> 问题。</p>
<h2 id="_2">树状数组<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<h3 id="_3">初步感受<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p>先来举个例子：我们想知道 <span class="arithmatex">\(a[1 \ldots 7]\)</span> 的前缀和，怎么做？</p>
<p>一种做法是：<span class="arithmatex">\(a_1 + a_2 + a_3 + a_4 + a_5 + a_6 + a_7\)</span>，需要求 <span class="arithmatex">\(7\)</span> 个数的和。</p>
<p>但是如果已知三个数 <span class="arithmatex">\(A\)</span>，<span class="arithmatex">\(B\)</span>，<span class="arithmatex">\(C\)</span>，<span class="arithmatex">\(A = a[1 \ldots 4]\)</span> 的和，<span class="arithmatex">\(B = a[5 \ldots 6]\)</span> 的总和，<span class="arithmatex">\(C = a[7 \ldots 7]\)</span> 的总和（其实就是 <span class="arithmatex">\(a[7]\)</span> 自己）。你会怎么算？你一定会回答：<span class="arithmatex">\(A + B + C\)</span>，只需要求 <span class="arithmatex">\(3\)</span> 个数的和。</p>
<p>这就是树状数组能快速求解信息的原因：我们总能将一段前缀 <span class="arithmatex">\([1, n]\)</span> 拆成 <strong>不多于 <span class="arithmatex">\(\boldsymbol{\log n}\)</span> 段区间</strong>，使得这 <span class="arithmatex">\(\log n\)</span> 段区间的信息是 <strong>已知的</strong>。</p>
<p>于是，我们只需合并这 <span class="arithmatex">\(\log n\)</span> 段区间的信息，就可以得到答案。相比于原来直接合并 <span class="arithmatex">\(n\)</span> 个信息，效率有了很大的提高。</p>
<p>不难发现信息必须满足结合律，否则就不能像上面这样合并了。</p>
<p>下面这张图展示了树状数组的工作原理：</p>
<p><img alt="" src="../images/fenwick.svg" /></p>
<p>最下面的八个方块代表原始数据数组 <span class="arithmatex">\(a\)</span>。上面参差不齐的方块（与最上面的八个方块是同一个数组）代表数组 <span class="arithmatex">\(a\)</span> 的上级——<span class="arithmatex">\(c\)</span> 数组。</p>
<p><span class="arithmatex">\(c\)</span> 数组就是用来储存原始数组 <span class="arithmatex">\(a\)</span> 某段区间的和的，也就是说，这些区间的信息是已知的，我们的目标就是把查询前缀拆成这些小区间。</p>
<p>例如，从图中可以看出：</p>
<ul>
<li><span class="arithmatex">\(c_2\)</span> 管辖的是 <span class="arithmatex">\(a[1 \ldots 2]\)</span>；</li>
<li><span class="arithmatex">\(c_4\)</span> 管辖的是 <span class="arithmatex">\(a[1 \ldots 4]\)</span>；</li>
<li><span class="arithmatex">\(c_6\)</span> 管辖的是 <span class="arithmatex">\(a[5 \ldots 6]\)</span>；</li>
<li><span class="arithmatex">\(c_8\)</span> 管辖的是 <span class="arithmatex">\(a[1 \ldots 8]\)</span>；</li>
<li>剩下的 <span class="arithmatex">\(c[x]\)</span> 管辖的都是 <span class="arithmatex">\(a[x]\)</span> 自己（可以看做 <span class="arithmatex">\(a[x \ldots x]\)</span> 的长度为 <span class="arithmatex">\(1\)</span> 的小区间）。</li>
</ul>
<p>不难发现，<span class="arithmatex">\(c[x]\)</span> 管辖的一定是一段右边界是 <span class="arithmatex">\(x\)</span> 的区间总信息。我们先不关心左边界，先来感受一下树状数组是如何查询的。</p>
<p>举例：计算 <span class="arithmatex">\(a[1 \ldots 7]\)</span> 的和。</p>
<p>过程：从 <span class="arithmatex">\(c_{7}\)</span> 开始往前跳，发现 <span class="arithmatex">\(c_{7}\)</span> 只管辖 <span class="arithmatex">\(a_{7}\)</span> 这个元素；然后找 <span class="arithmatex">\(c_{6}\)</span>，发现 <span class="arithmatex">\(c_{6}\)</span> 管辖的是 <span class="arithmatex">\(a[5 \ldots 6]\)</span>，然后跳到 <span class="arithmatex">\(c_{4}\)</span>，发现 <span class="arithmatex">\(c_{4}\)</span> 管辖的是 <span class="arithmatex">\(a[1 \ldots 4]\)</span> 这些元素，然后再试图跳到 <span class="arithmatex">\(c_0\)</span>，但事实上 <span class="arithmatex">\(c_0\)</span> 不存在，不跳了。</p>
<p>我们刚刚找到的 <span class="arithmatex">\(c\)</span> 是 <span class="arithmatex">\(c_7, c_6, c_4\)</span>，事实上这就是 <span class="arithmatex">\(a[1 \ldots 7]\)</span> 拆分出的三个小区间，合并得到答案是 <span class="arithmatex">\(c_7 + c_6 + c_4\)</span>。</p>
<p>举例：计算 <span class="arithmatex">\(a[4 \ldots 7]\)</span> 的和。</p>
<p>我们还是从 <span class="arithmatex">\(c_7\)</span> 开始跳，跳到 <span class="arithmatex">\(c_6\)</span> 再跳到 <span class="arithmatex">\(c_4\)</span>。此时我们发现它管理了 <span class="arithmatex">\(a[1 \ldots 4]\)</span> 的和，但是我们不想要 <span class="arithmatex">\(a[1 \ldots 3]\)</span> 这一部分，怎么办呢？很简单，减去 <span class="arithmatex">\(a[1 \ldots 3]\)</span> 的和就行了。</p>
<p>那不妨考虑最开始，就将查询 <span class="arithmatex">\(a[4 \ldots 7]\)</span> 的和转化为查询 <span class="arithmatex">\(a[1 \ldots 7]\)</span> 的和，以及查询 <span class="arithmatex">\(a[1 \ldots 3]\)</span> 的和，最终将两个结果作差。</p>
<p><img alt="" src="../images/fenwick-query.svg" /></p>
<h3 id="_4">管辖区间<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<p>那么问题来了，<span class="arithmatex">\(c[x](x \ge 1)\)</span> 管辖的区间到底往左延伸多少？也就是说，区间长度是多少？</p>
<p>树状数组中，规定 <span class="arithmatex">\(c[x]\)</span> 管辖的区间长度为 <span class="arithmatex">\(2^{k}\)</span>，其中：</p>
<ul>
<li>设二进制最低位为第 <span class="arithmatex">\(0\)</span> 位，则 <span class="arithmatex">\(k\)</span> 恰好为 <span class="arithmatex">\(x\)</span> 二进制表示中，最低位的 <code>1</code> 所在的二进制位数；</li>
<li><span class="arithmatex">\(2^k\)</span>（<span class="arithmatex">\(c[x]\)</span> 的管辖区间长度）恰好为 <span class="arithmatex">\(x\)</span> 二进制表示中，最低位的 <code>1</code> 以及后面所有 <code>0</code> 组成的数。</li>
</ul>
<p>举个例子，<span class="arithmatex">\(c_{88}\)</span> 管辖的是哪个区间？</p>
<p>因为 <span class="arithmatex">\(88_{(10)}=01011000_{(2)}\)</span>，其二进制最低位的 <code>1</code> 以及后面的 <code>0</code> 组成的二进制是 <code>1000</code>，即 <span class="arithmatex">\(8\)</span>，所以 <span class="arithmatex">\(c_{88}\)</span> 管辖 <span class="arithmatex">\(8\)</span> 个 <span class="arithmatex">\(a\)</span> 数组中的元素。</p>
<p>因此，<span class="arithmatex">\(c_{88}\)</span> 代表 <span class="arithmatex">\(a[81 \ldots 88]\)</span> 的区间信息。</p>
<p>我们记 <span class="arithmatex">\(x\)</span> 二进制最低位 <code>1</code> 以及后面的 <code>0</code> 组成的数为 <span class="arithmatex">\(\operatorname{lowbit}(x)\)</span>，那么 <span class="arithmatex">\(c[x]\)</span> 管辖的区间就是 <span class="arithmatex">\([x-\operatorname{lowbit}(x)+1, x]\)</span>。</p>
<p><strong>这里注意：<span class="arithmatex">\(\boldsymbol{\operatorname{lowbit}}\)</span> 指的不是最低位 <code>1</code> 所在的位数 <span class="arithmatex">\(\boldsymbol{k}\)</span>，而是这个 <code>1</code> 和后面所有 <code>0</code> 组成的 <span class="arithmatex">\(\boldsymbol{2^k}\)</span>。</strong></p>
<p>怎么计算 <code>lowbit</code>？根据位运算知识，可以得到 <code>lowbit(x) = x &amp; -x</code>。</p>
<details class="note">
<summary>lowbit 的原理</summary>
<p>将 <code>x</code> 的二进制所有位全部取反，再加 1，就可以得到 <code>-x</code> 的二进制编码。例如，<span class="arithmatex">\(6\)</span> 的二进制编码是 <code>110</code>，全部取反后得到 <code>001</code>，加 <code>1</code> 得到 <code>010</code>。</p>
<p>设原先 <code>x</code> 的二进制编码是 <code>(...)10...00</code>，全部取反后得到 <code>[...]01...11</code>，加 <code>1</code> 后得到 <code>[...]10...00</code>，也就是 <code>-x</code> 的二进制编码了。这里 <code>x</code> 二进制表示中第一个 <code>1</code> 是 <code>x</code> 最低位的 <code>1</code>。</p>
<p><code>(...)</code> 和 <code>[...]</code> 中省略号的每一位分别相反，所以 <code>x &amp; -x = (...)10...00 &amp; [...]10...00 = 10...00</code>，得到的结果就是 <code>lowbit</code>。</p>
</details>
<details class="note" open="open">
<summary>实现</summary>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">C++</label><label for="__tabbed_1_2">Python</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span>
<span class="normal"><a href="#__codelineno-0-3">3</a></span>
<span class="normal"><a href="#__codelineno-0-4">4</a></span>
<span class="normal"><a href="#__codelineno-0-5">5</a></span>
<span class="normal"><a href="#__codelineno-0-6">6</a></span>
<span class="normal"><a href="#__codelineno-0-7">7</a></span>
<span class="normal"><a href="#__codelineno-0-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">lowbit</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="w">  </span><span class="c1">// x 的二进制中，最低位的 1 以及后面所有 0 组成的数。</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="w">  </span><span class="c1">// lowbit(0b01011000) == 0b00001000</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="w">  </span><span class="c1">//          ~~~~^~~~</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="w">  </span><span class="c1">// lowbit(0b01110010) == 0b00000010</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="w">  </span><span class="c1">//          ~~~~~~^~</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="o">-</span><span class="n">x</span><span class="p">;</span>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Python</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span>
<span class="normal"><a href="#__codelineno-1-2">2</a></span>
<span class="normal"><a href="#__codelineno-1-3">3</a></span>
<span class="normal"><a href="#__codelineno-1-4">4</a></span>
<span class="normal"><a href="#__codelineno-1-5">5</a></span>
<span class="normal"><a href="#__codelineno-1-6">6</a></span>
<span class="normal"><a href="#__codelineno-1-7">7</a></span>
<span class="normal"><a href="#__codelineno-1-8">8</a></span>
<span class="normal"><a href="#__codelineno-1-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">lowbit</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="sd">    x 的二进制中，最低位的 1 以及后面所有 0 组成的数。</span>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="sd">    lowbit(0b01011000) == 0b00001000</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="sd">            ~~~~~^~~</span>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="sd">    lowbit(0b01110010) == 0b00000010</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="sd">            ~~~~~~~^~</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a>    <span class="k">return</span> <span class="n">x</span> <span class="o">&amp;</span> <span class="o">-</span><span class="n">x</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
</details>
<h3 id="_5">区间查询<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<p>接下来我们来看树状数组具体的操作实现，先来看区间查询。</p>
<p>回顾查询 <span class="arithmatex">\(a[4 \ldots 7]\)</span> 的过程，我们是将它转化为两个子过程：查询 <span class="arithmatex">\(a[1 \ldots 7]\)</span> 和查询 <span class="arithmatex">\(a[1 \ldots 3]\)</span> 的和，最终作差。</p>
<p>其实任何一个区间查询都可以这么做：查询 <span class="arithmatex">\(a[l \ldots r]\)</span> 的和，就是 <span class="arithmatex">\(a[1 \ldots r]\)</span> 的和减去 <span class="arithmatex">\(a[1 \ldots l - 1]\)</span> 的和，从而把区间问题转化为前缀问题，更方便处理。</p>
<p>事实上，将有关 <span class="arithmatex">\(l \ldots r\)</span> 的区间询问转化为 <span class="arithmatex">\(1 \ldots r\)</span> 和 <span class="arithmatex">\(1 \ldots l - 1\)</span> 的前缀询问再差分，在竞赛中是一个非常常用的技巧。</p>
<p>那前缀查询怎么做呢？回顾下查询 <span class="arithmatex">\(a[1 \ldots 7]\)</span> 的过程：</p>
<blockquote>
<p>从 <span class="arithmatex">\(c_{7}\)</span> 往前跳，发现 <span class="arithmatex">\(c_{7}\)</span> 只管辖 <span class="arithmatex">\(a_{7}\)</span> 这个元素；然后找 <span class="arithmatex">\(c_{6}\)</span>，发现 <span class="arithmatex">\(c_{6}\)</span> 管辖的是 <span class="arithmatex">\(a[5 \ldots 6]\)</span>，然后跳到 <span class="arithmatex">\(c_{4}\)</span>，发现 <span class="arithmatex">\(c_{4}\)</span> 管辖的是 <span class="arithmatex">\(a[1 \ldots 4]\)</span> 这些元素，然后再试图跳到 <span class="arithmatex">\(c_0\)</span>，但事实上 <span class="arithmatex">\(c_0\)</span> 不存在，不跳了。</p>
<p>我们刚刚找到的 <span class="arithmatex">\(c\)</span> 是 <span class="arithmatex">\(c_7, c_6, c_4\)</span>，事实上这就是 <span class="arithmatex">\(a[1 \ldots 7]\)</span> 拆分出的三个小区间，合并一下，答案是 <span class="arithmatex">\(c_7 + c_6 + c_4\)</span>。</p>
</blockquote>
<p>观察上面的过程，每次往前跳，一定是跳到现区间的左端点的左一位，作为新区间的右端点，这样才能将前缀不重不漏地拆分。比如现在 <span class="arithmatex">\(c_6\)</span> 管的是 <span class="arithmatex">\(a[5 \ldots 6]\)</span>，下一次就跳到 <span class="arithmatex">\(5 - 1 = 4\)</span>，即访问 <span class="arithmatex">\(c_4\)</span>。</p>
<p>我们可以写出查询 <span class="arithmatex">\(a[1 \ldots x]\)</span> 的过程：</p>
<ul>
<li>从 <span class="arithmatex">\(c[x]\)</span> 开始往前跳，有 <span class="arithmatex">\(c[x]\)</span> 管辖 <span class="arithmatex">\(a[x-\operatorname{lowbit}(x)+1 \ldots x]\)</span>；</li>
<li>令 <span class="arithmatex">\(x \gets x - \operatorname{lowbit}(x)\)</span>，如果 <span class="arithmatex">\(x = 0\)</span> 说明已经跳到尽头了，终止循环；否则回到第一步。</li>
<li>将跳到的 <span class="arithmatex">\(c\)</span> 合并。</li>
</ul>
<p>实现时，我们不一定要先把 <span class="arithmatex">\(c\)</span> 都跳出来然后一起合并，可以边跳边合并。</p>
<p>比如我们要维护的信息是和，直接令初始 <span class="arithmatex">\(\mathrm{ans} = 0\)</span>，然后每跳到一个 <span class="arithmatex">\(c[x]\)</span> 就 <span class="arithmatex">\(\mathrm{ans} \gets \mathrm{ans} + c[x]\)</span>，最终 <span class="arithmatex">\(\mathrm{ans}\)</span> 就是所有合并的结果。</p>
<details class="note" open="open">
<summary>实现</summary>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">C++</label><label for="__tabbed_2_2">Python</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span>
<span class="normal"><a href="#__codelineno-2-3">3</a></span>
<span class="normal"><a href="#__codelineno-2-4">4</a></span>
<span class="normal"><a href="#__codelineno-2-5">5</a></span>
<span class="normal"><a href="#__codelineno-2-6">6</a></span>
<span class="normal"><a href="#__codelineno-2-7">7</a></span>
<span class="normal"><a href="#__codelineno-2-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">getsum</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// a[1]..a[x]的和</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">ans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w">    </span><span class="n">ans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ans</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">c</span><span class="p">[</span><span class="n">x</span><span class="p">];</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">lowbit</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">ans</span><span class="p">;</span>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Python</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span>
<span class="normal"><a href="#__codelineno-3-2">2</a></span>
<span class="normal"><a href="#__codelineno-3-3">3</a></span>
<span class="normal"><a href="#__codelineno-3-4">4</a></span>
<span class="normal"><a href="#__codelineno-3-5">5</a></span>
<span class="normal"><a href="#__codelineno-3-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">getsum</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>  <span class="c1"># a[1]..a[x]的和</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a>    <span class="n">ans</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a>    <span class="k">while</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a>        <span class="n">ans</span> <span class="o">=</span> <span class="n">ans</span> <span class="o">+</span> <span class="n">c</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">lowbit</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a>    <span class="k">return</span> <span class="n">ans</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
</details>
<h3 id="_6">树状数组与其树形态的性质<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<p>在讲解单点修改之前，先讲解树状数组的一些基本性质，以及其树形态来源，这有助于更好理解树状数组的单点修改。</p>
<p>我们约定：</p>
<ul>
<li><span class="arithmatex">\(l(x) = x - \operatorname{lowbit}(x) + 1\)</span>。即，<span class="arithmatex">\(l(x)\)</span> 是 <span class="arithmatex">\(c[x]\)</span> 管辖范围的左端点。</li>
<li>对于任意正整数 <span class="arithmatex">\(x\)</span>，总能将 <span class="arithmatex">\(x\)</span> 表示成 <span class="arithmatex">\(s \times 2^{k + 1} + 2^k\)</span> 的形式，其中 <span class="arithmatex">\(\operatorname{lowbit}(x) = 2^k\)</span>。</li>
<li>下面「<span class="arithmatex">\(c[x]\)</span> 和 <span class="arithmatex">\(c[y]\)</span> 不交」指 <span class="arithmatex">\(c[x]\)</span> 的管辖范围和 <span class="arithmatex">\(c[y]\)</span> 的管辖范围不相交，即 <span class="arithmatex">\([l(x), x]\)</span> 和 <span class="arithmatex">\([l(y), y]\)</span> 不相交。「<span class="arithmatex">\(c[x]\)</span> 包含于 <span class="arithmatex">\(c[y]\)</span>」等表述同理。</li>
</ul>
<p><strong>性质 <span class="arithmatex">\(\boldsymbol{1}\)</span>：对于 <span class="arithmatex">\(\boldsymbol{x \le y}\)</span>，要么有 <span class="arithmatex">\(\boldsymbol{c[x]}\)</span> 和 <span class="arithmatex">\(\boldsymbol{c[y]}\)</span> 不交，要么有 <span class="arithmatex">\(\boldsymbol{c[x]}\)</span> 包含于 <span class="arithmatex">\(\boldsymbol{c[y]}\)</span>。</strong></p>
<details class="note">
<summary>证明</summary>
<p>证明：假设 <span class="arithmatex">\(c[x]\)</span> 和 <span class="arithmatex">\(c[y]\)</span> 相交，即 <span class="arithmatex">\([l(x), x]\)</span> 和 <span class="arithmatex">\([l(y), y]\)</span> 相交，则一定有 <span class="arithmatex">\(l(y) \le x \le y\)</span>。</p>
<p>将 <span class="arithmatex">\(y\)</span> 表示为 <span class="arithmatex">\(s \times 2^{k +1} + 2^k\)</span>，则 <span class="arithmatex">\(l(y) = s \times 2^{k + 1} + 1\)</span>。所以，<span class="arithmatex">\(x\)</span> 可以表示为 <span class="arithmatex">\(s \times 2^{k +1} + b\)</span>，其中 <span class="arithmatex">\(1 \le b \le 2^k\)</span>。</p>
<p>不难发现 <span class="arithmatex">\(\operatorname{lowbit}(x) = \operatorname{lowbit}(b)\)</span>。又因为 <span class="arithmatex">\(b - \operatorname{lowbit}(b) \ge 0\)</span>，</p>
<p>所以 <span class="arithmatex">\(l(x) = x - \operatorname{lowbit}(x) + 1 = s \times 2^{k +1} + b - \operatorname{lowbit}(b) +1 \ge s \times 2^{k +1} + 1 = l(y)\)</span>，即 <span class="arithmatex">\(l(y) \le l(x) \le x \le y\)</span>。</p>
<p>所以，如果 <span class="arithmatex">\(c[x]\)</span> 和 <span class="arithmatex">\(c[y]\)</span> 相交，那么 <span class="arithmatex">\(c[x]\)</span> 的管辖范围一定完全包含于 <span class="arithmatex">\(c[y]\)</span>。</p>
</details>
<p><strong>性质 <span class="arithmatex">\(\boldsymbol{2}\)</span>：<span class="arithmatex">\(\boldsymbol{c[x]}\)</span> 真包含于 <span class="arithmatex">\(\boldsymbol{c[x + \operatorname{lowbit}(x)]}\)</span>。</strong></p>
<details class="note">
<summary>证明</summary>
<p>证明：设 <span class="arithmatex">\(y = x + \operatorname{lowbit}(x)\)</span>，<span class="arithmatex">\(x = s \times 2^{k + 1} + 2^k\)</span>，则 <span class="arithmatex">\(y = (s + 1) \times 2^{k +1}\)</span>，<span class="arithmatex">\(l(x) = s \times 2^{k + 1} + 1\)</span>。</p>
<p>不难发现 <span class="arithmatex">\(\operatorname{lowbit}(y) \ge 2^{k + 1}\)</span>，所以 <span class="arithmatex">\(l(y) = (s + 1) \times 2^{k + 1} - \operatorname{lowbit}(y) + 1 \le s \times 2^{k +1} + 1= l(x)\)</span>，即 <span class="arithmatex">\(l(y) \le l(x) \le x &lt; y\)</span>。</p>
<p>所以，<span class="arithmatex">\(c[x]\)</span> 真包含于 <span class="arithmatex">\(c[x + \operatorname{lowbit}(x)]\)</span>。</p>
</details>
<p><strong>性质 <span class="arithmatex">\(3\)</span>：对于任意 <span class="arithmatex">\(\boldsymbol{x &lt; y &lt; x + \operatorname{lowbit}(x)}\)</span>，有 <span class="arithmatex">\(\boldsymbol{c[x]}\)</span> 和 <span class="arithmatex">\(\boldsymbol{c[y]}\)</span> 不交。</strong></p>
<details class="note">
<summary>证明</summary>
<p>证明：设 <span class="arithmatex">\(x = s \times 2^{k + 1} + 2^k\)</span>，则 <span class="arithmatex">\(y = x + b = s \times 2^{k + 1} + 2^k + b\)</span>，其中 <span class="arithmatex">\(1 \le b &lt; 2^k\)</span>。</p>
<p>不难发现 <span class="arithmatex">\(\operatorname{lowbit}(y) = \operatorname{lowbit}(b)\)</span>。又因为 <span class="arithmatex">\(b - \operatorname{lowbit}(b) \ge 0\)</span>，</p>
<p>因此 <span class="arithmatex">\(l(y) = y - \operatorname{lowbit}(y) + 1 = x + b - \operatorname{lowbit}(b) + 1 &gt; x\)</span>，即 <span class="arithmatex">\(l(x) \le x &lt; l(y) \le y\)</span>。</p>
<p>所以，<span class="arithmatex">\(c[x]\)</span> 和 <span class="arithmatex">\(c[y]\)</span> 不交。</p>
</details>
<p>有了这三条性质的铺垫，我们接下来看树状数组的树形态（请忽略 <span class="arithmatex">\(a\)</span> 向 <span class="arithmatex">\(c\)</span> 的连边）。</p>
<p><img alt="" src="../images/fenwick.svg" /></p>
<p>事实上，树状数组的树形态是 <span class="arithmatex">\(x\)</span> 向 <span class="arithmatex">\(x + \operatorname{lowbit}(x)\)</span> 连边得到的图，其中 <span class="arithmatex">\(x + \operatorname{lowbit}(x)\)</span> 是 <span class="arithmatex">\(x\)</span> 的父亲。</p>
<p>注意，在考虑树状数组的树形态时，我们不考虑树状数组大小的影响，即我们认为这是一棵无限大的树，方便分析。实际实现时，我们只需用到 <span class="arithmatex">\(x \le n\)</span> 的 <span class="arithmatex">\(c[x]\)</span>，其中 <span class="arithmatex">\(n\)</span> 是原数组长度。</p>
<p>这棵树天然满足了很多美好性质，下面列举若干（设 <span class="arithmatex">\(fa[u]\)</span> 表示 <span class="arithmatex">\(u\)</span> 的直系父亲）：</p>
<ul>
<li><span class="arithmatex">\(u &lt; fa[u]\)</span>。</li>
<li><span class="arithmatex">\(u\)</span> 大于任何一个 <span class="arithmatex">\(u\)</span> 的后代，小于任何一个 <span class="arithmatex">\(u\)</span> 的祖先。</li>
<li>点 <span class="arithmatex">\(u\)</span> 的 <span class="arithmatex">\(\operatorname{lowbit}\)</span> 严格小于 <span class="arithmatex">\(fa[u]\)</span> 的 <span class="arithmatex">\(\operatorname{lowbit}\)</span>。</li>
</ul>
<details class="note">
<summary>证明</summary>
<p>设 <span class="arithmatex">\(y = x + \operatorname{lowbit}(x)\)</span>，<span class="arithmatex">\(x = s \times 2^{k + 1} + 2^k\)</span>，则 <span class="arithmatex">\(y = (s + 1) \times 2^{k +1}\)</span>，不难发现 <span class="arithmatex">\(\operatorname{lowbit}(y) \ge 2^{k + 1} &gt; \operatorname{lowbit}(x)\)</span>，证毕。</p>
</details>
<ul>
<li>点 <span class="arithmatex">\(x\)</span> 的高度是 <span class="arithmatex">\(\log_2\operatorname{lowbit}(x)\)</span>，即 <span class="arithmatex">\(x\)</span> 二进制最低位 <code>1</code> 的位数。</li>
</ul>
<details class="note">
<summary>高度的定义</summary>
<p>点 <span class="arithmatex">\(x\)</span> 的高度 <span class="arithmatex">\(h(x)\)</span> 满足：如果 <span class="arithmatex">\(x \bmod 2 = 1\)</span>，则 <span class="arithmatex">\(h(x) = 0\)</span>，否则 <span class="arithmatex">\(h(x) = \max(h(y)) + 1\)</span>，其中 <span class="arithmatex">\(y\)</span> 代表 <span class="arithmatex">\(x\)</span> 的所有儿子（此时 <span class="arithmatex">\(x\)</span> 至少存在一个儿子 <span class="arithmatex">\(x - 1\)</span>）。</p>
<p>也就是说，一个点的高度恰好比它最高的那个儿子再高 <span class="arithmatex">\(1\)</span>。如果一个点没有儿子，它的高度是 <span class="arithmatex">\(0\)</span>。</p>
<p>这里引出高度这一概念，是为后面解释复杂度更方便。</p>
</details>
<ul>
<li><span class="arithmatex">\(c[u]\)</span> 真包含于 <span class="arithmatex">\(c[fa[u]]\)</span>（性质 <span class="arithmatex">\(2\)</span>）。</li>
<li><span class="arithmatex">\(c[u]\)</span> 真包含于 <span class="arithmatex">\(c[v]\)</span>，其中 <span class="arithmatex">\(v\)</span> 是 <span class="arithmatex">\(u\)</span> 的任一祖先（在上一条性质上归纳）。</li>
<li><span class="arithmatex">\(c[u]\)</span> 真包含 <span class="arithmatex">\(c[v]\)</span>，其中 <span class="arithmatex">\(v\)</span> 是 <span class="arithmatex">\(u\)</span> 的任一后代（上面那条性质 <span class="arithmatex">\(u\)</span>，<span class="arithmatex">\(v\)</span> 颠倒）。</li>
<li>对于任意 <span class="arithmatex">\(v' &gt; u\)</span>，若 <span class="arithmatex">\(v'\)</span> 不是 <span class="arithmatex">\(u\)</span> 的祖先，则 <span class="arithmatex">\(c[u]\)</span> 和 <span class="arithmatex">\(c[v']\)</span> 不交。</li>
</ul>
<details class="note">
<summary>证明</summary>
<p><span class="arithmatex">\(u\)</span> 和 <span class="arithmatex">\(u\)</span> 的祖先中，一定存在一个点 <span class="arithmatex">\(v\)</span> 使得 <span class="arithmatex">\(v &lt; v' &lt; fa[v]\)</span>，根据性质 <span class="arithmatex">\(3\)</span> 得 <span class="arithmatex">\(c[v']\)</span> 不相交于 <span class="arithmatex">\(c[v]\)</span>，而 <span class="arithmatex">\(c[v]\)</span> 包含 <span class="arithmatex">\(c[u]\)</span>，因此 <span class="arithmatex">\(c[v']\)</span> 不交于 <span class="arithmatex">\(c[u]\)</span>。</p>
</details>
<ul>
<li>对于任意 <span class="arithmatex">\(v &lt; u\)</span>，如果 <span class="arithmatex">\(v\)</span> 不在 <span class="arithmatex">\(u\)</span> 的子树上，则 <span class="arithmatex">\(c[u]\)</span> 和 <span class="arithmatex">\(c[v]\)</span> 不交（上面那条性质 <span class="arithmatex">\(u\)</span>，<span class="arithmatex">\(v'\)</span> 颠倒）。</li>
<li>对于任意 <span class="arithmatex">\(v &gt; u\)</span>，当且仅当 <span class="arithmatex">\(v\)</span> 是 <span class="arithmatex">\(u\)</span> 的祖先，<span class="arithmatex">\(c[u]\)</span> 真包含于 <span class="arithmatex">\(c[v]\)</span>（上面几条性质的总结）。这就是树状数组单点修改的核心原理。</li>
<li>设 <span class="arithmatex">\(u = s \times 2^{k + 1} + 2^k\)</span>，则其儿子数量为 <span class="arithmatex">\(k = \log_2\operatorname{lowbit}(u)\)</span>，编号分别为 <span class="arithmatex">\(u - 2^t(0 \le t &lt; k)\)</span>。<ul>
<li>举例：假设 <span class="arithmatex">\(k = 3\)</span>，<span class="arithmatex">\(u\)</span> 的二进制编号为 <code>...1000</code>，则 <span class="arithmatex">\(u\)</span> 有三个儿子，二进制编号分别为 <code>...0111</code>、<code>...0110</code>、<code>...0100</code>。</li>
</ul>
</li>
</ul>
<details class="note">
<summary>证明</summary>
<p>在一个数 <span class="arithmatex">\(x\)</span> 的基础上减去 <span class="arithmatex">\(2^t\)</span>，<span class="arithmatex">\(x\)</span> 二进制第 <span class="arithmatex">\(t\)</span> 位会反转，而更低的位保持不变。</p>
<p>考虑 <span class="arithmatex">\(u\)</span> 的儿子 <span class="arithmatex">\(v\)</span>，有 <span class="arithmatex">\(v + \operatorname{lowbit}(v) = u\)</span>，即 <span class="arithmatex">\(v = u - 2^t\)</span> 且 <span class="arithmatex">\(\operatorname{lowbit}(v) = 2^t\)</span>。设 <span class="arithmatex">\(u = s \times 2^{k + 1} + 2^k\)</span>。</p>
<p><strong>考虑 <span class="arithmatex">\(\boldsymbol{0 \le t &lt; k}\)</span></strong>，<span class="arithmatex">\(u\)</span> 的第 <span class="arithmatex">\(t\)</span> 位及后方均为 <span class="arithmatex">\(0\)</span>，所以 <span class="arithmatex">\(v = u - 2^t\)</span> 的第 <span class="arithmatex">\(t\)</span> 位变为 <span class="arithmatex">\(1\)</span>，后面仍为 <span class="arithmatex">\(0\)</span>，<strong>满足</strong> <span class="arithmatex">\(\operatorname{lowbit}(v) = 2^t\)</span>。</p>
<p><strong>考虑 <span class="arithmatex">\(\boldsymbol{t = k}\)</span></strong>，则 <span class="arithmatex">\(v = u - 2^k\)</span>，<span class="arithmatex">\(v\)</span> 的第 <span class="arithmatex">\(k\)</span> 位变为 <span class="arithmatex">\(0\)</span>，<strong>不满足</strong> <span class="arithmatex">\(\operatorname{lowbit}(v) = 2^t\)</span>。</p>
<p><strong>考虑 <span class="arithmatex">\(\boldsymbol{t &gt; k}\)</span></strong>，则 <span class="arithmatex">\(v = u - 2^t\)</span>，<span class="arithmatex">\(v\)</span> 的第 <span class="arithmatex">\(k\)</span> 位是 <span class="arithmatex">\(1\)</span>，所以 <span class="arithmatex">\(\operatorname{lowbit}(v) = 2^k\)</span>，<strong>不满足</strong> <span class="arithmatex">\(\operatorname{lowbit}(v) = 2^t\)</span>。</p>
</details>
<ul>
<li><span class="arithmatex">\(u\)</span> 的所有儿子对应 <span class="arithmatex">\(c\)</span> 的管辖区间恰好拼接成 <span class="arithmatex">\([l(u), u - 1]\)</span>。<ul>
<li>举例：假设 <span class="arithmatex">\(k = 3\)</span>，<span class="arithmatex">\(u\)</span> 的二进制编号为 <code>...1000</code>，则 <span class="arithmatex">\(u\)</span> 有三个儿子，二进制编号分别为 <code>...0111</code>、<code>...0110</code>、<code>...0100</code>。</li>
<li><code>c[...0100]</code> 表示 <code>a[...0001 ~ ...0100]</code>。</li>
<li><code>c[...0110]</code> 表示 <code>a[...0101 ~ ...0110]</code>。</li>
<li><code>c[...0111]</code> 表示 <code>a[...0111 ~ ...0111]</code>。</li>
<li>不难发现上面是三个管辖区间的并集恰好是 <code>a[...0001 ~ ...0111]</code>，即 <span class="arithmatex">\([l(u), u - 1]\)</span>。</li>
</ul>
</li>
</ul>
<details class="note">
<summary>证明</summary>
<p><span class="arithmatex">\(u\)</span> 的儿子总能表示成 <span class="arithmatex">\(u - 2^t(0 \le t &lt; k)\)</span>，不难发现，<span class="arithmatex">\(t\)</span> 越小，<span class="arithmatex">\(u - 2^t\)</span> 越大，代表的区间越靠右。我们设 <span class="arithmatex">\(f(t) = u - 2^t\)</span>，则 <span class="arithmatex">\(f(k - 1), f(k - 2), \ldots, f(0)\)</span> 分别构成 <span class="arithmatex">\(u\)</span> 从左到右的儿子。</p>
<p>不难发现 <span class="arithmatex">\(\operatorname{lowbit}(f(t)) = 2^t\)</span>，所以 <span class="arithmatex">\(l(f(t)) = u - 2^t - 2^t + 1 = u - 2^{t + 1} + 1\)</span>。</p>
<p>考虑相邻的两个儿子 <span class="arithmatex">\(f(t + 1)\)</span> 和 <span class="arithmatex">\(f(t)\)</span>。前者管辖区间的右端点是 <span class="arithmatex">\(f(t + 1) = u - 2^{t + 1}\)</span>，后者管辖区间的左端点是 <span class="arithmatex">\(l(f(t)) = u - 2^{t + 1} + 1\)</span>，恰好相接。</p>
<p>考虑最左面的儿子 <span class="arithmatex">\(f(k - 1)\)</span>，其管辖左边界 <span class="arithmatex">\(l(f(k - 1)) = u - 2^k + 1\)</span> 恰为 <span class="arithmatex">\(l(u)\)</span>。</p>
<p>考虑最右面的儿子 <span class="arithmatex">\(f(0)\)</span>，其管辖右边界就是 <span class="arithmatex">\(u - 1\)</span>。</p>
<p>因此，这些儿子的管辖区间可以恰好拼成 <span class="arithmatex">\([l(u), u - 1]\)</span>。</p>
</details>
<h3 id="_7">单点修改<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<p>现在来考虑如何单点修改 <span class="arithmatex">\(a[x]\)</span>。</p>
<p>我们的目标是快速正确地维护 <span class="arithmatex">\(c\)</span> 数组。为保证效率，我们只需遍历并修改管辖了 <span class="arithmatex">\(a[x]\)</span> 的所有 <span class="arithmatex">\(c[y]\)</span>，因为其他的 <span class="arithmatex">\(c\)</span> 显然没有发生变化。</p>
<p>管辖 <span class="arithmatex">\(a[x]\)</span> 的 <span class="arithmatex">\(c[y]\)</span> 一定包含 <span class="arithmatex">\(c[x]\)</span>（根据性质 <span class="arithmatex">\(1\)</span>），所以 <span class="arithmatex">\(y\)</span> 在树状数组树形态上是 <span class="arithmatex">\(x\)</span> 的祖先。因此我们从 <span class="arithmatex">\(x\)</span> 开始不断跳父亲，直到跳得超过了原数组长度为止。</p>
<p>设 <span class="arithmatex">\(n\)</span> 表示 <span class="arithmatex">\(a\)</span> 的大小，不难写出单点修改 <span class="arithmatex">\(a[x]\)</span> 的过程：</p>
<ul>
<li>初始令 <span class="arithmatex">\(x' = x\)</span>。</li>
<li>修改 <span class="arithmatex">\(c[x']\)</span>。</li>
<li>令 <span class="arithmatex">\(x' \gets x' + \operatorname{lowbit}(x')\)</span>，如果 <span class="arithmatex">\(x' &gt; n\)</span> 说明已经跳到尽头了，终止循环；否则回到第二步。</li>
</ul>
<p>区间信息和单点修改的种类，共同决定 <span class="arithmatex">\(c[x']\)</span> 的修改方式。下面给几个例子：</p>
<ul>
<li>若 <span class="arithmatex">\(c[x']\)</span> 维护区间和，修改种类是将 <span class="arithmatex">\(a[x]\)</span> 加上 <span class="arithmatex">\(p\)</span>，则修改方式则是将所有 <span class="arithmatex">\(c[x']\)</span> 也加上 <span class="arithmatex">\(p\)</span>。</li>
<li>若 <span class="arithmatex">\(c[x']\)</span> 维护区间积，修改种类是将 <span class="arithmatex">\(a[x]\)</span> 乘上 <span class="arithmatex">\(p\)</span>，则修改方式则是将所有 <span class="arithmatex">\(c[x']\)</span> 也乘上 <span class="arithmatex">\(p\)</span>。</li>
</ul>
<p>然而，单点修改的自由性使得修改的种类和维护的信息不一定是同种运算，比如，若 <span class="arithmatex">\(c[x']\)</span> 维护区间和，修改种类是将 <span class="arithmatex">\(a[x]\)</span> 赋值为 <span class="arithmatex">\(p\)</span>，可以考虑转化为将 <span class="arithmatex">\(a[x]\)</span> 加上 <span class="arithmatex">\(p - a[x]\)</span>。如果是将 <span class="arithmatex">\(a[x]\)</span> 乘上 <span class="arithmatex">\(p\)</span>，就考虑转化为 <span class="arithmatex">\(a[x]\)</span> 加上 <span class="arithmatex">\(a[x] \times p - a[x]\)</span>。</p>
<p>下面以维护区间和，单点加为例给出实现。</p>
<details class="note" open="open">
<summary>实现</summary>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">C++</label><label for="__tabbed_3_2">Python</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span>
<span class="normal"><a href="#__codelineno-4-2">2</a></span>
<span class="normal"><a href="#__codelineno-4-3">3</a></span>
<span class="normal"><a href="#__codelineno-4-4">4</a></span>
<span class="normal"><a href="#__codelineno-4-5">5</a></span>
<span class="normal"><a href="#__codelineno-4-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">// 不能越界</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="w">    </span><span class="n">c</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">c</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">k</span><span class="p">;</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">lowbit</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Python</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span>
<span class="normal"><a href="#__codelineno-5-2">2</a></span>
<span class="normal"><a href="#__codelineno-5-3">3</a></span>
<span class="normal"><a href="#__codelineno-5-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a>    <span class="k">while</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">:</span>  <span class="c1"># 不能越界</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a>        <span class="n">c</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">+</span> <span class="n">k</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">lowbit</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
</details>
<h3 id="_8">建树<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h3>
<p>也就是根据最开始给出的序列，将树状数组建出来（<span class="arithmatex">\(c\)</span> 全部预处理好）。</p>
<p>一般可以直接转化为 <span class="arithmatex">\(n\)</span> 次单点修改，时间复杂度 <span class="arithmatex">\(\Theta(n \log n)\)</span>（复杂度分析在后面）。</p>
<p>比如给定序列 <span class="arithmatex">\(a = (5, 1, 4)\)</span> 要求建树，直接看作对 <span class="arithmatex">\(a[1]\)</span> 单点加 <span class="arithmatex">\(5\)</span>，对 <span class="arithmatex">\(a[2]\)</span> 单点加 <span class="arithmatex">\(1\)</span>，对 <span class="arithmatex">\(a[3]\)</span> 单点加 <span class="arithmatex">\(4\)</span> 即可。</p>
<p>也有 <span class="arithmatex">\(\Theta(n)\)</span> 的建树方法，见本页面 <a href="#thetan-建树"><span class="arithmatex">\(\Theta(n)\)</span> 建树</a> 一节。</p>
<h3 id="_9">复杂度分析<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<p>空间复杂度显然 <span class="arithmatex">\(\Theta(n)\)</span>。</p>
<p>时间复杂度：</p>
<ul>
<li>对于区间查询操作：整个 <span class="arithmatex">\(x \gets x - \operatorname{lowbit}(x)\)</span> 的迭代过程，可看做将 <span class="arithmatex">\(x\)</span> 二进制中的所有 <span class="arithmatex">\(1\)</span>，从低位到高位逐渐改成 <span class="arithmatex">\(0\)</span> 的过程，拆分出的区间数等于 <span class="arithmatex">\(x\)</span> 二进制中 <span class="arithmatex">\(1\)</span> 的数量（即 <span class="arithmatex">\(\operatorname{popcount}(x)\)</span>）。因此，单次查询时间复杂度是 <span class="arithmatex">\(\Theta(\log n)\)</span>；</li>
<li>对于单点修改操作：跳父亲时，访问到的高度一直严格增加，且始终有 <span class="arithmatex">\(x \le n\)</span>。由于点 <span class="arithmatex">\(x\)</span> 的高度是 <span class="arithmatex">\(\log_2\operatorname{lowbit}(x)\)</span>，所以跳到的高度不会超过 <span class="arithmatex">\(\log_2n\)</span>，所以访问到的 <span class="arithmatex">\(c\)</span> 的数量是 <span class="arithmatex">\(\log n\)</span> 级别。因此，单次单点修改复杂度是 <span class="arithmatex">\(\Theta(\log n)\)</span>。</li>
</ul>
<h2 id="_10">区间加区间和<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h2>
<p>前置知识：<a href="../../basic/prefix-sum/">前缀和 &amp; 差分</a>。</p>
<p>该问题可以使用两个树状数组维护差分数组解决。</p>
<p>考虑序列 <span class="arithmatex">\(a\)</span> 的差分数组 <span class="arithmatex">\(d\)</span>，其中 <span class="arithmatex">\(d[i] = a[i] - a[i - 1]\)</span>。由于差分数组的前缀和就是原数组，所以 <span class="arithmatex">\(a_i=\sum_{j=1}^i d_j\)</span>。</p>
<p>一样地，我们考虑将查询区间和通过差分转化为查询前缀和。那么考虑查询 <span class="arithmatex">\(a[1 \ldots r]\)</span> 的和，即 <span class="arithmatex">\(\sum_{i=1}^{r} a_i\)</span>，进行推导：</p>
<div class="arithmatex">\[
\begin{aligned}
&amp;\sum_{i=1}^{r} a_i\\=&amp;\sum_{i=1}^r\sum_{j=1}^i d_j
\end{aligned}
\]</div>
<p>观察这个式子，不难发现每个 <span class="arithmatex">\(d_j\)</span> 总共被加了 <span class="arithmatex">\(r - j + 1\)</span> 次。接着推导：</p>
<div class="arithmatex">\[
\begin{aligned}
&amp;\sum_{i=1}^r\sum_{j=1}^i d_j\\=&amp;\sum_{i=1}^r d_i\times(r-i+1)
\\=&amp;\sum_{i=1}^r d_i\times (r+1)-\sum_{i=1}^r d_i\times i
\end{aligned}
\]</div>
<p><span class="arithmatex">\(\sum_{i=1}^r d_i\)</span> 并不能推出 <span class="arithmatex">\(\sum_{i=1}^r d_i \times i\)</span> 的值，所以要用两个树状数组分别维护 <span class="arithmatex">\(d_i\)</span> 和 <span class="arithmatex">\(d_i \times i\)</span> 的和信息。</p>
<p>那么怎么做区间加呢？考虑给原数组 <span class="arithmatex">\(a[l \ldots r]\)</span> 区间加 <span class="arithmatex">\(x\)</span> 给 <span class="arithmatex">\(d\)</span> 带来的影响。</p>
<p>因为差分是 <span class="arithmatex">\(d[i] = a[i] - a[i - 1]\)</span>，</p>
<ul>
<li><span class="arithmatex">\(a[l]\)</span> 多了 <span class="arithmatex">\(v\)</span> 而 <span class="arithmatex">\(a[l - 1]\)</span> 不变，所以 <span class="arithmatex">\(d[l]\)</span> 的值多了 <span class="arithmatex">\(v\)</span>。</li>
<li><span class="arithmatex">\(a[r + 1]\)</span> 不变而 <span class="arithmatex">\(a[r]\)</span> 多了 <span class="arithmatex">\(v\)</span>，所以 <span class="arithmatex">\(d[r + 1]\)</span> 的值少了 <span class="arithmatex">\(v\)</span>。</li>
<li>对于不等于 <span class="arithmatex">\(l\)</span> 且不等于 <span class="arithmatex">\(r+1\)</span> 的任意 <span class="arithmatex">\(i\)</span>，<span class="arithmatex">\(a[i]\)</span> 和 <span class="arithmatex">\(a[i - 1]\)</span> 要么都没发生变化，要么都加了 <span class="arithmatex">\(v\)</span>，<span class="arithmatex">\(a[i] + v - (a[i - 1] + v)\)</span> 还是 <span class="arithmatex">\(a[i] - a[i - 1]\)</span>，所以其它的 <span class="arithmatex">\(d[i]\)</span> 均不变。</li>
</ul>
<p>那就不难想到维护方式了：对于维护 <span class="arithmatex">\(d_i\)</span> 的树状数组，对 <span class="arithmatex">\(l\)</span> 单点加 <span class="arithmatex">\(v\)</span>，<span class="arithmatex">\(r + 1\)</span> 单点加 <span class="arithmatex">\(-v\)</span>；对于维护 <span class="arithmatex">\(d_i \times i\)</span> 的树状数组，对 <span class="arithmatex">\(l\)</span> 单点加 <span class="arithmatex">\(v \times l\)</span>，<span class="arithmatex">\(r + 1\)</span> 单点加 <span class="arithmatex">\(-v \times (r + 1)\)</span>。</p>
<p>而更弱的问题，「区间加求单点值」，只需用树状数组维护一个差分数组 <span class="arithmatex">\(d_i\)</span>。询问 <span class="arithmatex">\(a[x]\)</span> 的单点值，直接求 <span class="arithmatex">\(d[1 \ldots x]\)</span> 的和即可。</p>
<p>这里直接给出「区间加区间和」的代码：</p>
<details class="note" open="open">
<summary>实现</summary>
<div class="tabbed-set tabbed-alternate" data-tabs="4:2"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><input id="__tabbed_4_2" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">C++</label><label for="__tabbed_4_2">Python</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span>
<span class="normal"><a href="#__codelineno-6-11">11</a></span>
<span class="normal"><a href="#__codelineno-6-12">12</a></span>
<span class="normal"><a href="#__codelineno-6-13">13</a></span>
<span class="normal"><a href="#__codelineno-6-14">14</a></span>
<span class="normal"><a href="#__codelineno-6-15">15</a></span>
<span class="normal"><a href="#__codelineno-6-16">16</a></span>
<span class="normal"><a href="#__codelineno-6-17">17</a></span>
<span class="normal"><a href="#__codelineno-6-18">18</a></span>
<span class="normal"><a href="#__codelineno-6-19">19</a></span>
<span class="normal"><a href="#__codelineno-6-20">20</a></span>
<span class="normal"><a href="#__codelineno-6-21">21</a></span>
<span class="normal"><a href="#__codelineno-6-22">22</a></span>
<span class="normal"><a href="#__codelineno-6-23">23</a></span>
<span class="normal"><a href="#__codelineno-6-24">24</a></span>
<span class="normal"><a href="#__codelineno-6-25">25</a></span>
<span class="normal"><a href="#__codelineno-6-26">26</a></span>
<span class="normal"><a href="#__codelineno-6-27">27</a></span>
<span class="normal"><a href="#__codelineno-6-28">28</a></span>
<span class="normal"><a href="#__codelineno-6-29">29</a></span>
<span class="normal"><a href="#__codelineno-6-30">30</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">t1</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span><span class="w"> </span><span class="n">t2</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="kt">int</span><span class="w"> </span><span class="nf">lowbit</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="kt">void</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">v1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">v</span><span class="p">;</span>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="w">    </span><span class="n">t1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">t2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">v1</span><span class="p">;</span>
<a id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="w">    </span><span class="c1">// 注意不能写成 t2[k] += k * v，因为 k 的值已经不是原数组的下标了</span>
<a id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="w">    </span><span class="n">k</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">lowbit</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
<a id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="p">}</span>
<a id="__codelineno-6-13" name="__codelineno-6-13"></a>
<a id="__codelineno-6-14" name="__codelineno-6-14"></a><span class="kt">int</span><span class="w"> </span><span class="nf">getsum</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">t</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-15" name="__codelineno-6-15"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-6-16" name="__codelineno-6-16"></a><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-17" name="__codelineno-6-17"></a><span class="w">    </span><span class="n">ret</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">];</span>
<a id="__codelineno-6-18" name="__codelineno-6-18"></a><span class="w">    </span><span class="n">k</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">lowbit</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
<a id="__codelineno-6-19" name="__codelineno-6-19"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-6-20" name="__codelineno-6-20"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span>
<a id="__codelineno-6-21" name="__codelineno-6-21"></a><span class="p">}</span>
<a id="__codelineno-6-22" name="__codelineno-6-22"></a>
<a id="__codelineno-6-23" name="__codelineno-6-23"></a><span class="kt">void</span><span class="w"> </span><span class="nf">add1</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-24" name="__codelineno-6-24"></a><span class="w">  </span><span class="n">add</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="p">),</span><span class="w"> </span><span class="n">add</span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">v</span><span class="p">);</span><span class="w">  </span><span class="c1">// 将区间加差分为两个前缀加</span>
<a id="__codelineno-6-25" name="__codelineno-6-25"></a><span class="p">}</span>
<a id="__codelineno-6-26" name="__codelineno-6-26"></a>
<a id="__codelineno-6-27" name="__codelineno-6-27"></a><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="nf">getsum1</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-28" name="__codelineno-6-28"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1l</span><span class="n">l</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">getsum</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1l</span><span class="n">l</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">getsum</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">-</span>
<a id="__codelineno-6-29" name="__codelineno-6-29"></a><span class="w">         </span><span class="p">(</span><span class="n">getsum</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">getsum</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">));</span>
<a id="__codelineno-6-30" name="__codelineno-6-30"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Python</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span>
<span class="normal"><a href="#__codelineno-7-11">11</a></span>
<span class="normal"><a href="#__codelineno-7-12">12</a></span>
<span class="normal"><a href="#__codelineno-7-13">13</a></span>
<span class="normal"><a href="#__codelineno-7-14">14</a></span>
<span class="normal"><a href="#__codelineno-7-15">15</a></span>
<span class="normal"><a href="#__codelineno-7-16">16</a></span>
<span class="normal"><a href="#__codelineno-7-17">17</a></span>
<span class="normal"><a href="#__codelineno-7-18">18</a></span>
<span class="normal"><a href="#__codelineno-7-19">19</a></span>
<span class="normal"><a href="#__codelineno-7-20">20</a></span>
<span class="normal"><a href="#__codelineno-7-21">21</a></span>
<span class="normal"><a href="#__codelineno-7-22">22</a></span>
<span class="normal"><a href="#__codelineno-7-23">23</a></span>
<span class="normal"><a href="#__codelineno-7-24">24</a></span>
<span class="normal"><a href="#__codelineno-7-25">25</a></span>
<span class="normal"><a href="#__codelineno-7-26">26</a></span>
<span class="normal"><a href="#__codelineno-7-27">27</a></span>
<span class="normal"><a href="#__codelineno-7-28">28</a></span>
<span class="normal"><a href="#__codelineno-7-29">29</a></span>
<span class="normal"><a href="#__codelineno-7-30">30</a></span>
<span class="normal"><a href="#__codelineno-7-31">31</a></span>
<span class="normal"><a href="#__codelineno-7-32">32</a></span>
<span class="normal"><a href="#__codelineno-7-33">33</a></span>
<span class="normal"><a href="#__codelineno-7-34">34</a></span>
<span class="normal"><a href="#__codelineno-7-35">35</a></span>
<span class="normal"><a href="#__codelineno-7-36">36</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="n">t1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">MAXN</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="n">t2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">MAXN</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="k">def</span><span class="w"> </span><span class="nf">lowbit</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a>    <span class="k">return</span> <span class="n">x</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">-</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-7-8" name="__codelineno-7-8"></a>
<a id="__codelineno-7-9" name="__codelineno-7-9"></a>
<a id="__codelineno-7-10" name="__codelineno-7-10"></a><span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
<a id="__codelineno-7-11" name="__codelineno-7-11"></a>    <span class="n">v1</span> <span class="o">=</span> <span class="n">k</span> <span class="o">*</span> <span class="n">v</span>
<a id="__codelineno-7-12" name="__codelineno-7-12"></a>    <span class="k">while</span> <span class="n">k</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">:</span>
<a id="__codelineno-7-13" name="__codelineno-7-13"></a>        <span class="n">t1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">t1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">v</span>
<a id="__codelineno-7-14" name="__codelineno-7-14"></a>        <span class="n">t2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">t2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">v1</span>
<a id="__codelineno-7-15" name="__codelineno-7-15"></a>        <span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="n">lowbit</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a id="__codelineno-7-16" name="__codelineno-7-16"></a>
<a id="__codelineno-7-17" name="__codelineno-7-17"></a>
<a id="__codelineno-7-18" name="__codelineno-7-18"></a><span class="k">def</span><span class="w"> </span><span class="nf">getsum</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<a id="__codelineno-7-19" name="__codelineno-7-19"></a>    <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-7-20" name="__codelineno-7-20"></a>    <span class="k">while</span> <span class="n">k</span><span class="p">:</span>
<a id="__codelineno-7-21" name="__codelineno-7-21"></a>        <span class="n">ret</span> <span class="o">=</span> <span class="n">ret</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
<a id="__codelineno-7-22" name="__codelineno-7-22"></a>        <span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">-</span> <span class="n">lowbit</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a id="__codelineno-7-23" name="__codelineno-7-23"></a>    <span class="k">return</span> <span class="n">ret</span>
<a id="__codelineno-7-24" name="__codelineno-7-24"></a>
<a id="__codelineno-7-25" name="__codelineno-7-25"></a>
<a id="__codelineno-7-26" name="__codelineno-7-26"></a><span class="k">def</span><span class="w"> </span><span class="nf">add1</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
<a id="__codelineno-7-27" name="__codelineno-7-27"></a>    <span class="n">add</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
<a id="__codelineno-7-28" name="__codelineno-7-28"></a>    <span class="n">add</span><span class="p">(</span><span class="n">r</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="n">v</span><span class="p">)</span>
<a id="__codelineno-7-29" name="__codelineno-7-29"></a>
<a id="__codelineno-7-30" name="__codelineno-7-30"></a>
<a id="__codelineno-7-31" name="__codelineno-7-31"></a><span class="k">def</span><span class="w"> </span><span class="nf">getsum1</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
<a id="__codelineno-7-32" name="__codelineno-7-32"></a>    <span class="k">return</span> <span class="p">(</span>
<a id="__codelineno-7-33" name="__codelineno-7-33"></a>        <span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">*</span> <span class="n">getsum</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
<a id="__codelineno-7-34" name="__codelineno-7-34"></a>        <span class="o">-</span> <span class="n">l</span> <span class="o">*</span> <span class="n">getsum</span><span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">l</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-7-35" name="__codelineno-7-35"></a>        <span class="o">-</span> <span class="p">(</span><span class="n">getsum</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">getsum</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span> <span class="n">l</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-7-36" name="__codelineno-7-36"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
</details>
<p>根据这个原理，应该可以实现「区间乘区间积」，「区间异或一个数，求区间异或值」等，只要满足维护的信息和区间操作是同种运算即可，感兴趣的读者可以自己尝试。</p>
<h2 id="_11">二维树状数组<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h2>
<h3 id="_12">单点修改，子矩阵查询<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h3>
<p>二维树状数组，也被称作树状数组套树状数组，用来维护二维数组上的单点修改和前缀信息问题。</p>
<p>与一维树状数组类似，我们用 <span class="arithmatex">\(c(x, y)\)</span> 表示 <span class="arithmatex">\(a(x - \operatorname{lowbit}(x) + 1, y - \operatorname{lowbit}(y) + 1) \ldots a(x, y)\)</span> 的矩阵总信息，即一个以 <span class="arithmatex">\(a(x, y)\)</span> 为右下角，高 <span class="arithmatex">\(\operatorname{lowbit}(x)\)</span>，宽 <span class="arithmatex">\(\operatorname{lowbit}(y)\)</span> 的矩阵的总信息。</p>
<p>对于单点修改，设：</p>
<div class="arithmatex">\[
f(x, i) = \begin{cases}x &amp;i = 0\\f(x, i - 1) + \operatorname{lowbit}(f(x, i - 1)) &amp; i &gt; 0\\\end{cases}
\]</div>
<p>即 <span class="arithmatex">\(f(x, i)\)</span> 为 <span class="arithmatex">\(x\)</span> 在树状数组树形态上的第 <span class="arithmatex">\(i\)</span> 级祖先（第 <span class="arithmatex">\(0\)</span> 级祖先是自己）。</p>
<p>则只有 <span class="arithmatex">\(c(f(x, i), f(y, j))\)</span> 中的元素管辖 <span class="arithmatex">\(a(x, y)\)</span>，修改 <span class="arithmatex">\(a(x, y)\)</span> 时只需修改所有 <span class="arithmatex">\(c(f(x, i), f(y, j))\)</span>，其中 <span class="arithmatex">\(f(x, i) \le n\)</span>，<span class="arithmatex">\(f(y, j) \le m\)</span>。</p>
<details class="note">
<summary>正确性证明</summary>
<p><span class="arithmatex">\(c(p, q)\)</span> 管辖 <span class="arithmatex">\(a(x, y)\)</span>，求 <span class="arithmatex">\(p\)</span> 和 <span class="arithmatex">\(q\)</span> 的取值范围。</p>
<p>考虑一个大小为 <span class="arithmatex">\(n\)</span> 的一维树状数组 <span class="arithmatex">\(c_1\)</span>（对应原数组 <span class="arithmatex">\(a_1\)</span>）和一个大小为 <span class="arithmatex">\(m\)</span> 的一维树状数组 <span class="arithmatex">\(c_2\)</span>（对应原数组 <span class="arithmatex">\(a_2\)</span>）。</p>
<p>则命题等价为：<span class="arithmatex">\(c_1(p)\)</span> 管辖 <span class="arithmatex">\(a_1[x]\)</span> 且 <span class="arithmatex">\(c_2(q)\)</span> 管辖 <span class="arithmatex">\(a_2[y]\)</span> 的条件。</p>
<p>也就是说，在树状数组树形态上，<span class="arithmatex">\(p\)</span> 是 <span class="arithmatex">\(x\)</span> 及其祖先中的一个点，<span class="arithmatex">\(q\)</span> 是 <span class="arithmatex">\(y\)</span> 及其祖先中的一个点。</p>
<p>所以 <span class="arithmatex">\(p = f(x, i)\)</span>，<span class="arithmatex">\(q = f(y, j)\)</span>。</p>
</details>
<p>对于查询，我们设：</p>
<div class="arithmatex">\[
g(x, i) = \begin{cases}x &amp;i = 0\\g(x, i - 1) - \operatorname{lowbit}(g(x, i - 1)) &amp; i, g(x, i - 1) &gt; 0\\0&amp;\text{otherwise.}\end{cases}
\]</div>
<p>则合并所有 <span class="arithmatex">\(c(g(x, i), g(y, j))\)</span>，其中 <span class="arithmatex">\(g(x, i), g(y, j) &gt; 0\)</span>。</p>
<details class="note">
<summary>正确性证明</summary>
<p>设 <span class="arithmatex">\(\circ\)</span> 表示合并两个信息的运算符（比如，如果信息是区间和，则 <span class="arithmatex">\(\circ = +\)</span>）。</p>
<p>考虑一个一维树状数组 <span class="arithmatex">\(c_1\)</span>，<span class="arithmatex">\(c_1[g(x, 0)] \circ c_1[g(x, 1)] \circ c_1[g(x, 2)] \circ \cdots\)</span> 恰好表示原数组上 <span class="arithmatex">\([1 \ldots x]\)</span> 这段区间信息。</p>
<p>类似地，设 <span class="arithmatex">\(t(x) = c(x, g(y, 0)) \circ c(x, g(y, 1)) \circ c(x, g(y, 2)) \circ \cdots\)</span>，则 <span class="arithmatex">\(t(x)\)</span> 恰好表示 <span class="arithmatex">\(a(x - \operatorname{lowbit}(x) + 1, 1) \ldots a(x, y)\)</span> 这个矩阵信息。</p>
<p>又类似地，就有 <span class="arithmatex">\(t(g(x, 0)) \circ t(g(x, 1)) \circ t(g(x, 2)) \circ \cdots\)</span> 表示 <span class="arithmatex">\(a(1, 1) \ldots a(x, y)\)</span> 这个矩阵信息。</p>
<p>其实这里 <span class="arithmatex">\(t(x)\)</span> 这个函数如果看成一个树状数组，相当于一个树状数组套了一个树状数组，这也就是「树状数组套树状数组」这个名字的来源。</p>
</details>
<p>下面给出单点加、查询子矩阵和的代码。</p>
<details class="note" open="open">
<summary>实现</summary>
<div class="tabbed-set tabbed-alternate" data-tabs="5:2"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio" /><input id="__tabbed_5_2" name="__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="__tabbed_5_1">单点加</label><label for="__tabbed_5_2">查询子矩阵和</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1">1</a></span>
<span class="normal"><a href="#__codelineno-8-2">2</a></span>
<span class="normal"><a href="#__codelineno-8-3">3</a></span>
<span class="normal"><a href="#__codelineno-8-4">4</a></span>
<span class="normal"><a href="#__codelineno-8-5">5</a></span>
<span class="normal"><a href="#__codelineno-8-6">6</a></span>
<span class="normal"><a href="#__codelineno-8-7">7</a></span>
<span class="normal"><a href="#__codelineno-8-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">lowbit</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">m</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">lowbit</span><span class="p">(</span><span class="n">j</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="w">      </span><span class="c1">// 注意这里必须得建循环变量，不能像一维数组一样直接 while (x &lt;= n) 了</span>
<a id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="w">      </span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">v</span><span class="p">;</span>
<a id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-8-8" name="__codelineno-8-8"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-9-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-9-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-9-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-9-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-9-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-9-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-9-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-9-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-9-10">10</a></span>
<span class="normal"><a href="#__codelineno-9-11">11</a></span>
<span class="normal"><a href="#__codelineno-9-12">12</a></span>
<span class="normal"><a href="#__codelineno-9-13">13</a></span>
<span class="normal"><a href="#__codelineno-9-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">lowbit</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">lowbit</span><span class="p">(</span><span class="n">j</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="w">      </span><span class="n">res</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
<a id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-9-8" name="__codelineno-9-8"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<a id="__codelineno-9-9" name="__codelineno-9-9"></a><span class="p">}</span>
<a id="__codelineno-9-10" name="__codelineno-9-10"></a>
<a id="__codelineno-9-11" name="__codelineno-9-11"></a><span class="kt">int</span><span class="w"> </span><span class="nf">ask</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x1</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y1</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">x2</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">y2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-12" name="__codelineno-9-12"></a><span class="w">  </span><span class="c1">// 查询子矩阵和</span>
<a id="__codelineno-9-13" name="__codelineno-9-13"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">sum</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="w"> </span><span class="n">y2</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">sum</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="w"> </span><span class="n">y1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">sum</span><span class="p">(</span><span class="n">x1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">y2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sum</span><span class="p">(</span><span class="n">x1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">y1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-9-14" name="__codelineno-9-14"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
</details>
<h3 id="_13">子矩阵加，求子矩阵和<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h3>
<p>前置知识：<a href="../../basic/prefix-sum/">前缀和 &amp; 差分</a> 和本页面 <a href="#区间加区间和">区间加区间和</a> 一节。</p>
<p>和一维树状数组的「区间加区间和」问题类似，考虑维护差分数组。</p>
<p>二维数组上的差分数组是这样的：</p>
<div class="arithmatex">\[
d(i, j) = a(i, j) - a(i - 1, j) - a(i, j - 1) + a(i - 1, j - 1)。
\]</div>
<details class="note">
<summary>为什么这么定义？</summary>
<p>这是因为，理想规定状态下，在差分矩阵上做二维前缀和应该得到原矩阵，因为这是一对逆运算。</p>
<p>二维前缀和的公式是这样的：</p>
<p><span class="arithmatex">\(s(i, j) = s(i - 1, j) + s(i, j - 1) - s(i - 1, j - 1) + a(i, j)\)</span>。</p>
<p>所以，设 <span class="arithmatex">\(a\)</span> 是原数组，<span class="arithmatex">\(d\)</span> 是差分数组，有：</p>
<p><span class="arithmatex">\(a(i, j) = a(i - 1, j) + a(i, j - 1) - a(i - 1, j - 1) + d(i, j)\)</span></p>
<p>移项就得到二维差分的公式了。</p>
<p><span class="arithmatex">\(d(i, j) = a(i, j) - a(i - 1, j) - a(i, j - 1) + a(i - 1, j - 1)\)</span>。</p>
</details>
<p>这样以来，对左上角 <span class="arithmatex">\((x_1, y_1)\)</span>，右下角 <span class="arithmatex">\((x_2, y_2)\)</span> 的子矩阵区间加 <span class="arithmatex">\(v\)</span>，相当于在差分数组上，对 <span class="arithmatex">\(d(x_1, y_1)\)</span> 和 <span class="arithmatex">\(d(x_2 + 1, y_2 + 1)\)</span> 分别单点加 <span class="arithmatex">\(v\)</span>，对 <span class="arithmatex">\(d(x_2 + 1, y_1)\)</span> 和 <span class="arithmatex">\(d(x_1, y_2 + 1)\)</span> 分别单点加 <span class="arithmatex">\(-v\)</span>。</p>
<p>至于原因，把这四个 <span class="arithmatex">\(d\)</span> 分别用定义式表示出来，分析一下每项的变化即可。</p>
<p>举个例子吧，初始差分数组为 <span class="arithmatex">\(0\)</span>，给 <span class="arithmatex">\(a(2, 2) \ldots a(3, 4)\)</span> 子矩阵加 <span class="arithmatex">\(v\)</span> 后差分数组会变为：</p>
<div class="arithmatex">\[
\begin{pmatrix}0&amp;0&amp;0&amp;0&amp;0\\0&amp;v&amp;0&amp;0&amp;-v\\0&amp;0&amp;0&amp;0&amp;0\\0&amp;-v&amp;0&amp;0&amp;v\end{pmatrix}
\]</div>
<p>（其中 <span class="arithmatex">\(a(2, 2) \ldots a(3, 4)\)</span> 这个子矩阵恰好是上面位于中心的 <span class="arithmatex">\(2 \times 3\)</span> 大小的矩阵。）</p>
<p>因此，子矩阵加的做法是：转化为差分数组上的四个单点加操作。</p>
<p>现在考虑查询子矩阵和：</p>
<p>对于点 <span class="arithmatex">\((x, y)\)</span>，它的二维前缀和可以表示为：</p>
<div class="arithmatex">\[
\sum_{i = 1}^x\sum_{j = 1}^y\sum_{h = 1}^i\sum_{k = 1}^j d(h, k)
\]</div>
<p>原因就是差分的前缀和的前缀和就是原本的前缀和。</p>
<p>和一维树状数组的「区间加区间和」问题类似，统计 <span class="arithmatex">\(d(h, k)\)</span> 的出现次数，为 <span class="arithmatex">\((x - h + 1) \times (y - k + 1)\)</span>。</p>
<p>然后接着推导：</p>
<div class="arithmatex">\[
\begin{aligned}
&amp;\sum_{i = 1}^x\sum_{j = 1}^y\sum_{h = 1}^i\sum_{k = 1}^j d(h, k)
\\=&amp;\sum_{i = 1}^x\sum_{j = 1}^y d(i, j) \times (x - i + 1) \times (y - j + 1)
\\=&amp;\sum_{i = 1}^x\sum_{j = 1}^y d(i, j) \times (xy + x + y + 1) - d(i, j) \times i \times (y + 1) - d(i, j) \times j \times (x + 1) + d(i, j) \times i \times j
\end{aligned}
\]</div>
<p>所以我们需维护四个树状数组，分别维护 <span class="arithmatex">\(d(i, j)\)</span>，<span class="arithmatex">\(d(i, j) \times i\)</span>，<span class="arithmatex">\(d(i, j) \times j\)</span>，<span class="arithmatex">\(d(i, j) \times i \times j\)</span> 的和信息。</p>
<p>当然了，和一维同理，如果只需要子矩阵加求单点值，维护一个差分数组然后询问前缀和就足够了。</p>
<p>下面给出代码：</p>
<details class="note" open="open">
<summary>实现</summary>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-10-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-10-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-10-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-10-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-10-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-10-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-10-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-10-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-10-10">10</a></span>
<span class="normal"><a href="#__codelineno-10-11">11</a></span>
<span class="normal"><a href="#__codelineno-10-12">12</a></span>
<span class="normal"><a href="#__codelineno-10-13">13</a></span>
<span class="normal"><a href="#__codelineno-10-14">14</a></span>
<span class="normal"><a href="#__codelineno-10-15">15</a></span>
<span class="normal"><a href="#__codelineno-10-16">16</a></span>
<span class="normal"><a href="#__codelineno-10-17">17</a></span>
<span class="normal"><a href="#__codelineno-10-18">18</a></span>
<span class="normal"><a href="#__codelineno-10-19">19</a></span>
<span class="normal"><a href="#__codelineno-10-20">20</a></span>
<span class="normal"><a href="#__codelineno-10-21">21</a></span>
<span class="normal"><a href="#__codelineno-10-22">22</a></span>
<span class="normal"><a href="#__codelineno-10-23">23</a></span>
<span class="normal"><a href="#__codelineno-10-24">24</a></span>
<span class="normal"><a href="#__codelineno-10-25">25</a></span>
<span class="normal"><a href="#__codelineno-10-26">26</a></span>
<span class="normal"><a href="#__codelineno-10-27">27</a></span>
<span class="normal"><a href="#__codelineno-10-28">28</a></span>
<span class="normal"><a href="#__codelineno-10-29">29</a></span>
<span class="normal"><a href="#__codelineno-10-30">30</a></span>
<span class="normal"><a href="#__codelineno-10-31">31</a></span>
<span class="normal"><a href="#__codelineno-10-32">32</a></span>
<span class="normal"><a href="#__codelineno-10-33">33</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="k">using</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">long</span><span class="w"> </span><span class="kt">long</span><span class="p">;</span>
<a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="n">ll</span><span class="w"> </span><span class="n">t1</span><span class="p">[</span><span class="n">N</span><span class="p">][</span><span class="n">N</span><span class="p">],</span><span class="w"> </span><span class="n">t2</span><span class="p">[</span><span class="n">N</span><span class="p">][</span><span class="n">N</span><span class="p">],</span><span class="w"> </span><span class="n">t3</span><span class="p">[</span><span class="n">N</span><span class="p">][</span><span class="n">N</span><span class="p">],</span><span class="w"> </span><span class="n">t4</span><span class="p">[</span><span class="n">N</span><span class="p">][</span><span class="n">N</span><span class="p">];</span>
<a id="__codelineno-10-3" name="__codelineno-10-3"></a>
<a id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="kt">void</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">z</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">lowbit</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>
<a id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">;</span><span class="w"> </span><span class="n">Y</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">m</span><span class="p">;</span><span class="w"> </span><span class="n">Y</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">lowbit</span><span class="p">(</span><span class="n">Y</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="w">      </span><span class="n">t1</span><span class="p">[</span><span class="n">X</span><span class="p">][</span><span class="n">Y</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">z</span><span class="p">;</span>
<a id="__codelineno-10-8" name="__codelineno-10-8"></a><span class="w">      </span><span class="n">t2</span><span class="p">[</span><span class="n">X</span><span class="p">][</span><span class="n">Y</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w">  </span><span class="c1">// 注意是 z * x 而不是 z * X，后面同理</span>
<a id="__codelineno-10-9" name="__codelineno-10-9"></a><span class="w">      </span><span class="n">t3</span><span class="p">[</span><span class="n">X</span><span class="p">][</span><span class="n">Y</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<a id="__codelineno-10-10" name="__codelineno-10-10"></a><span class="w">      </span><span class="n">t4</span><span class="p">[</span><span class="n">X</span><span class="p">][</span><span class="n">Y</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
<a id="__codelineno-10-11" name="__codelineno-10-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-10-12" name="__codelineno-10-12"></a><span class="p">}</span>
<a id="__codelineno-10-13" name="__codelineno-10-13"></a>
<a id="__codelineno-10-14" name="__codelineno-10-14"></a><span class="kt">void</span><span class="w"> </span><span class="nf">range_add</span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="n">xa</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">ya</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">xb</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">yb</span><span class="p">,</span>
<a id="__codelineno-10-15" name="__codelineno-10-15"></a><span class="w">               </span><span class="n">ll</span><span class="w"> </span><span class="n">z</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">  </span><span class="c1">//(xa, ya) 到 (xb, yb) 子矩阵</span>
<a id="__codelineno-10-16" name="__codelineno-10-16"></a><span class="w">  </span><span class="n">add</span><span class="p">(</span><span class="n">xa</span><span class="p">,</span><span class="w"> </span><span class="n">ya</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">);</span>
<a id="__codelineno-10-17" name="__codelineno-10-17"></a><span class="w">  </span><span class="n">add</span><span class="p">(</span><span class="n">xa</span><span class="p">,</span><span class="w"> </span><span class="n">yb</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">z</span><span class="p">);</span>
<a id="__codelineno-10-18" name="__codelineno-10-18"></a><span class="w">  </span><span class="n">add</span><span class="p">(</span><span class="n">xb</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">ya</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">z</span><span class="p">);</span>
<a id="__codelineno-10-19" name="__codelineno-10-19"></a><span class="w">  </span><span class="n">add</span><span class="p">(</span><span class="n">xb</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">yb</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">);</span>
<a id="__codelineno-10-20" name="__codelineno-10-20"></a><span class="p">}</span>
<a id="__codelineno-10-21" name="__codelineno-10-21"></a>
<a id="__codelineno-10-22" name="__codelineno-10-22"></a><span class="n">ll</span><span class="w"> </span><span class="nf">ask</span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-23" name="__codelineno-10-23"></a><span class="w">  </span><span class="n">ll</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-10-24" name="__codelineno-10-24"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">lowbit</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
<a id="__codelineno-10-25" name="__codelineno-10-25"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">lowbit</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
<a id="__codelineno-10-26" name="__codelineno-10-26"></a><span class="w">      </span><span class="n">res</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t1</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t2</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">-</span>
<a id="__codelineno-10-27" name="__codelineno-10-27"></a><span class="w">             </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">t3</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t4</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">];</span>
<a id="__codelineno-10-28" name="__codelineno-10-28"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">res</span><span class="p">;</span>
<a id="__codelineno-10-29" name="__codelineno-10-29"></a><span class="p">}</span>
<a id="__codelineno-10-30" name="__codelineno-10-30"></a>
<a id="__codelineno-10-31" name="__codelineno-10-31"></a><span class="n">ll</span><span class="w"> </span><span class="nf">range_ask</span><span class="p">(</span><span class="n">ll</span><span class="w"> </span><span class="n">xa</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">ya</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">xb</span><span class="p">,</span><span class="w"> </span><span class="n">ll</span><span class="w"> </span><span class="n">yb</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-32" name="__codelineno-10-32"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">ask</span><span class="p">(</span><span class="n">xb</span><span class="p">,</span><span class="w"> </span><span class="n">yb</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ask</span><span class="p">(</span><span class="n">xb</span><span class="p">,</span><span class="w"> </span><span class="n">ya</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">ask</span><span class="p">(</span><span class="n">xa</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">yb</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ask</span><span class="p">(</span><span class="n">xa</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">ya</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-10-33" name="__codelineno-10-33"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</details>
<h2 id="_14">权值树状数组及应用<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h2>
<p>我们知道，普通树状数组直接在原序列的基础上构建，<span class="arithmatex">\(c_6\)</span> 表示的就是 <span class="arithmatex">\(a[5 \ldots 6]\)</span> 的区间信息。</p>
<p>然而事实上，我们还可以在原序列的权值数组上构建树状数组，这就是权值树状数组。</p>
<details class="note">
<summary>什么是权值数组？</summary>
<p>一个序列 <span class="arithmatex">\(a\)</span> 的权值数组 <span class="arithmatex">\(b\)</span>，满足 <span class="arithmatex">\(b[x]\)</span> 的值为 <span class="arithmatex">\(x\)</span> 在 <span class="arithmatex">\(a\)</span> 中的出现次数。</p>
<p>例如：<span class="arithmatex">\(a = (1, 3, 4, 3, 4)\)</span> 的权值数组为 <span class="arithmatex">\(b = (1, 0, 2, 2)\)</span>。</p>
<p>很明显，<span class="arithmatex">\(b\)</span> 的大小和 <span class="arithmatex">\(a\)</span> 的值域有关。</p>
<p>若原数列值域过大，且重要的不是具体值而是值与值之间的相对大小关系，常 <a href="../../misc/discrete/">离散化</a> 原数组后再建立权值数组。</p>
<p>另外，权值数组是原数组无序性的一种表示：它重点描述数组的元素内容，忽略了数组的顺序，若两数组只是顺序不同，所含内容一致，则它们的权值数组相同。</p>
<p>因此，对于给定数组的顺序不影响答案的问题，在权值数组的基础上思考一般更直观，比如 <a href="https://www.luogu.com.cn/problem/P7961">[NOIP2021] 数列</a>。</p>
</details>
<p>运用权值树状数组，我们可以解决一些经典问题。</p>
<h3 id="k">单点修改，查询全局第 <span class="arithmatex">\(k\)</span> 小<a class="headerlink" href="#k" title="Permanent link">&para;</a></h3>
<p>在此处只讨论第 <span class="arithmatex">\(k\)</span> 小，第 <span class="arithmatex">\(k\)</span> 大问题可以通过简单计算转化为第 <span class="arithmatex">\(k\)</span> 小问题。</p>
<p>该问题可离散化，如果原序列 <span class="arithmatex">\(a\)</span> 值域过大，离散化后再建立权值数组 <span class="arithmatex">\(b\)</span>。注意，还要把单点修改中的涉及到的值也一起离散化，不能只离散化原数组 <span class="arithmatex">\(a\)</span> 中的元素。</p>
<p>对于单点修改，只需将对原数列的单点修改转化为对权值数组的单点修改即可。具体来说，原数组 <span class="arithmatex">\(a[x]\)</span> 从 <span class="arithmatex">\(y\)</span> 修改为 <span class="arithmatex">\(z\)</span>，转化为对权值数组 <span class="arithmatex">\(b\)</span> 的单点修改就是 <span class="arithmatex">\(b[y]\)</span> 单点减 <span class="arithmatex">\(1\)</span>，<span class="arithmatex">\(b[z]\)</span> 单点加 <span class="arithmatex">\(1\)</span>。</p>
<p>对于查询第 <span class="arithmatex">\(k\)</span> 小，考虑二分 <span class="arithmatex">\(x\)</span>，查询权值数组中 <span class="arithmatex">\([1, x]\)</span> 的前缀和，找到 <span class="arithmatex">\(x_0\)</span> 使得 <span class="arithmatex">\([1, x_0]\)</span> 的前缀和 <span class="arithmatex">\(&lt; k\)</span> 而 <span class="arithmatex">\([1, x_0 + 1]\)</span> 的前缀和 <span class="arithmatex">\(\ge k\)</span>，则第 <span class="arithmatex">\(k\)</span> 大的数是 <span class="arithmatex">\(x_0 + 1\)</span>（注：这里认为 <span class="arithmatex">\([1, 0]\)</span> 的前缀和是 <span class="arithmatex">\(0\)</span>）。</p>
<p>这样做时间复杂度是 <span class="arithmatex">\(\Theta(\log^2n)\)</span> 的。</p>
<p>考虑用倍增替代二分。</p>
<p>设 <span class="arithmatex">\(x = 0\)</span>，<span class="arithmatex">\(\mathrm{sum} = 0\)</span>，枚举 <span class="arithmatex">\(i\)</span> 从 <span class="arithmatex">\(\log_2n\)</span> 降为 <span class="arithmatex">\(0\)</span>：</p>
<ul>
<li>查询权值数组中 <span class="arithmatex">\([x + 1 \ldots x + 2^i]\)</span> 的区间和 <span class="arithmatex">\(t\)</span>。</li>
<li>如果 <span class="arithmatex">\(\mathrm{sum} + t &lt; k\)</span>，扩展成功，<span class="arithmatex">\(x \gets x + 2^i\)</span>，<span class="arithmatex">\(\mathrm{sum} \gets \mathrm{sum} + t\)</span>；否则扩展失败，不操作。</li>
</ul>
<p>这样得到的 <span class="arithmatex">\(x\)</span> 是满足 <span class="arithmatex">\([1 \ldots x]\)</span> 前缀和 <span class="arithmatex">\(&lt; k\)</span> 的最大值，所以最终 <span class="arithmatex">\(x + 1\)</span> 就是答案。</p>
<p>看起来这种方法时间效率没有任何改善，但事实上，查询 <span class="arithmatex">\([x + 1 \ldots x + 2^i]\)</span> 的区间和只需访问 <span class="arithmatex">\(c[x + 2^i]\)</span> 的值即可。</p>
<p>原因很简单，考虑 <span class="arithmatex">\(\operatorname{lowbit}(x + 2^i)\)</span>，它一定是 <span class="arithmatex">\(2^i\)</span>，因为 <span class="arithmatex">\(x\)</span> 之前只累加过 <span class="arithmatex">\(2^j\)</span> 满足 <span class="arithmatex">\(j &gt; i\)</span>。因此 <span class="arithmatex">\(c[x + 2^i]\)</span> 表示的区间就是 <span class="arithmatex">\([x + 1 \ldots x + 2^i]\)</span>。</p>
<p>如此一来，时间复杂度降低为 <span class="arithmatex">\(\Theta(\log n)\)</span>。</p>
<details class="note" open="open">
<summary>实现</summary>
<div class="tabbed-set tabbed-alternate" data-tabs="6:2"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio" /><input id="__tabbed_6_2" name="__tabbed_6" type="radio" /><div class="tabbed-labels"><label for="__tabbed_6_1">C++</label><label for="__tabbed_6_2">Python</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-11-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-11-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-11-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-11-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-11-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-11-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-11-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-11-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-11-10">10</a></span>
<span class="normal"><a href="#__codelineno-11-11">11</a></span>
<span class="normal"><a href="#__codelineno-11-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="c1">// 权值树状数组查询第 k 小</span>
<a id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="kt">int</span><span class="w"> </span><span class="nf">kth</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">log2</span><span class="p">(</span><span class="n">n</span><span class="p">);</span><span class="w"> </span><span class="o">~</span><span class="n">i</span><span class="p">;</span><span class="w"> </span><span class="o">--</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="w">    </span><span class="n">x</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w">                    </span><span class="c1">// 尝试扩展</span>
<a id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">sum</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w">  </span><span class="c1">// 如果扩展失败</span>
<a id="__codelineno-11-7" name="__codelineno-11-7"></a><span class="w">      </span><span class="n">x</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<a id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-11-9" name="__codelineno-11-9"></a><span class="w">      </span><span class="n">sum</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">];</span>
<a id="__codelineno-11-10" name="__codelineno-11-10"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-11-11" name="__codelineno-11-11"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-11-12" name="__codelineno-11-12"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Python</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-12-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-12-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-12-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-12-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-12-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-12-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-12-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-12-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-12-10">10</a></span>
<span class="normal"><a href="#__codelineno-12-11">11</a></span>
<span class="normal"><a href="#__codelineno-12-12">12</a></span>
<span class="normal"><a href="#__codelineno-12-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="c1"># 权值树状数组查询第 k 小</span>
<a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">kth</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
<a id="__codelineno-12-3" name="__codelineno-12-3"></a>    <span class="nb">sum</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-12-4" name="__codelineno-12-4"></a>    <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-12-5" name="__codelineno-12-5"></a>    <span class="n">i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">log2</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<a id="__codelineno-12-6" name="__codelineno-12-6"></a>    <span class="k">while</span> <span class="o">~</span><span class="n">i</span><span class="p">:</span>
<a id="__codelineno-12-7" name="__codelineno-12-7"></a>        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">)</span>  <span class="c1"># 尝试扩展</span>
<a id="__codelineno-12-8" name="__codelineno-12-8"></a>        <span class="k">if</span> <span class="n">x</span> <span class="o">&gt;=</span> <span class="n">n</span> <span class="ow">or</span> <span class="nb">sum</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">k</span><span class="p">:</span>  <span class="c1"># 如果扩展失败</span>
<a id="__codelineno-12-9" name="__codelineno-12-9"></a>            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-12-10" name="__codelineno-12-10"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-12-11" name="__codelineno-12-11"></a>            <span class="nb">sum</span> <span class="o">=</span> <span class="nb">sum</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
<a id="__codelineno-12-12" name="__codelineno-12-12"></a>        <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-12-13" name="__codelineno-12-13"></a>    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
</details>
<h3 id="_15">全局逆序对（全局二维偏序）<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h3>
<p>相关阅读和参考实现：<a href="../../math/permutation/#逆序数">逆序对</a></p>
<p>全局逆序对也可以用权值树状数组巧妙解决。问题是这样的：给定长度为 <span class="arithmatex">\(n\)</span> 的序列 <span class="arithmatex">\(a\)</span>，求 <span class="arithmatex">\(a\)</span> 中满足 <span class="arithmatex">\(i &lt; j\)</span> 且 <span class="arithmatex">\(a[i] &gt; a[j]\)</span> 的数对 <span class="arithmatex">\((i, j)\)</span> 的数量。</p>
<p>该问题可离散化，如果原序列 <span class="arithmatex">\(a\)</span> 值域过大，离散化后再建立权值数组 <span class="arithmatex">\(b\)</span>。</p>
<p>我们考虑从 <span class="arithmatex">\(n\)</span> 到 <span class="arithmatex">\(1\)</span> 倒序枚举 <span class="arithmatex">\(i\)</span>，作为逆序对中第一个元素的索引，然后计算有多少个 <span class="arithmatex">\(j &gt; i\)</span> 满足 <span class="arithmatex">\(a[j] &lt; a[i]\)</span>，最后累计答案即可。</p>
<p>事实上，我们只需要这样做（设当前 <span class="arithmatex">\(a[i] = x\)</span>）：</p>
<ul>
<li>查询 <span class="arithmatex">\(b[1 \ldots x - 1]\)</span> 的前缀和，即为左端点为 <span class="arithmatex">\(a[i]\)</span> 的逆序对数量。</li>
<li><span class="arithmatex">\(b[x]\)</span> 自增 <span class="arithmatex">\(1\)</span>；</li>
</ul>
<p>原因十分自然：出现在 <span class="arithmatex">\(b[1 \ldots x-1]\)</span> 中的元素一定比当前的 <span class="arithmatex">\(x = a[i]\)</span> 小，而 <span class="arithmatex">\(i\)</span> 的倒序枚举，自然使得这些已在权值数组中的元素，在原数组上的索引 <span class="arithmatex">\(j\)</span> 大于当前遍历到的索引 <span class="arithmatex">\(i\)</span>。</p>
<p>用例子说明，<span class="arithmatex">\(a = (4, 3, 1, 2, 1)\)</span>。</p>
<p><span class="arithmatex">\(i\)</span> 按照 <span class="arithmatex">\(5 \to 1\)</span> 扫：</p>
<ul>
<li><span class="arithmatex">\(a[5] = 1\)</span>，查询 <span class="arithmatex">\(b[1 \ldots 0]\)</span> 前缀和，为 <span class="arithmatex">\(0\)</span>，<span class="arithmatex">\(b[1]\)</span> 自增 <span class="arithmatex">\(1\)</span>，<span class="arithmatex">\(b = (1, 0, 0, 0)\)</span>。</li>
<li><span class="arithmatex">\(a[4] = 2\)</span>，查询 <span class="arithmatex">\(b[1 \ldots 1]\)</span> 前缀和，为 <span class="arithmatex">\(1\)</span>，<span class="arithmatex">\(b[2]\)</span> 自增 <span class="arithmatex">\(1\)</span>，<span class="arithmatex">\(b = (1, 1, 0, 0)\)</span>。</li>
<li><span class="arithmatex">\(a[3] = 1\)</span>，查询 <span class="arithmatex">\(b[1 \ldots 0]\)</span> 前缀和，为 <span class="arithmatex">\(0\)</span>，<span class="arithmatex">\(b[1]\)</span> 自增 <span class="arithmatex">\(1\)</span>，<span class="arithmatex">\(b = (2, 1, 0, 0)\)</span>。</li>
<li><span class="arithmatex">\(a[2] = 3\)</span>，查询 <span class="arithmatex">\(b[1 \ldots 2]\)</span> 前缀和，为 <span class="arithmatex">\(3\)</span>，<span class="arithmatex">\(b[3]\)</span> 自增 <span class="arithmatex">\(1\)</span>，<span class="arithmatex">\(b = (2, 1, 1, 0)\)</span>。</li>
<li><span class="arithmatex">\(a[1] = 4\)</span>，查询 <span class="arithmatex">\(b[1 \ldots 3]\)</span> 前缀和，为 <span class="arithmatex">\(4\)</span>，<span class="arithmatex">\(b[4]\)</span> 自增 <span class="arithmatex">\(1\)</span>，<span class="arithmatex">\(b = (2, 1, 1, 1)\)</span>。</li>
</ul>
<p>所以最终答案为 <span class="arithmatex">\(0 + 1 + 0 + 3 + 4 = 8\)</span>。</p>
<p>注意到，遍历 <span class="arithmatex">\(i\)</span> 后的查询 <span class="arithmatex">\(b[1 \ldots x - 1]\)</span> 和自增 <span class="arithmatex">\(b[x]\)</span> 的两个步骤可以颠倒，变成先自增 <span class="arithmatex">\(b[x]\)</span> 再查询 <span class="arithmatex">\(b[1 \ldots x - 1]\)</span>，不影响答案。两个角度来解释：</p>
<ul>
<li>对 <span class="arithmatex">\(b[x]\)</span> 的修改不影响对 <span class="arithmatex">\(b[1 \ldots x - 1]\)</span> 的查询。</li>
<li>颠倒后，实质是在查询 <span class="arithmatex">\(i \le j\)</span> 且 <span class="arithmatex">\(a[i] &gt; a[j]\)</span> 的数对数量，而 <span class="arithmatex">\(i = j\)</span> 时不存在 <span class="arithmatex">\(a[i] &gt; a[j]\)</span>，所以 <span class="arithmatex">\(i \le j\)</span> 相当于 <span class="arithmatex">\(i &lt; j\)</span>，所以这与原来的逆序对问题是等价的。</li>
</ul>
<p>如果查询非严格逆序对（<span class="arithmatex">\(i &lt; j\)</span> 且 <span class="arithmatex">\(a[i] \ge a[j]\)</span>）的数量，那就要改为查询 <span class="arithmatex">\(b[1 \ldots x]\)</span> 的和，这时就不能颠倒两步了，还是两个角度来解释：</p>
<ul>
<li>对 <span class="arithmatex">\(b[x]\)</span> 的修改 <strong>影响</strong> 对 <span class="arithmatex">\(b[1 \ldots x]\)</span> 的查询。</li>
<li>颠倒后，实质是在查询 <span class="arithmatex">\(i \le j\)</span> 且 <span class="arithmatex">\(a[i] \ge a[j]\)</span> 的数对数量，而 <span class="arithmatex">\(i = j\)</span> 时恒有 <span class="arithmatex">\(a[i] \ge a[j]\)</span>，所以 <span class="arithmatex">\(i \le j\)</span>  <strong>不相当于</strong>  <span class="arithmatex">\(i &lt; j\)</span>，与原问题 <strong>不等价</strong>。</li>
</ul>
<p>如果查询 <span class="arithmatex">\(i \le j\)</span> 且 <span class="arithmatex">\(a[i] \ge a[j]\)</span> 的数对数量，那这两步就需要颠倒了。</p>
<p>另外，对于原逆序对问题，还有一种做法是正着枚举 <span class="arithmatex">\(j\)</span>，查询有多少 <span class="arithmatex">\(i &lt; j\)</span> 满足 <span class="arithmatex">\(a[i] &gt; a[j]\)</span>。做法如下（设 <span class="arithmatex">\(x = a[j]\)</span>）：</p>
<ul>
<li>查询 <span class="arithmatex">\(b[x + 1 \ldots V]\)</span>（<span class="arithmatex">\(V\)</span> 是 <span class="arithmatex">\(b\)</span> 的大小，即 <span class="arithmatex">\(a\)</span> 的值域（或离散化后的值域））的区间和。</li>
<li>将 <span class="arithmatex">\(b[x]\)</span> 自增 <span class="arithmatex">\(1\)</span>。</li>
</ul>
<p>原因：出现在 <span class="arithmatex">\(b[x + 1 \ldots V]\)</span> 中的元素一定比当前的 <span class="arithmatex">\(x = a[j]\)</span> 大，而 <span class="arithmatex">\(j\)</span> 的正序枚举，自然使得这些已在权值数组中的元素，在原数组上的索引 <span class="arithmatex">\(i\)</span> 小于当前遍历到的索引 <span class="arithmatex">\(j\)</span>。</p>
<p>此外，逆序对的计数还可以通过 <a href="../../basic/merge-sort/#逆序对">归并排序</a> 解决。这一方法可以避免离散化。时间复杂度同样为 <span class="arithmatex">\(O(n\log n)\)</span>。两种算法的参考实现都在 <a href="../../math/permutation/#逆序数">逆序对</a> 章节。</p>
<h2 id="_16">树状数组维护不可差分信息<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h2>
<p>比如维护区间最值等。</p>
<p>注意，这种方法虽然码量小，但单点修改和区间查询的时间复杂度均为 <span class="arithmatex">\(\Theta(\log^2n)\)</span>，比使用线段树的时间复杂度 <span class="arithmatex">\(\Theta(\log n)\)</span> 劣。</p>
<h3 id="_17">区间查询<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h3>
<p>我们还是基于之前的思路，从 <span class="arithmatex">\(r\)</span> 沿着 <span class="arithmatex">\(\operatorname{lowbit}\)</span> 一直向前跳，但是我们不能跳到 <span class="arithmatex">\(l\)</span> 的左边。</p>
<p>因此，如果我们跳到了 <span class="arithmatex">\(c[x]\)</span>，先判断下一次要跳到的 <span class="arithmatex">\(x - \operatorname{lowbit}(x)\)</span> 是否小于 <span class="arithmatex">\(l\)</span>：</p>
<ul>
<li>如果小于 <span class="arithmatex">\(l\)</span>，我们直接把 <strong><span class="arithmatex">\(\boldsymbol{a[x]}\)</span> 单点</strong> 合并到总信息里，然后跳到 <span class="arithmatex">\(c[x - 1]\)</span>。</li>
<li>如果大于等于 <span class="arithmatex">\(l\)</span>，说明没越界，正常合并 <span class="arithmatex">\(c[x]\)</span>，然后跳到 <span class="arithmatex">\(c[x - \operatorname{lowbit}(x)]\)</span> 即可。</li>
</ul>
<p>下面以查询区间最大值为例，给出代码：</p>
<details class="note" open="open">
<summary>实现</summary>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-13-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-13-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-13-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-13-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-13-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-13-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-13-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-13-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-13-10">10</a></span>
<span class="normal"><a href="#__codelineno-13-11">11</a></span>
<span class="normal"><a href="#__codelineno-13-12">12</a></span>
<span class="normal"><a href="#__codelineno-13-13">13</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">getmax</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">ans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">l</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="w">    </span><span class="n">ans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">r</span><span class="p">]);</span>
<a id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="w">    </span><span class="o">--</span><span class="n">r</span><span class="p">;</span>
<a id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(;</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">lowbit</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">l</span><span class="p">;</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">lowbit</span><span class="p">(</span><span class="n">r</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="w">      </span><span class="c1">// 注意，循环条件不要写成 r - lowbit(r) + 1 &gt;= l</span>
<a id="__codelineno-13-8" name="__codelineno-13-8"></a><span class="w">      </span><span class="c1">// 否则 l = 1 时，r 跳到 0 会死循环</span>
<a id="__codelineno-13-9" name="__codelineno-13-9"></a><span class="w">      </span><span class="n">ans</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">ans</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="p">[</span><span class="n">r</span><span class="p">]);</span>
<a id="__codelineno-13-10" name="__codelineno-13-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-13-11" name="__codelineno-13-11"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-13-12" name="__codelineno-13-12"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">ans</span><span class="p">;</span>
<a id="__codelineno-13-13" name="__codelineno-13-13"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</details>
<p>可以证明，上述算法的时间复杂度是 <span class="arithmatex">\(\Theta(\log^2n)\)</span>。</p>
<details class="note">
<summary>时间复杂度证明</summary>
<p>考虑 <span class="arithmatex">\(r\)</span> 和 <span class="arithmatex">\(l\)</span> 不同的最高位，一定有 <span class="arithmatex">\(r\)</span> 在这一位上为 <span class="arithmatex">\(1\)</span>，<span class="arithmatex">\(l\)</span> 在这一位上为 <span class="arithmatex">\(0\)</span>（因为 <span class="arithmatex">\(r \ge l\)</span>）。</p>
<p>如果 <span class="arithmatex">\(r\)</span> 在这一位的后面仍然有 <span class="arithmatex">\(1\)</span>，一定有 <span class="arithmatex">\(r - \operatorname{lowbit}(r) \ge l\)</span>，所以下一步一定是把 <span class="arithmatex">\(r\)</span> 的最低位 <span class="arithmatex">\(1\)</span> 填为 <span class="arithmatex">\(0\)</span>；</p>
<p>如果 <span class="arithmatex">\(r\)</span> 的这一位 <span class="arithmatex">\(1\)</span> 就是 <span class="arithmatex">\(r\)</span> 的最低位 <span class="arithmatex">\(1\)</span>，无论是 <span class="arithmatex">\(r \gets r - \operatorname{lowbit}(r)\)</span> 还是 <span class="arithmatex">\(r \gets r - 1\)</span>，<span class="arithmatex">\(r\)</span> 的这一位 <span class="arithmatex">\(1\)</span> 一定会变为 <span class="arithmatex">\(0\)</span>。</p>
<p>因此，<span class="arithmatex">\(r\)</span> 经过至多 <span class="arithmatex">\(\log n\)</span> 次变换后，<span class="arithmatex">\(r\)</span> 和 <span class="arithmatex">\(l\)</span> 不同的最高位一定可以下降一位。所以，总时间复杂度是 <span class="arithmatex">\(\Theta(\log^2n)\)</span>。</p>
</details>
<h3 id="_18">单点更新<a class="headerlink" href="#_18" title="Permanent link">&para;</a></h3>
<details class="note" open="open">
<summary>注</summary>
<p>请先理解树状数组树形态的以下两条性质，再学习本节。</p>
<ul>
<li>设 <span class="arithmatex">\(u = s \times 2^{k + 1} + 2^k\)</span>，则其儿子数量为 <span class="arithmatex">\(k = \log_2\operatorname{lowbit}(u)\)</span>，编号分别为 <span class="arithmatex">\(u - 2^t(0 \le t &lt; k)\)</span>。</li>
<li><span class="arithmatex">\(u\)</span> 的所有儿子对应 <span class="arithmatex">\(c\)</span> 的管辖区间恰好拼接成 <span class="arithmatex">\([l(u), u - 1]\)</span>。</li>
</ul>
<p>关于这两条性质的含义及证明，都可以在本页面的 <a href="#树状数组与其树形态的性质">树状数组与其树形态的性质</a> 一节找到。</p>
</details>
<p>更新 <span class="arithmatex">\(a[x]\)</span> 后，我们只需要更新满足在树状数组树形态上，满足 <span class="arithmatex">\(y\)</span> 是 <span class="arithmatex">\(x\)</span> 的祖先的 <span class="arithmatex">\(c[y]\)</span>。</p>
<p>对于最值（以最大值为例），一种常见的错误想法是，如果 <span class="arithmatex">\(a[x]\)</span> 修改成 <span class="arithmatex">\(p\)</span>，则将所有 <span class="arithmatex">\(c[y]\)</span> 更新为 <span class="arithmatex">\(\max(c[y], p)\)</span>。下面是一个反例：<span class="arithmatex">\((1, 2, 3, 4, 5)\)</span> 中将 <span class="arithmatex">\(5\)</span> 修改成 <span class="arithmatex">\(4\)</span>，最大值是 <span class="arithmatex">\(4\)</span>，但按照上面的修改这样会得到 <span class="arithmatex">\(5\)</span>。将 <span class="arithmatex">\(c[y]\)</span> 直接修改为 <span class="arithmatex">\(p\)</span> 也是错误的，一个反例是，将上面例子中的 <span class="arithmatex">\(3\)</span> 修改为 <span class="arithmatex">\(4\)</span>。</p>
<p>事实上，对于不可差分信息，不存在通过 <span class="arithmatex">\(p\)</span> 直接修改 <span class="arithmatex">\(c[y]\)</span> 的方式。这是因为修改本身就相当于是把旧数从原区间「移除」，然后加入一个新数。「移除」时对区间信息的影响，相当于做「逆运算」，而不可差分信息不存在「逆运算」，所以无法直接修改 <span class="arithmatex">\(c[y]\)</span>。</p>
<p>换句话说，对每个受影响的 <span class="arithmatex">\(c[y]\)</span>，这个区间的信息我们必定要重构了。</p>
<p>考虑 <span class="arithmatex">\(c[y]\)</span> 的儿子们，它们的信息一定是正确的（因为我们先更新儿子再更新父亲），而这些儿子又恰好组成了 <span class="arithmatex">\([l(y), y - 1]\)</span> 这一段管辖区间，那再合并一个单点 <span class="arithmatex">\(a[y]\)</span> 就可以合并出 <span class="arithmatex">\([l(y), y]\)</span>，也就是 <span class="arithmatex">\(c[y]\)</span> 了。这样，我们能用至多 <span class="arithmatex">\(\log n\)</span> 个区间重构合并出每个需要修改的 <span class="arithmatex">\(c\)</span>。</p>
<details class="note" open="open">
<summary>实现</summary>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-14-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-14-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-14-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-14-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-14-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-14-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-14-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-14-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-14-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="w">  </span><span class="n">a</span><span class="p">[</span><span class="n">x</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">v</span><span class="p">;</span>
<a id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">lowbit</span><span class="p">(</span><span class="n">i</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="w">    </span><span class="c1">// 枚举受影响的区间</span>
<a id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="w">    </span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">lowbit</span><span class="p">(</span><span class="n">i</span><span class="p">);</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="w">      </span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="w"> </span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">j</span><span class="p">]);</span>
<a id="__codelineno-14-8" name="__codelineno-14-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-14-9" name="__codelineno-14-9"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-14-10" name="__codelineno-14-10"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</details>
<p>容易看出上述算法时间复杂度为 <span class="arithmatex">\(\Theta(\log^2n)\)</span>。</p>
<h3 id="_19">建树<a class="headerlink" href="#_19" title="Permanent link">&para;</a></h3>
<p>可以考虑拆成 <span class="arithmatex">\(n\)</span> 个单点修改，<span class="arithmatex">\(\Theta(n\log^2n)\)</span> 建树。</p>
<p>也有 <span class="arithmatex">\(\Theta(n)\)</span> 的建树方法，见本页面 <a href="#thetan-建树"><span class="arithmatex">\(\Theta(n)\)</span> 建树</a> 一节的方法一。</p>
<h2 id="tricks">Tricks<a class="headerlink" href="#tricks" title="Permanent link">&para;</a></h2>
<h3 id="thetan"><span class="arithmatex">\(\Theta(n)\)</span> 建树<a class="headerlink" href="#thetan" title="Permanent link">&para;</a></h3>
<p>以维护区间和为例。</p>
<p>方法一：</p>
<p>每一个节点的值是由所有与自己直接相连的儿子的值求和得到的。因此可以倒着考虑贡献，即每次确定完儿子的值后，用自己的值更新自己的直接父亲。</p>
<details class="note" open="open">
<summary>实现</summary>
<div class="tabbed-set tabbed-alternate" data-tabs="7:2"><input checked="checked" id="__tabbed_7_1" name="__tabbed_7" type="radio" /><input id="__tabbed_7_2" name="__tabbed_7" type="radio" /><div class="tabbed-labels"><label for="__tabbed_7_1">C++</label><label for="__tabbed_7_2">Python</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1">1</a></span>
<span class="normal"><a href="#__codelineno-15-2">2</a></span>
<span class="normal"><a href="#__codelineno-15-3">3</a></span>
<span class="normal"><a href="#__codelineno-15-4">4</a></span>
<span class="normal"><a href="#__codelineno-15-5">5</a></span>
<span class="normal"><a href="#__codelineno-15-6">6</a></span>
<span class="normal"><a href="#__codelineno-15-7">7</a></span>
<span class="normal"><a href="#__codelineno-15-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="c1">// Θ(n) 建树</span>
<a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="kt">void</span><span class="w"> </span><span class="nf">init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">lowbit</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<a id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Python</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1">1</a></span>
<span class="normal"><a href="#__codelineno-16-2">2</a></span>
<span class="normal"><a href="#__codelineno-16-3">3</a></span>
<span class="normal"><a href="#__codelineno-16-4">4</a></span>
<span class="normal"><a href="#__codelineno-16-5">5</a></span>
<span class="normal"><a href="#__codelineno-16-6">6</a></span>
<span class="normal"><a href="#__codelineno-16-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="c1"># Θ(n) 建树</span>
<a id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">init</span><span class="p">():</span>
<a id="__codelineno-16-3" name="__codelineno-16-3"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-16-4" name="__codelineno-16-4"></a>        <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-16-5" name="__codelineno-16-5"></a>        <span class="n">j</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">lowbit</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-16-6" name="__codelineno-16-6"></a>        <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">:</span>
<a id="__codelineno-16-7" name="__codelineno-16-7"></a>            <span class="n">t</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
</details>
<p>方法二：</p>
<p>前面讲到 <span class="arithmatex">\(c[i]\)</span> 表示的区间是 <span class="arithmatex">\([i-\operatorname{lowbit}(i)+1, i]\)</span>，那么我们可以先预处理一个 <span class="arithmatex">\(\mathrm{sum}\)</span> 前缀和数组，再计算 <span class="arithmatex">\(c\)</span> 数组。</p>
<details class="note" open="open">
<summary>实现</summary>
<div class="tabbed-set tabbed-alternate" data-tabs="8:2"><input checked="checked" id="__tabbed_8_1" name="__tabbed_8" type="radio" /><input id="__tabbed_8_2" name="__tabbed_8" type="radio" /><div class="tabbed-labels"><label for="__tabbed_8_1">C++</label><label for="__tabbed_8_2">Python</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1">1</a></span>
<span class="normal"><a href="#__codelineno-17-2">2</a></span>
<span class="normal"><a href="#__codelineno-17-3">3</a></span>
<span class="normal"><a href="#__codelineno-17-4">4</a></span>
<span class="normal"><a href="#__codelineno-17-5">5</a></span>
<span class="normal"><a href="#__codelineno-17-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="c1">// Θ(n) 建树</span>
<a id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="kt">void</span><span class="w"> </span><span class="nf">init</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">n</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sum</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">sum</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">lowbit</span><span class="p">(</span><span class="n">i</span><span class="p">)];</span>
<a id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-17-6" name="__codelineno-17-6"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Python</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1">1</a></span>
<span class="normal"><a href="#__codelineno-18-2">2</a></span>
<span class="normal"><a href="#__codelineno-18-3">3</a></span>
<span class="normal"><a href="#__codelineno-18-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="c1"># Θ(n) 建树</span>
<a id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">init</span><span class="p">():</span>
<a id="__codelineno-18-3" name="__codelineno-18-3"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
<a id="__codelineno-18-4" name="__codelineno-18-4"></a>        <span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="nb">sum</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="n">lowbit</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
</details>
<h3 id="_20">时间戳优化<a class="headerlink" href="#_20" title="Permanent link">&para;</a></h3>
<p>对付多组数据很常见的技巧。若每次输入新数据都暴力清空树状数组，就可能会造成超时。因此使用 <span class="arithmatex">\(\mathrm{tag}\)</span> 标记，存储当前节点上次使用时间（即最近一次是被第几组数据使用）。每次操作时判断这个位置 <span class="arithmatex">\(\mathrm{tag}\)</span> 中的时间和当前时间是否相同，就可以判断这个位置应该是 <span class="arithmatex">\(0\)</span> 还是数组内的值。</p>
<details class="note" open="open">
<summary>实现</summary>
<div class="tabbed-set tabbed-alternate" data-tabs="9:2"><input checked="checked" id="__tabbed_9_1" name="__tabbed_9" type="radio" /><input id="__tabbed_9_2" name="__tabbed_9" type="radio" /><div class="tabbed-labels"><label for="__tabbed_9_1">C++</label><label for="__tabbed_9_2">Python</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">C++</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-19-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-19-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-19-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-19-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-19-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-19-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-19-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-19-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-19-10">10</a></span>
<span class="normal"><a href="#__codelineno-19-11">11</a></span>
<span class="normal"><a href="#__codelineno-19-12">12</a></span>
<span class="normal"><a href="#__codelineno-19-13">13</a></span>
<span class="normal"><a href="#__codelineno-19-14">14</a></span>
<span class="normal"><a href="#__codelineno-19-15">15</a></span>
<span class="normal"><a href="#__codelineno-19-16">16</a></span>
<span class="normal"><a href="#__codelineno-19-17">17</a></span>
<span class="normal"><a href="#__codelineno-19-18">18</a></span>
<span class="normal"><a href="#__codelineno-19-19">19</a></span>
<span class="normal"><a href="#__codelineno-19-20">20</a></span>
<span class="normal"><a href="#__codelineno-19-21">21</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="c1">// 时间戳优化</span>
<a id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="kt">int</span><span class="w"> </span><span class="n">tag</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">MAXN</span><span class="p">],</span><span class="w"> </span><span class="n">Tag</span><span class="p">;</span>
<a id="__codelineno-19-3" name="__codelineno-19-3"></a>
<a id="__codelineno-19-4" name="__codelineno-19-4"></a><span class="kt">void</span><span class="w"> </span><span class="nf">reset</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="o">++</span><span class="n">Tag</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-19-5" name="__codelineno-19-5"></a>
<a id="__codelineno-19-6" name="__codelineno-19-6"></a><span class="kt">void</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-7" name="__codelineno-19-7"></a><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-8" name="__codelineno-19-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tag</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">Tag</span><span class="p">)</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-19-9" name="__codelineno-19-9"></a><span class="w">    </span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">tag</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Tag</span><span class="p">;</span>
<a id="__codelineno-19-10" name="__codelineno-19-10"></a><span class="w">    </span><span class="n">k</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">lowbit</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
<a id="__codelineno-19-11" name="__codelineno-19-11"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-19-12" name="__codelineno-19-12"></a><span class="p">}</span>
<a id="__codelineno-19-13" name="__codelineno-19-13"></a>
<a id="__codelineno-19-14" name="__codelineno-19-14"></a><span class="kt">int</span><span class="w"> </span><span class="nf">getsum</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-15" name="__codelineno-19-15"></a><span class="w">  </span><span class="kt">int</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-19-16" name="__codelineno-19-16"></a><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-17" name="__codelineno-19-17"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">tag</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">Tag</span><span class="p">)</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">];</span>
<a id="__codelineno-19-18" name="__codelineno-19-18"></a><span class="w">    </span><span class="n">k</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">lowbit</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
<a id="__codelineno-19-19" name="__codelineno-19-19"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-19-20" name="__codelineno-19-20"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span>
<a id="__codelineno-19-21" name="__codelineno-19-21"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Python</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-20-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-20-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-20-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-20-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-20-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-20-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-20-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-20-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-20-10">10</a></span>
<span class="normal"><a href="#__codelineno-20-11">11</a></span>
<span class="normal"><a href="#__codelineno-20-12">12</a></span>
<span class="normal"><a href="#__codelineno-20-13">13</a></span>
<span class="normal"><a href="#__codelineno-20-14">14</a></span>
<span class="normal"><a href="#__codelineno-20-15">15</a></span>
<span class="normal"><a href="#__codelineno-20-16">16</a></span>
<span class="normal"><a href="#__codelineno-20-17">17</a></span>
<span class="normal"><a href="#__codelineno-20-18">18</a></span>
<span class="normal"><a href="#__codelineno-20-19">19</a></span>
<span class="normal"><a href="#__codelineno-20-20">20</a></span>
<span class="normal"><a href="#__codelineno-20-21">21</a></span>
<span class="normal"><a href="#__codelineno-20-22">22</a></span>
<span class="normal"><a href="#__codelineno-20-23">23</a></span>
<span class="normal"><a href="#__codelineno-20-24">24</a></span>
<span class="normal"><a href="#__codelineno-20-25">25</a></span>
<span class="normal"><a href="#__codelineno-20-26">26</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="c1"># 时间戳优化</span>
<a id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="n">tag</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">MAXN</span>
<a id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="n">t</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">MAXN</span>
<a id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="n">Tag</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-20-5" name="__codelineno-20-5"></a>
<a id="__codelineno-20-6" name="__codelineno-20-6"></a>
<a id="__codelineno-20-7" name="__codelineno-20-7"></a><span class="k">def</span><span class="w"> </span><span class="nf">reset</span><span class="p">():</span>
<a id="__codelineno-20-8" name="__codelineno-20-8"></a>    <span class="n">Tag</span> <span class="o">=</span> <span class="n">Tag</span> <span class="o">+</span> <span class="mi">1</span>
<a id="__codelineno-20-9" name="__codelineno-20-9"></a>
<a id="__codelineno-20-10" name="__codelineno-20-10"></a>
<a id="__codelineno-20-11" name="__codelineno-20-11"></a><span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
<a id="__codelineno-20-12" name="__codelineno-20-12"></a>    <span class="k">while</span> <span class="n">k</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">:</span>
<a id="__codelineno-20-13" name="__codelineno-20-13"></a>        <span class="k">if</span> <span class="n">tag</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">!=</span> <span class="n">Tag</span><span class="p">:</span>
<a id="__codelineno-20-14" name="__codelineno-20-14"></a>            <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-20-15" name="__codelineno-20-15"></a>        <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">v</span>
<a id="__codelineno-20-16" name="__codelineno-20-16"></a>        <span class="n">tag</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tag</span>
<a id="__codelineno-20-17" name="__codelineno-20-17"></a>        <span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="n">lowbit</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a id="__codelineno-20-18" name="__codelineno-20-18"></a>
<a id="__codelineno-20-19" name="__codelineno-20-19"></a>
<a id="__codelineno-20-20" name="__codelineno-20-20"></a><span class="k">def</span><span class="w"> </span><span class="nf">getsum</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
<a id="__codelineno-20-21" name="__codelineno-20-21"></a>    <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-20-22" name="__codelineno-20-22"></a>    <span class="k">while</span> <span class="n">k</span><span class="p">:</span>
<a id="__codelineno-20-23" name="__codelineno-20-23"></a>        <span class="k">if</span> <span class="n">tag</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">Tag</span><span class="p">:</span>
<a id="__codelineno-20-24" name="__codelineno-20-24"></a>            <span class="n">ret</span> <span class="o">=</span> <span class="n">ret</span> <span class="o">+</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
<a id="__codelineno-20-25" name="__codelineno-20-25"></a>        <span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">-</span> <span class="n">lowbit</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a id="__codelineno-20-26" name="__codelineno-20-26"></a>    <span class="k">return</span> <span class="n">ret</span>
</code></pre></div></td></tr></table></div>
</div>
</div>
</div>
</details>
<h2 id="_21">例题<a class="headerlink" href="#_21" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://loj.ac/problem/130">树状数组 1：单点修改，区间查询</a></li>
<li><a href="https://loj.ac/problem/131">树状数组 2：区间修改，单点查询</a></li>
<li><a href="https://loj.ac/problem/132">树状数组 3：区间修改，区间查询</a></li>
<li><a href="https://loj.ac/problem/133">二维树状数组 1：单点修改，区间查询</a></li>
<li><a href="https://loj.ac/problem/134">二维树状数组 2：区间修改，单点查询</a></li>
<li><a href="https://loj.ac/problem/135">二维树状数组 3：区间修改，区间查询</a></li>
</ul>
<!--
  Copyright (c) 2016-2023 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Render date of last update -->


<!-- Render date of creation -->


<!-- ---------------------------------------------------------------------- -->

<!-- Render authors -->


<!-- ---------------------------------------------------------------------- -->

<!-- Render committers from GitHub -->


<!-- Render committers from GitLab -->


<!-- Render committers -->


<!-- ---------------------------------------------------------------------- -->

<!-- Determine date of last update -->

  

  <!-- Determine date of creation -->
  


<!-- Source file information -->

<!--
  Copyright (c) 2016-2023 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Determine feedback configuration -->

  


<!-- Determine whether to show feedback -->


<!-- Was this page helpful? -->

  <form class="md-feedback" name="feedback" hidden>
    <fieldset>
      <legend class="md-feedback__title">
        此页面有帮助吗？
      </legend>
      <div class="md-feedback__inner">

        <!-- Feedback ratings -->
        <div class="md-feedback__list">
          
            <button
              class="md-feedback__icon md-icon"
              type="submit"
              title="This page was helpful"
              data-md-value="1"
            >
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M5 9v12H1V9zm4 12a2 2 0 0 1-2-2V9c0-.55.22-1.05.59-1.41L14.17 1l1.06 1.06c.27.27.44.64.44 1.05l-.03.32L14.69 8H21a2 2 0 0 1 2 2v2c0 .26-.05.5-.14.73l-3.02 7.05C19.54 20.5 18.83 21 18 21zm0-2h9.03L21 12v-2h-8.79l1.13-5.32L9 9.03z"/></svg>
            </button>
          
            <button
              class="md-feedback__icon md-icon"
              type="submit"
              title="This page could be improved"
              data-md-value="0"
            >
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 15V3h4v12zM15 3a2 2 0 0 1 2 2v10c0 .55-.22 1.05-.59 1.41L9.83 23l-1.06-1.06c-.27-.27-.44-.64-.44-1.06l.03-.31.95-4.57H3a2 2 0 0 1-2-2v-2c0-.26.05-.5.14-.73l3.02-7.05C4.46 3.5 5.17 3 6 3zm0 2H5.97L3 12v2h8.78l-1.13 5.32L15 14.97z"/></svg>
            </button>
          
        </div>

        <!-- Feedback rating notes (shown after submission) -->
        <div class="md-feedback__note">
          
            <div data-md-value="1" hidden>
              

              <!-- Determine title -->
              
                
              

              <!-- Replace {url} and {title} placeholders in note -->
              谢谢你的反馈！
            </div>
          
            <div data-md-value="0" hidden>
              

              <!-- Determine title -->
              
                
              

              <!-- Replace {url} and {title} placeholders in note -->
              Thanks for your feedback! Help us improve this page by using our <a href="https://marketingplatform.google.com/about/analytics/" target="_blank" rel="noopener">feedback form</a>.
            </div>
          
        </div>
      </div>
    </fieldset>
  </form>

<!--
  Copyright (c) 2016-2023 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Comment system -->





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <style>
  .md-footer {
      background-color: #f0f0f0;
  }
</style>


<!-- Footer -->
<footer class="md-footer">

  <!-- Link to previous and/or next page -->
  
    
  

  <!-- Further information -->
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; gzh
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
   
      <font color="#B9B9B9">
      <div class="footer-visit-count" style="display: flex; justify-content: center; align-items: center;color: #000;">
        本站访问量：<script async src="//finicounter.eu.org/finicounter.js"></script>
        <span id="finicount_views"></span>    &nbsp;|&nbsp;
        <footer>
          <a href="https://icp.gov.moe/?keyword=20230640" target="_blank">萌ICP备20230640号</a>
        </footer>
      </div>
      </font>

        <style>
          .footer-visit-count {
              height: fit-content;
              min-height: 55px; /* 根据实际情况调整此高度 */
              color: #000;
          }
          </style>
        
          <div class="md-social">
  
    
    
    
    
    <a href="https://cdn.jsdelivr.net/gh/Gongzihang6/Pictures@main/Medias/%E6%88%91%E7%9A%84%E5%BE%AE%E4%BF%A1%E4%BA%8C%E7%BB%B4%E7%A0%81.png" target="_blank" rel="noopener" title="Wechat" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M385.2 167.6c6.4 0 12.6.3 18.8 1.1C387.4 90.3 303.3 32 207.7 32 100.5 32 13 104.8 13 197.4c0 53.4 29.3 97.5 77.9 131.6l-19.3 58.6 68-34.1c24.4 4.8 43.8 9.7 68.2 9.7 6.2 0 12.1-.3 18.3-.8-4-12.9-6.2-26.6-6.2-40.8-.1-84.9 72.9-154 165.3-154m-104.5-52.9c14.5 0 24.2 9.7 24.2 24.4 0 14.5-9.7 24.2-24.2 24.2-14.8 0-29.3-9.7-29.3-24.2.1-14.7 14.6-24.4 29.3-24.4m-136.4 48.6c-14.5 0-29.3-9.7-29.3-24.2 0-14.8 14.8-24.4 29.3-24.4 14.8 0 24.4 9.7 24.4 24.4 0 14.6-9.6 24.2-24.4 24.2M563 319.4c0-77.9-77.9-141.3-165.4-141.3-92.7 0-165.4 63.4-165.4 141.3S305 460.7 397.6 460.7c19.3 0 38.9-5.1 58.6-9.9l53.4 29.3-14.8-48.6C534 402.1 563 363.2 563 319.4m-219.1-24.5c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.8 0 24.4 9.7 24.4 19.3 0 10-9.7 19.6-24.4 19.6m107.1 0c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.5 0 24.4 9.7 24.4 19.3.1 10-9.9 19.6-24.4 19.6"/></svg>
    </a>
  
    
    
    
    
    <a href="https://t.me/gongzihang" target="_blank" rel="noopener" title="telegram" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M248 8C111.033 8 0 119.033 0 256s111.033 248 248 248 248-111.033 248-248S384.967 8 248 8m114.952 168.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.45 10.45 0 0 1 3.53 6.716 43.8 43.8 0 0 1 .417 9.769"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/ZihangGong28792" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8l164.9-188.5L26.8 48h145.6l100.5 132.9zm-24.8 373.8h39.1L151.1 88h-42z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/Gongzihang6" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:<zihanggong24@gmail.com>" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M64 112c-8.8 0-16 7.2-16 16v22.1l172.5 141.6c20.7 17 50.4 17 71.1 0L464 150.1V128c0-8.8-7.2-16-16-16zM48 212.2V384c0 8.8 7.2 16 16 16h384c8.8 0 16-7.2 16-16V212.2L322 328.8c-38.4 31.5-93.7 31.5-132 0zM0 128c0-35.3 28.7-64 64-64h384c35.3 0 64 28.7 64 64v256c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://space.bilibili.com/688234000/lists" target="_blank" rel="noopener" title="space.bilibili.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M488.6 104.1c16.7 18.1 24.4 39.7 23.3 65.7v202.4c-.4 26.4-9.2 48.1-26.5 65.1-17.2 17-39.1 25.9-65.5 26.7H92.02c-26.45-.8-48.21-9.8-65.28-27.2C9.682 419.4.767 396.5 0 368.2V169.8c.767-26 9.682-47.6 26.74-65.7C43.81 87.75 65.57 78.77 92.02 78h29.38L96.05 52.19c-5.75-5.73-8.63-13-8.63-21.79 0-8.8 2.88-16.06 8.63-21.797C101.8 2.868 109.1 0 117.9 0q13.2 0 21.9 8.603L213.1 78h88l74.5-69.397C381.7 2.868 389.2 0 398 0q13.2 0 21.9 8.603c5.7 5.737 8.6 12.997 8.6 21.797 0 8.79-2.9 16.06-8.6 21.79L394.6 78h29.3c26.4.77 48 9.75 64.7 26.1m-38.8 69.7c-.4-9.6-3.7-17.4-10.7-23.5-5.2-6.1-14-9.4-22.7-9.8H96.05c-9.59.4-17.45 3.7-23.58 9.8-6.14 6.1-9.4 13.9-9.78 23.5v194.4c0 9.2 3.26 17 9.78 23.5s14.38 9.8 23.58 9.8H416.4c9.2 0 17-3.3 23.3-9.8s9.7-14.3 10.1-23.5zm-264.3 42.7c6.3 6.3 9.7 14.1 10.1 23.2V273c-.4 9.2-3.7 16.9-9.8 23.2-6.2 6.3-14 9.5-23.6 9.5s-17.5-3.2-23.6-9.5-9.4-14-9.8-23.2v-33.3c.4-9.1 3.8-16.9 10.1-23.2s13.2-9.6 23.3-10c9.2.4 17 3.7 23.3 10m191.5 0c6.3 6.3 9.7 14.1 10.1 23.2V273c-.4 9.2-3.7 16.9-9.8 23.2s-14 9.5-23.6 9.5-17.4-3.2-23.6-9.5c-7-6.3-9.4-14-9.7-23.2v-33.3c.3-9.1 3.7-16.9 10-23.2s14.1-9.6 23.3-10c9.2.4 17 3.7 23.3 10"/></svg>
    </a>
  
</div>
        
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            


  


<h4>Cookie consent</h4>
<p>我们也使用cookies来识别您的重复访问和偏好来衡量我们文档的有效性以及用户是否找到他们要找的东西。 如果你同意,你可以帮助我们让我们的网站更好</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
    
      
        
  
  
    
    
  
  <li class="task-list-item">
    <label class="task-list-control">
      <input type="checkbox" name="analytics" checked>
      <span class="task-list-indicator"></span>
      Google Analytics
    </label>
  </li>

      
    
    
      
        
  
  
    
    
  
  <li class="task-list-item">
    <label class="task-list-control">
      <input type="checkbox" name="github" checked>
      <span class="task-list-indicator"></span>
      GitHub
    </label>
  </li>

      
    
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">同意</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">管理设定</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script>
    
    
      
      <script id="__config" type="application/json">{"base": "../../../../../..", "features": ["announce.dismiss", "navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.top", "navigation.footer", "search.suggest", "search.highlight", "search.share", "navigation.expand", "navigation.indexes", "content.tabs.link", "content.tooltips", "content.code.copy", "content.code.select", "content.code.annotate"], "search": "../../../../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../../../../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="../../../../../../javascripts/extra.js"></script>
      
        <script src="../../../../../../javascripts/config_mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="../../../../../../javascripts/简历.js"></script>
      
    
  </body>
</html>