
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="记录、分享">
      
      
        <meta name="author" content="minghu6">
      
      
        <link rel="canonical" href="https://gongzihang6.github.io/blog/Computer%20Science/Algorithm/docs/string/bm/">
      
      
      
      
      <link rel="icon" href="https://s2.loli.net/2025/02/12/aE5ovtzAlNTd9Uh.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.14">
    
    
      
        <title>Bm - Blog of GZH</title>
      
    
    
      <link rel="stylesheet" href="../../../../../../assets/stylesheets/main.342714a4.min.css">
      
        
        <link rel="stylesheet" href="../../../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="../../../../../../stylesheets/extra2.css">
    
      <link rel="stylesheet" href="../../../../../../stylesheets/简历.css">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Wcowin/Wcowin.github.io@main/docs/stylesheets/link.css">
    
      <link rel="stylesheet" href="../../../../../../stylesheets/customize.css">
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600&display=swap">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Wcowin/Wcowin.github.io@main/docs/stylesheets/ziti.css">
    
    <script>__md_scope=new URL("../../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-40HC6RYSR1"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-40HC6RYSR1",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-40HC6RYSR1",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          跳转至
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="页眉">
    <a href="../../../../../.." title="Blog of GZH" class="md-header__button md-logo" aria-label="Blog of GZH" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 89 89">
  <path d="M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z" />
  <path d="M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z" style="fill-opacity: 0.5" />
  <path d="M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z" />
  <path d="M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z" style="fill-opacity: 0.25" />
</svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Blog of GZH
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Bm
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="关闭自动模式"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="关闭自动模式" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="indigo"  aria-label="切换至夜间模式"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="切换至夜间模式" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="切换至日间模式"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="切换至日间模式" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
      <div class="md-header__option">
  <div class="md-select">
    
    <button class="md-header__button md-icon" aria-label="选择当前语言">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M0 128c0-35.3 28.7-64 64-64h512c35.3 0 64 28.7 64 64v256c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64zm320 0v256h256V128zm-141.7 47.9c-3.2-7.2-10.4-11.9-18.3-11.9s-15.1 4.7-18.3 11.9l-64 144c-4.5 10.1.1 21.9 10.2 26.4s21.9-.1 26.4-10.2l8.9-20.1h73.6l8.9 20.1c4.5 10.1 16.3 14.6 26.4 10.2s14.6-16.3 10.2-26.4zM160 233.2l19 42.8h-38zM448 164c11 0 20 9 20 20v4h60c11 0 20 9 20 20s-9 20-20 20h-2l-1.6 4.5c-8.9 24.4-22.4 46.6-39.6 65.4.9.6 1.8 1.1 2.7 1.6l18.9 11.3c9.5 5.7 12.5 18 6.9 27.4s-18 12.5-27.4 6.9L467 333.8c-4.5-2.7-8.8-5.5-13.1-8.5-10.6 7.5-21.9 14-34 19.4l-3.6 1.6c-10.1 4.5-21.9-.1-26.4-10.2s.1-21.9 10.2-26.4l3.6-1.6c6.4-2.9 12.6-6.1 18.5-9.8L410 286.1c-7.8-7.8-7.8-20.5 0-28.3s20.5-7.8 28.3 0l14.6 14.6.5.5c12.4-13.1 22.5-28.3 29.8-45l-35.2.1h-72c-11 0-20-9-20-20s9-20 20-20h52v-4c0-11 9-20 20-20"/></svg>
    </button>
    <div class="md-select__inner">
      <ul class="md-select__list">
        
          <li class="md-select__item">
            <a href="/" hreflang="zh" class="md-select__link">
              简体中文
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/Mkdocs-Wcowin/en/" hreflang="en" class="md-select__link">
              English
            </a>
          </li>
        
          <li class="md-select__item">
            <a href="/Mkdocs-Wcowin/ZH-TW/" hreflang="zh-TW" class="md-select__link">
              China(TW)
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</div>
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="搜索" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256l137.3-137.4c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="查找">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="分享" aria-label="分享" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="清空当前内容" aria-label="清空当前内容" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Gongzihang6" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    Gongzihang6
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="标签" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../.." class="md-tabs__link">
        
  
  
    
  
  主页

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../java%E5%9F%BA%E7%A1%80/" class="md-tabs__link">
          
  
  
    
  
  Computer Science

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../MachineLearning/K%E8%BF%91%E9%82%BB%E5%AD%A6%E4%B9%A0%E4%B8%8E%E9%99%8D%E7%BB%B4/" class="md-tabs__link">
          
  
  
    
  
  MachineLearning

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../%E6%AF%8F%E6%97%A5%E8%AF%97%E8%AF%8D/%E8%99%9E%E7%BE%8E%E4%BA%BA%C2%B7%E7%8E%89%E9%98%91%E5%B9%B2%E5%A4%96%E6%B8%85%E6%B1%9F%E6%B5%A6/" class="md-tabs__link">
          
  
  
    
  
  每日诗词

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../%E6%9C%8B%E5%8F%8B%E5%9C%88/" class="md-tabs__link">
          
  
  
    
  
  朋友圈

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../%E9%95%BF%E6%9C%9F%E4%B8%BB%E4%B9%89/fitness/" class="md-tabs__link">
          
  
  
    
  
  长期主义

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../../../about/geren/" class="md-tabs__link">
          
  
  
    
  
  关于

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="导航栏" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../../.." title="Blog of GZH" class="md-nav__button md-logo" aria-label="Blog of GZH" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 89 89">
  <path d="M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z" />
  <path d="M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z" style="fill-opacity: 0.5" />
  <path d="M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z" />
  <path d="M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z" style="fill-opacity: 0.25" />
</svg>

    </a>
    Blog of GZH
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Gongzihang6" title="前往仓库" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    Gongzihang6
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    主页
    
  </span>
  
    
  
  
    <span class="md-status md-status--new"></span>
  

  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Computer Science
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Computer Science
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Java
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            Java
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E5%9F%BA%E7%A1%80/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Java面向对象基础
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../%E5%B8%B8%E7%94%A8API/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Java集合框架与常用API
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../java%E6%8F%90%E9%AB%98/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Java高级技术
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Algorithm
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Algorithm
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../%E7%AE%97%E6%B3%95%E5%9F%BA%E7%A1%80/%E5%B9%B6%E6%9F%A5%E9%9B%86/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    并查集
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    LeetCode热题100
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            LeetCode热题100
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode%E7%83%AD%E9%A2%98100/%E5%AD%97%E6%AF%8D%E5%BC%82%E4%BD%8D%E8%AF%8D%E5%88%86%E7%BB%84/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    字母异位词分组
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_4" >
        
          
          <label class="md-nav__link" for="__nav_2_4" id="__nav_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    LeetCode
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_4">
            <span class="md-nav__icon md-icon"></span>
            LeetCode
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/%E4%BA%A4%E6%98%93%E9%80%86%E5%BA%8F%E5%AF%B9%E7%9A%84%E6%80%BB%E6%95%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    交易逆序对的总数
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/%E5%8D%95%E8%AF%8D%E6%8E%A5%E9%BE%99/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    单词接龙
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/%E5%B2%9B%E5%B1%BF%E6%95%B0%E9%87%8F/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    岛屿数量
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/%E5%88%86%E8%80%83%E5%9C%BA/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    分考场
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/%E6%8B%89%E9%A9%AC%E8%BD%A6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    拉马车
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/%E5%88%86%E5%B7%A7%E5%85%8B%E5%8A%9B/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    分巧克力
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/k%E5%80%8D%E5%8C%BA%E9%97%B4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    K倍区间
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/%E7%BC%96%E8%BE%91%E8%B7%9D%E7%A6%BB/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    编辑距离
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/%E6%8E%A5%E9%9B%A8%E6%B0%B4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    接雨水
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/%E7%BB%84%E5%90%88%E6%80%BB%E5%92%8C/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    组合总和
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/%E5%85%A8%E6%8E%92%E5%88%97/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    全排列
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/%E4%B9%98%E7%A7%AF%E6%9C%80%E5%A4%A7%E5%AD%90%E6%95%B0%E7%BB%84/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    乘积最大子数组
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/%E6%9C%80%E9%95%BF%E5%9B%9E%E6%96%87%E5%AD%90%E4%B8%B2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    5. 最长回文子串
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/%E5%89%8DK%E4%B8%AA%E9%AB%98%E9%A2%91%E5%85%83%E7%B4%A0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    前K个高频元素
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/%E6%9C%80%E5%B0%8F%E6%A0%88/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    最小栈
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/Pow%28x%2Cn%29/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pow(x,n)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/%E7%BD%91%E7%BB%9C%E5%BB%B6%E8%BF%9F%E6%97%B6%E9%97%B4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    网络延迟时间
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/%E8%AE%A1%E7%AE%97%E8%B4%A8%E6%95%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    计算质数
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/%E5%AF%B9%E8%A7%92%E7%BA%BF%E4%B8%8A%E7%9A%84%E8%B4%A8%E6%95%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    对角线上的质数
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/%E9%9B%B6%E9%92%B1%E5%85%91%E6%8D%A2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    零钱兑换
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/01%E7%9F%A9%E9%98%B5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    01矩阵
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/%E4%BA%8C%E5%88%86%E6%9F%A5%E6%89%BE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    二分查找
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/%E6%8B%AC%E5%8F%B7%E5%8C%B9%E9%85%8D/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    括号匹配
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/300%E6%9C%80%E9%95%BF%E9%80%92%E5%A2%9E%E5%AD%90%E5%BA%8F%E5%88%97/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    300最长递增子序列
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/115%E4%B8%8D%E5%90%8C%E7%9A%84%E5%AD%90%E5%BA%8F%E5%88%97/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    115不同的子序列
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/712%E4%B8%A4%E4%B8%AA%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%9C%80%E5%B0%8FASCII%E5%88%A0%E9%99%A4%E5%92%8C/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    712两个字符串的最小ASCII删除和
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/516%E6%9C%80%E9%95%BF%E5%9B%9E%E6%96%87%E5%AD%90%E5%BA%8F%E5%88%97/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    516最长回文子序列
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/139%E5%8D%95%E8%AF%8D%E6%8B%86%E5%88%86/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    139单词拆分
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/221%E6%9C%80%E5%A4%A7%E6%AD%A3%E6%96%B9%E5%BD%A2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    221最大正方形
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/2845%E7%BB%9F%E8%AE%A1%E8%B6%A3%E5%91%B3%E5%AD%90%E6%95%B0%E7%BB%84%E7%9A%84%E6%95%B0%E7%9B%AE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2845统计趣味子数组的数目
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/2799%E7%BB%9F%E8%AE%A1%E5%AE%8C%E5%85%A8%E5%AD%90%E6%95%B0%E7%BB%84%E7%9A%84%E6%95%B0%E7%9B%AE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2799统计完全子数组的数目
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/1399%E7%BB%9F%E8%AE%A1%E6%9C%80%E5%A4%A7%E7%BB%84%E7%9A%84%E6%95%B0%E7%9B%AE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    1399统计最大组的数目
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/2338%E7%BB%9F%E8%AE%A1%E7%90%86%E6%83%B3%E6%95%B0%E7%BB%84%E7%9A%84%E6%95%B0%E7%9B%AE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2338统计理想数组的数目
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/2179%E7%BB%9F%E8%AE%A1%E6%95%B0%E7%BB%84%E4%B8%AD%E5%A5%BD%E4%B8%89%E5%85%83%E7%BB%84%E6%95%B0%E7%9B%AE/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2179统计数组中好三元组数目
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/2537%E7%BB%9F%E8%AE%A1%E5%A5%BD%E5%AD%90%E6%95%B0%E7%BB%84%E7%9A%84%E6%95%B0/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2537统计好子数组的数
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/2140%E8%A7%A3%E5%86%B3%E6%99%BA%E5%8A%9B%E9%97%AE%E9%A2%98/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2140解决智力问题
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../LeetCode/2278%E5%AD%97%E6%AF%8D%E5%9C%A8%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%AD%E7%9A%84%E7%99%BE%E5%88%86%E6%AF%94/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2278字母在字符串中的百分比
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    MachineLearning
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            MachineLearning
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MachineLearning/K%E8%BF%91%E9%82%BB%E5%AD%A6%E4%B9%A0%E4%B8%8E%E9%99%8D%E7%BB%B4/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    K近邻学习与降维
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MachineLearning/%E6%A8%A1%E5%9E%8B%E8%AF%84%E4%BC%B0%E4%B8%8E%E5%A4%9A%E5%88%86%E7%B1%BB/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    模型评估与多分类
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MachineLearning/%E5%85%AC%E5%BC%8F%E6%B5%8B%E8%AF%95/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    公式测试
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MachineLearning/%E7%BB%8F%E5%85%B8%E5%8D%B7%E7%A7%AF%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    经典卷积神经网络
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../MachineLearning/%E7%90%86%E8%A7%A3YOLO%E7%BD%91%E7%BB%9C%E7%BB%93%E6%9E%84/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    理解YOLO网络结构
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    每日诗词
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            每日诗词
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../%E6%AF%8F%E6%97%A5%E8%AF%97%E8%AF%8D/%E8%99%9E%E7%BE%8E%E4%BA%BA%C2%B7%E7%8E%89%E9%98%91%E5%B9%B2%E5%A4%96%E6%B8%85%E6%B1%9F%E6%B5%A6/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    虞美人·玉阑干外清江浦
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../%E6%AF%8F%E6%97%A5%E8%AF%97%E8%AF%8D/%E8%8F%A9%E8%90%A8%E8%9B%AE%C2%B7%E5%9B%9E%E6%96%87%E5%A4%8F%E9%97%BA%E6%80%A8/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    菩萨蛮·回文夏闺怨
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../%E6%AF%8F%E6%97%A5%E8%AF%97%E8%AF%8D/%E6%B8%85%E5%B9%B3%E4%B9%90%C2%B7%E5%85%AD%E7%9B%98%E5%B1%B1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    清平乐·六盘山
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../%E6%AF%8F%E6%97%A5%E8%AF%97%E8%AF%8D/%E6%B4%9E%E4%BB%99%E6%AD%8C%C2%B7%E5%92%8F%E6%9F%B3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    洞仙歌·咏柳
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../%E6%AF%8F%E6%97%A5%E8%AF%97%E8%AF%8D/%E7%A7%8B%E5%85%B4%E5%85%AB%E9%A6%96%C2%B7%E5%85%B6%E4%B8%80/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    秋兴八首·其一
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../%E6%AF%8F%E6%97%A5%E8%AF%97%E8%AF%8D/%E4%B8%8E%E5%8F%B2%E9%83%8E%E4%B8%AD%E9%92%A6%E5%90%AC%E9%BB%84%E9%B9%A4%E6%A5%BC%E4%B8%8A%E5%90%B9%E7%AC%9B/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    与史郎中钦听黄鹤楼上吹笛
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../%E6%AF%8F%E6%97%A5%E8%AF%97%E8%AF%8D/%E5%A4%8F%E6%97%A5%E5%8D%97%E4%BA%AD%E6%80%80%E8%BE%9B%E5%A4%A7/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    夏日南亭怀辛大
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../%E6%AF%8F%E6%97%A5%E8%AF%97%E8%AF%8D/%E8%A1%8C%E9%A6%99%E5%AD%90%C2%B7%E7%A7%8B%E4%B8%8E/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    行香子·秋与
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../%E6%AF%8F%E6%97%A5%E8%AF%97%E8%AF%8D/%E8%87%AA%E9%A2%98%E9%87%91%E5%B1%B1%E7%94%BB%E5%83%8F/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    自题金山画像
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    朋友圈
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            朋友圈
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../%E6%9C%8B%E5%8F%8B%E5%9C%88/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    朋友圈
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    长期主义
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            长期主义
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../%E9%95%BF%E6%9C%9F%E4%B8%BB%E4%B9%89/fitness/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Fitness
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    关于
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            关于
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../about/geren/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    作者个人简介
    
  </span>
  
    
  
  
    <span class="md-status md-status--new"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../about/%E7%AE%80%E5%8E%86/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    个人简历
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../about/zcw/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    支持作者
    
  </span>
  
    
  
  
    <span class="md-status md-status--new"></span>
  

  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../about/test/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    功能测试
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目录
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      引入
    </span>
  </a>
  
    <nav class="md-nav" aria-label="引入">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1" class="md-nav__link">
    <span class="md-ellipsis">
      观察 1
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2" class="md-nav__link">
    <span class="md-ellipsis">
      观察 2
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3a" class="md-nav__link">
    <span class="md-ellipsis">
      观察 3(a)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3b" class="md-nav__link">
    <span class="md-ellipsis">
      观察 3(b)
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      过程
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      算法设计
    </span>
  </a>
  
    <nav class="md-nav" aria-label="算法设计">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      最初的匹配算法
    </span>
  </a>
  
    <nav class="md-nav" aria-label="最初的匹配算法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      解释
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      过程
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      对匹配算法的一个改进
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#delta2" class="md-nav__link">
    <span class="md-ellipsis">
      delta2 构建细节
    </span>
  </a>
  
    <nav class="md-nav" aria-label="delta2 构建细节">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      引入
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      朴素算法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      高效算法
    </span>
  </a>
  
    <nav class="md-nav" aria-label="高效算法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      第一种情况
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      第二种情况
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      第三种情况
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      实现
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#galil" class="md-nav__link">
    <span class="md-ellipsis">
      Galil 规则对多次匹配时最坏情况的改善
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Galil 规则对多次匹配时最坏情况的改善">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      关于后缀匹配算法的多次匹配问题
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#galil_1" class="md-nav__link">
    <span class="md-ellipsis">
      Galil 规则
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      最坏情况在实践中性能影响
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      改进算法
    </span>
  </a>
  
    <nav class="md-nav" aria-label="改进算法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#simplified-boyermoore" class="md-nav__link">
    <span class="md-ellipsis">
      Simplified Boyer–Moore 算法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#boyermoorehorspol" class="md-nav__link">
    <span class="md-ellipsis">
      Boyer–Moore–Horspol 算法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#boyermooresunday" class="md-nav__link">
    <span class="md-ellipsis">
      Boyer–Moore–Sunday 算法
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#bmhbnfs" class="md-nav__link">
    <span class="md-ellipsis">
      BMHBNFS 算法
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BMHBNFS 算法">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      时间节省版本
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      空间节省版本
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      理论分析
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      参考资料与注释
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>Bm</h1>

<div class="admonition info">
<p class="admonition-title">💾 AI智能摘要 (DeepSeek)</p>
<p>BM算法通过后缀匹配优化字符串搜索效率，利用坏字符规则（delta1）和好后缀规则（delta2）实现快速跳转。当模式串与文本失配时，delta1根据坏字符位置计算滑动距离，delta2则基于已匹配后缀在模式串中的最右重现位置。该算法通过预处理生成跳转表，将最坏时间复杂度降至O(n/m)，特别适合处理长模式串和大字符集场景。</p>
</div>
<div class="admonition info">
<p class="admonition-title">📖 阅读信息</p>
<p>阅读时间：<strong>3</strong> 分钟 | 中文字符：<strong>1361</strong> | 有效代码行数：<strong>325</strong></p>
</div>
<p>前置知识：<a href="../kmp/">前缀函数与 KMP 算法</a>。</p>
<p>KMP 算法将前缀匹配的信息用到了极致，</p>
<p>而 BM 算法背后的基本思想是通过后缀匹配获得比前缀匹配更多的信息来实现更快的字符跳转。</p>
<h2 id="_1">引入<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>想象一下，如果我们的的模式字符串 <span class="arithmatex">\(pat\)</span>，被放在文本字符串 <span class="arithmatex">\(string\)</span> 的左手起头部，使它们的第一个字符对齐。</p>
<div class="arithmatex">\[
\begin{aligned}
\textit{pat}:\qquad\qquad &amp;\texttt{EXAMPLE} \\
\textit{string}:\qquad\quad &amp;\texttt{HERE IS A SIMPLE EXAMPLE} \dots \\
&amp;\qquad\ \ \ \, \, \Uparrow
\end{aligned}
\]</div>
<p>在这里做定义，往后不赘述：</p>
<p><span class="arithmatex">\(pat\)</span> 的长度为 <span class="arithmatex">\(patlen\)</span>，特别地对于从 0 开始的串来说，规定 <span class="arithmatex">\(patlastpos=patlen-1\)</span> 为 <span class="arithmatex">\(pat\)</span> 串最后一个字符的位置；</p>
<p><span class="arithmatex">\(string\)</span> 的长度 <span class="arithmatex">\(stringlen\)</span>，<span class="arithmatex">\(stringlastpos = stringlen-1\)</span>。</p>
<p>假如我们知道了 <span class="arithmatex">\(string\)</span> 的第 <span class="arithmatex">\(patlen\)</span> 个字符 <span class="arithmatex">\(char\)</span>（与 <span class="arithmatex">\(pat\)</span> 的最后一个字符对齐）考虑我们能得到什么信息：</p>
<h3 id="1">观察 1<a class="headerlink" href="#1" title="Permanent link">&para;</a></h3>
<p>如果我们知道 <span class="arithmatex">\(char\)</span> 这个字符不在 <span class="arithmatex">\(pat\)</span> 中，我们就不用考虑 <span class="arithmatex">\(pat\)</span> 从 <span class="arithmatex">\(string\)</span> 的第 <span class="arithmatex">\(1\)</span> 个、第 <span class="arithmatex">\(2\)</span> 个……第 <span class="arithmatex">\(patlen\)</span> 个字符起出现的情况，，而可以直接将 <span class="arithmatex">\(pat\)</span> 向下滑动 <span class="arithmatex">\(patlen\)</span> 个字符。</p>
<h3 id="2">观察 2<a class="headerlink" href="#2" title="Permanent link">&para;</a></h3>
<p>更一般地，<strong>如果出现在 <span class="arithmatex">\(pat\)</span> 最末尾（也就是最右边）的那一个 <span class="arithmatex">\(char\)</span> 字符的位置是离末尾端差了 <span class="arithmatex">\(delta_1\)</span> 个字符</strong>，</p>
<p>那么就可以不用匹配，直接将 <span class="arithmatex">\(pat\)</span> 向后滑动 <span class="arithmatex">\(delta_1\)</span> 个字符：如果滑动距离少于 <span class="arithmatex">\(delta_1\)</span>，那么仅就 <span class="arithmatex">\(char\)</span> 这个字符就无法被匹配，当然模式字符串 <span class="arithmatex">\(pat\)</span> 也就不会被匹配。</p>
<p>因此除非 <span class="arithmatex">\(char\)</span> 字符可以和 <span class="arithmatex">\(pat\)</span> 末尾的那个字符匹配，否则 <span class="arithmatex">\(string\)</span> 要跳过 <span class="arithmatex">\(delta_1\)</span> 个字符（相当于 <span class="arithmatex">\(pat\)</span> 向后滑动了 <span class="arithmatex">\(delta_1\)</span> 个字符）。并且我们可以得到一个计算 <span class="arithmatex">\(delta_1\)</span> 的函数 <span class="arithmatex">\(delta_1(char)\)</span>：</p>
<div class="arithmatex">\[
\begin{array}{ll}
\textbf{int}\ delta1(\textbf{char}\ char) \\
\qquad \textbf{if}\ \text{char不在pat中 || char是pat上最后一个字符} \\
\qquad\qquad\textbf{return}\ patlen \\
\qquad \textbf{else} \\
\qquad\qquad\textbf{return}\ patlastpos-i\quad\textbf{//}\ \text{i为出现在pat最末尾的那一个char出现的位置，即pat[i]=char}
\end{array}
\]</div>
<p><strong>注意：显然这个表只需计算到 <span class="arithmatex">\(patlastpos-1\)</span> 的位置</strong></p>
<p>现在假设 <span class="arithmatex">\(char\)</span> 和 <span class="arithmatex">\(pat\)</span> 最后一个字符匹配到了，那我们就看看 <span class="arithmatex">\(char\)</span> 前一个字符和 <span class="arithmatex">\(pat\)</span> 的倒数第二个字符是否匹配：</p>
<p>如果是，就继续回退直到整个模式串 <span class="arithmatex">\(pat\)</span> 完成匹配（这时我们就在 <span class="arithmatex">\(string\)</span> 上成功得到了一个 <span class="arithmatex">\(pat\)</span> 的匹配）；</p>
<p>或者，我们也可能会在匹配完 <span class="arithmatex">\(pat\)</span> 的倒数第 <span class="arithmatex">\(m\)</span> 个字符后，在倒数第 <span class="arithmatex">\(m+1\)</span> 个字符上失配，这时我们就希望把 <span class="arithmatex">\(pat\)</span> 向后滑动到下一个可能会实现匹配的位置，当然我们希望滑动得越远越好。</p>
<h3 id="3a">观察 3(a)<a class="headerlink" href="#3a" title="Permanent link">&para;</a></h3>
<p>在 <strong>观察 2</strong> 中提到，当匹配完 <span class="arithmatex">\(pat\)</span> 的倒数 <span class="arithmatex">\(m\)</span> 个字符后，如果在倒数第 <span class="arithmatex">\(m+1\)</span> 个字符失配，为了使得 <span class="arithmatex">\(string\)</span> 中的失配字符与 <span class="arithmatex">\(pat\)</span> 上对应字符对齐，</p>
<p>需要把 <span class="arithmatex">\(pat\)</span> 向后滑动 <span class="arithmatex">\(k\)</span> 个字符，也就是说我们应该把注意力看向之后的 <span class="arithmatex">\(k+m\)</span> 个字符（也就是看向 <span class="arithmatex">\(pat\)</span> 滑动 k 之后，末段与 <span class="arithmatex">\(string\)</span> 对齐的那个字符）。</p>
<p>而 <span class="arithmatex">\(k=delta_1-m\)</span>，</p>
<p>所以我们的注意力应该沿着 <span class="arithmatex">\(string\)</span> 向后跳 <span class="arithmatex">\(delta_1-m+m = delta_1\)</span> 个字符。</p>
<p>然而，我们有机会跳过更多的字符，请继续看下去。</p>
<h3 id="3b">观察 3(b)<a class="headerlink" href="#3b" title="Permanent link">&para;</a></h3>
<p>如果我们知道 <span class="arithmatex">\(string\)</span> 接下来的 <span class="arithmatex">\(m\)</span> 个字符和 <span class="arithmatex">\(pat\)</span> 的最后 <span class="arithmatex">\(m\)</span> 个字符匹配，假设这个子串为 <span class="arithmatex">\(subpat\)</span>，</p>
<p>我们还知道在 <span class="arithmatex">\(string\)</span> 失配字符 <span class="arithmatex">\(char\)</span> 后面是与 <span class="arithmatex">\(subpat\)</span> 相匹配的子串，而假如 <span class="arithmatex">\(pat\)</span> 对应失配字符前面存在 <span class="arithmatex">\(subpat\)</span>，我们可以将 <span class="arithmatex">\(pat\)</span> 向下滑动一段距离，</p>
<p>使得失配字符 <span class="arithmatex">\(char\)</span> 在 <span class="arithmatex">\(pat\)</span> 上对应的字符前面出现的 <span class="arithmatex">\(subpat\)</span>（合理重现，plausible reoccurrence，以下也简称 pr）与 <span class="arithmatex">\(string\)</span> 的 <span class="arithmatex">\(subpat\)</span> 对齐。如果 <span class="arithmatex">\(pat\)</span> 上有多个 <span class="arithmatex">\(subpat\)</span>，按照从右到左的后缀匹配顺序，取第一个（rightmost plausible reoccurrence，以下也简称 rpr）。</p>
<p>假设此时 <span class="arithmatex">\(pat\)</span> 向下滑动的 <span class="arithmatex">\(k\)</span> 个字符（也即 <span class="arithmatex">\(pat\)</span> 末尾端的 <span class="arithmatex">\(subpat\)</span> 与其最右边的合理重现的距离），这样我们的注意力应该沿着 <span class="arithmatex">\(string\)</span> 向后滑动 <span class="arithmatex">\(k+m\)</span> 个字符，这段距离我们称之为 <span class="arithmatex">\(delta_2(j)\)</span>：</p>
<p>假定 <span class="arithmatex">\(rpr(j)\)</span> 为 <span class="arithmatex">\(subpat=pat[j+1\dots patlastpos]\)</span> 在 <span class="arithmatex">\(pat[j]\)</span> 上失配时的最右边合理重现的位置，<span class="arithmatex">\(rpr(j) &lt; j\)</span>（这里只给出简单定义，在下文的算法设计章节里会有更精确的讨论），那么显然 <span class="arithmatex">\(k=j-rpr(j),\ m=patlastpos-j\)</span>。</p>
<p>所以有：</p>
<div class="arithmatex">\[
\begin{array}{ll}
\textbf{int}\ delta2(\textbf{int}\ j) \quad\textbf{//}\ \text{j为失配字符在pat上对应字符的位置} \\
\qquad\qquad\textbf{return}\ patlastpos-rpr(j) \\
\end{array}
\]</div>
<p>于是我们在失配时，可以把把 <span class="arithmatex">\(string\)</span> 上的注意力往后跳过 <span class="arithmatex">\(\max(delta_1,delta_2)\)</span> 个字符</p>
<h2 id="_2">过程<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>箭头指向失配字符 <span class="arithmatex">\(char\)</span>：</p>
<div class="arithmatex">\[
\begin{aligned}
\textit{pat}:\qquad\qquad &amp;\texttt{AT-THAT} \\
\textit{string}:\ \ \ \dots\ &amp;\texttt{WHICH-FINALLY-HALTS.--AT-THAT-POINT} \dots \\
&amp;\qquad\ \ \ \, \, \Uparrow
\end{aligned}
\]</div>
<p><span class="arithmatex">\(\texttt{F}\)</span> 没有出现 <span class="arithmatex">\(pat\)</span> 中，根据 <strong>观察 1</strong>，<span class="arithmatex">\(pat\)</span> 直接向下移动 <span class="arithmatex">\(patlen\)</span> 个字符，也就是 7 个字符：</p>
<div class="arithmatex">\[
\begin{aligned}
\textit{pat}:\qquad\qquad &amp;\qquad\quad\ \ \, \texttt{AT-THAT} \\
\textit{string}:\ \ \ \dots\ &amp;\texttt{WHICH-FINALLY-HALTS.--AT-THAT-POINT} \dots \\
&amp;\qquad\ \ \ \, \, \qquad\quad\ \ \ \Uparrow
\end{aligned}
\]</div>
<p>根据 <strong>观察 2</strong>，我们需要将 <span class="arithmatex">\(pat\)</span> 向下移动 4 个字符使得短横线字符对齐：</p>
<div class="arithmatex">\[
\begin{aligned}
\textit{pat}:\qquad\qquad &amp;\qquad\qquad\quad\ \ \, \texttt{AT-THAT} \\
\textit{string}:\ \ \ \dots\ &amp;\texttt{WHICH-FINALLY-HALTS.--AT-THAT-POINT} \dots \\
&amp;\qquad\ \ \ \; \qquad\qquad\qquad \Uparrow
\end{aligned}
\]</div>
<p>现在<em>char</em>:<span class="arithmatex">\(\texttt{T}\)</span> 匹配了，把 <span class="arithmatex">\(string\)</span> 上的指针左移一步继续匹配：</p>
<div class="arithmatex">\[
\begin{aligned}
\textit{pat}:\qquad\qquad &amp;\qquad\qquad\quad\ \ \, \texttt{AT-THAT} \\
\textit{string}:\ \ \ \dots\ &amp;\texttt{WHICH-FINALLY-HALTS.--AT-THAT-POINT} \dots \\
&amp;\qquad\ \ \ \; \qquad\qquad\quad\ \, \Uparrow
\end{aligned}
\]</div>
<p>根据 <strong>观察 3(a)</strong>，<span class="arithmatex">\(\texttt{L}\)</span> 失配，因为 <span class="arithmatex">\(\texttt{L}\)</span> 不在 <span class="arithmatex">\(pat\)</span> 中，所以 <span class="arithmatex">\(pat\)</span> 向下移动 <span class="arithmatex">\(k=delta_1-m=7-1=6\)</span> 个字符，而 <span class="arithmatex">\(string\)</span> 上指针向下移动 <span class="arithmatex">\(delta_1=7\)</span> 个字符：</p>
<div class="arithmatex">\[
\begin{aligned}
\textit{pat}:\qquad\qquad &amp;\qquad\qquad\qquad\qquad\ \ \,\, \texttt{AT-THAT} \\
\textit{string}:\ \ \ \dots\ &amp;\texttt{WHICH-FINALLY-HALTS.--AT-THAT-POINT} \dots \\
&amp;\qquad\ \ \ \; \qquad\qquad\qquad\qquad\ \ \ \, \, \Uparrow
\end{aligned}
\]</div>
<p>这时 <span class="arithmatex">\(char\)</span> 又一次匹配到了 <span class="arithmatex">\(pat\)</span> 的最后一个字符 <span class="arithmatex">\(\texttt{T}\)</span>，<span class="arithmatex">\(string\)</span> 上的指针向左匹配，匹配到了 <span class="arithmatex">\(\texttt{A}\)</span>，继续向左匹配，发现在字符 <span class="arithmatex">\(\texttt{-}\)</span> 失配：</p>
<div class="arithmatex">\[
\begin{aligned}
\textit{pat}:\qquad\qquad &amp;\qquad\qquad\qquad\qquad\ \ \,\, \texttt{AT-THAT} \\
\textit{string}:\ \ \ \dots\ &amp;\texttt{WHICH-FINALLY-HALTS.--AT-THAT-POINT} \dots \\
&amp;\qquad\ \ \ \; \qquad\qquad\qquad\quad\ \ \ \,\, \Uparrow
\end{aligned}
\]</div>
<p>显然直观上看，此时根据 <strong>观察 3(b)</strong>，将 <span class="arithmatex">\(pat\)</span> 向下移动 <span class="arithmatex">\(k=5\)</span> 个字符，使得后缀 <span class="arithmatex">\(\texttt{AT}\)</span> 对齐，这种滑动可以获得 <span class="arithmatex">\(string\)</span> 指针最大的滑动距离，此时 <span class="arithmatex">\(delta_2=k+patlastpos-j=5+6-4=7\)</span>，即 <span class="arithmatex">\(string\)</span> 上指针向下滑动 7 个字符。</p>
<p>而从形式化逻辑看，此时，<span class="arithmatex">\(delta_1=7-1-2=4,\ delta_2=7, \max(delta_1,delta_2)= 7\)</span>，
这样从形式逻辑上支持了进行 <strong>观察 3(b)</strong> 的跳转：</p>
<div class="arithmatex">\[
\begin{aligned}
\textit{pat}:\qquad\qquad &amp;\qquad\qquad\qquad\qquad\qquad\quad \;\, \texttt{AT-THAT} \\
\textit{string}:\ \ \ \dots\ &amp;\texttt{WHICH-FINALLY-HALTS.--AT-THAT-POINT} \dots \\
&amp;\qquad\ \ \ \; \qquad\qquad\qquad\qquad\qquad\quad \ \ \; \Uparrow
\end{aligned}
\]</div>
<p>现在我们发现了 <span class="arithmatex">\(pat\)</span> 上每一个字符都和 <span class="arithmatex">\(string\)</span> 上对应的字符相等，我们在 <span class="arithmatex">\(string\)</span> 上找到了一个 <span class="arithmatex">\(pat\)</span> 的匹配。而只花费了 14 次对 <span class="arithmatex">\(string\)</span> 的引用，其中 7 次是完成一个成功的匹配所必需的比较次数（<span class="arithmatex">\(patlen=7\)</span>），另外 7 次让我们跳过了 22 个字符。</p>
<h2 id="_3">算法设计<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<h3 id="_4">最初的匹配算法<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<h4 id="_5">解释<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h4>
<p>现在看这样一个利用 <span class="arithmatex">\(delta_1\)</span> 和 <span class="arithmatex">\(delta_2\)</span> 进行字符串匹配的算法：</p>
<div class="arithmatex">\[
\begin{array}{ll}
i \gets patlastpos. \\
j \gets patlastpos. \\
\textbf{loop}\\
\qquad \textbf{if}\ j &lt; 0 \\
\qquad \qquad \textbf{return}\ i+1 \\
\\
\qquad \textbf{if}\ string[i]=pat[j] \\
\qquad \qquad j \gets j-1 \\
\qquad \qquad i \gets i-1 \\
\qquad \qquad \textbf{continue} \\
\\
\qquad i \gets i+max(delta_1(string[i]), delta_2(j)) \\
\\
\qquad \textbf{if}\ i &gt; stringlastpos \\
\qquad \qquad \textbf{return}\ false \\
\qquad j \gets patlastpos \\
\end{array}
\]</div>
<p>如果上面的算法 <span class="arithmatex">\(\textbf{return}\ false\)</span>，表明 <span class="arithmatex">\(pat\)</span> 不在 <span class="arithmatex">\(string\)</span> 中；如果返回一个数字，表示 <span class="arithmatex">\(pat\)</span> 在 <span class="arithmatex">\(string\)</span> 左起第一次出现的位置。</p>
<p>然后让我们更精细地描述下计算 <span class="arithmatex">\(delta_2\)</span>，所依靠的 <span class="arithmatex">\(rpr(j)\)</span> 函数。</p>
<p>根据前文定义，<span class="arithmatex">\(rpr(j)\)</span> 表示在 <span class="arithmatex">\(pat(j)\)</span> 失配时，子串 <span class="arithmatex">\(subpat=pat[j+1\dots patlastpos]\)</span> 在 <span class="arithmatex">\(pat[j]\)</span> 最右边合理重现的位置。</p>
<p>也就是说需要找到一个最好的 <span class="arithmatex">\(k\)</span>, 使得 <span class="arithmatex">\(pat[k\dots k+patlastpos-j-1]=pat[j+1\dots patlastpos]\)</span>，另外要考虑两种特殊情况：</p>
<ol>
<li>当 <span class="arithmatex">\(k&lt;0\)</span> 时，相当于在 <span class="arithmatex">\(pat\)</span> 前面补充了一段虚拟的前缀，实际上也符合 <span class="arithmatex">\(delta_2\)</span> 跳转的原理。</li>
<li>当 <span class="arithmatex">\(k&gt;0\)</span> 时，如果 <span class="arithmatex">\(pat[k-1]=pat[j]\)</span>，则这个 <span class="arithmatex">\(pat[k\dots k+patlastpos-j-1]\)</span> 不能作为 <span class="arithmatex">\(subpat\)</span> 的合理重现。
    原因是 <span class="arithmatex">\(pat[j]\)</span> 本身是失配字符，所以 <span class="arithmatex">\(pat\)</span> 向下滑动 <span class="arithmatex">\(k\)</span> 个字符后，在后缀匹配过程中仍然会在 <span class="arithmatex">\(pat[k-1]\)</span> 处失配。</li>
</ol>
<p>还要注意两个限制条件：</p>
<ol>
<li><span class="arithmatex">\(k &lt; j\)</span>。因为当 <span class="arithmatex">\(k=j\)</span> 时，有 <span class="arithmatex">\(pat[k]=pat[j]\)</span>，在 <span class="arithmatex">\(pat[j]\)</span> 上失配的字符也会在 <span class="arithmatex">\(pat[k]\)</span> 上失配。</li>
<li>考虑到 <span class="arithmatex">\(delta_2(patlastpos)= 0\)</span>，所以规定 <span class="arithmatex">\(rpr(patlastpos) = patlastpos\)</span>。</li>
</ol>
<h4 id="_6">过程<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h4>
<p>由于理解 <span class="arithmatex">\(rpr(j)\)</span> 是实现 BoyerMoore 算法的核心，所以我们使用如下两个例子进行详细说明：</p>
<div class="arithmatex">\[
\begin{aligned}
\textit{j}:\qquad\qquad\quad\ \ &amp;\texttt{0 1 2 3 4 5 6 7 8} \\
\textit{pat}:\qquad\qquad\ \  &amp;\texttt{A B C X X X A B C} \\
\textit{rpr(j)}:\qquad\quad\  \  &amp;\texttt{5 4 3 2 1 0 2 1 8} \\
\textit{sgn}:\qquad\qquad\ \   &amp;\texttt{- - - - - - - - +}
\end{aligned}
\]</div>
<p>对于 <span class="arithmatex">\(rpr(0)\)</span>，<span class="arithmatex">\(subpat\)</span> 为 <span class="arithmatex">\(\texttt{BCXXXABC}\)</span>，在 <span class="arithmatex">\(pat[0]\)</span> 之前的最右边合理重现只能是 <span class="arithmatex">\(\texttt{[(BCXXX)ABC]XXXABC}\)</span>，也就是最右边合理重现位置为 -5，即 <span class="arithmatex">\(rpr(j)=-5\)</span>；</p>
<p>对于 <span class="arithmatex">\(rpr(1)\)</span>，<span class="arithmatex">\(subpat\)</span> 为 <span class="arithmatex">\(\texttt{CXXXABC}\)</span>，在 <span class="arithmatex">\(pat[1]\)</span> 之前的最右边的合理重现是 <span class="arithmatex">\(\texttt{[(CXXX)ABC]XXXABC}\)</span>，所以 <span class="arithmatex">\(rpr(j)=-4\)</span>；</p>
<p>对于 <span class="arithmatex">\(rpr(2)\)</span>，<span class="arithmatex">\(subpat\)</span> 为 <span class="arithmatex">\(\texttt{XXXABC}\)</span>，在 <span class="arithmatex">\(pat[2]\)</span> 之前的最右边的合理重现是 <span class="arithmatex">\(\texttt{[(XXX)ABC]XXXABC}\)</span>，所以 <span class="arithmatex">\(rpr(j)=-3\)</span>；</p>
<p>对于 <span class="arithmatex">\(rpr(3)\)</span>，<span class="arithmatex">\(subpat\)</span> 为 <span class="arithmatex">\(\texttt{XXABC}\)</span>，在 <span class="arithmatex">\(pat[3]\)</span> 之前的最右边的合理重现是 <span class="arithmatex">\(\texttt{[(XX)ABC]XXXABC}\)</span>，所以 <span class="arithmatex">\(rpr(j)=-2\)</span>；</p>
<p>对于 <span class="arithmatex">\(rpr(4)\)</span>，<span class="arithmatex">\(subpat\)</span> 为 <span class="arithmatex">\(\texttt{XABC}\)</span>，在 <span class="arithmatex">\(pat[4]\)</span> 之前的最右边的合理重现是 <span class="arithmatex">\(\texttt{[(X)ABC]XXXABC}\)</span>，所以 <span class="arithmatex">\(rpr(j)=-1\)</span>；</p>
<p>对于 <span class="arithmatex">\(rpr(5)\)</span>，<span class="arithmatex">\(subpat\)</span> 为 <span class="arithmatex">\(\texttt{ABC}\)</span>，在 <span class="arithmatex">\(pat[5]\)</span> 之前的最右边的合理重现是 <span class="arithmatex">\(\texttt{[ABC]XXXABC}\)</span>，所以 <span class="arithmatex">\(rpr(j)=0\)</span>；</p>
<p>对于 <span class="arithmatex">\(rpr(6)\)</span>，<span class="arithmatex">\(subpat\)</span> 为 <span class="arithmatex">\(\texttt{BC}\)</span>，又因为 <span class="arithmatex">\(string[0]=string[6]\)</span>，即 <span class="arithmatex">\(string[0]\)</span> 等于失配字符 <span class="arithmatex">\(string[6]\)</span>，所以 <span class="arithmatex">\(string[0\dots 2]\)</span> 并不是符合条件的 <span class="arithmatex">\(subpat\)</span> 的合理重现，所以在最右边的合理重现是 <span class="arithmatex">\(\texttt{[(BC)]ABCXXXABC}\)</span>，所以 <span class="arithmatex">\(rpr(j)=-2\)</span>；</p>
<p>对于 <span class="arithmatex">\(rpr(7)\)</span>，<span class="arithmatex">\(subpat\)</span> 为 <span class="arithmatex">\(\texttt{C}\)</span>，同理又因为 <span class="arithmatex">\(string[7]=string[1]\)</span>，所以 <span class="arithmatex">\(string[1\dots 2]\)</span> 并不是符合条件的 <span class="arithmatex">\(subpat\)</span> 的合理重现，在最右边的合理重现是 <span class="arithmatex">\(\texttt{[(C)]ABCXXXABC}\)</span>，所以 <span class="arithmatex">\(rpr(j)=-1\)</span>；</p>
<p>对于 <span class="arithmatex">\(rpr(8)\)</span>，根据 <span class="arithmatex">\(delta_2\)</span> 定义，<span class="arithmatex">\(rpr(patlastpos)=patlastpos\)</span>，得到 <span class="arithmatex">\(rpr(8)=8\)</span>。</p>
<p>现在再看一下另一个例子：</p>
<div class="arithmatex">\[
\begin{aligned}
\textit{j}:\qquad\qquad\quad\ \ &amp;\texttt{0 1 2 3 4 5 6 7 8} \\
\textit{pat}:\qquad\qquad\ \ &amp;\texttt{A B Y X C D E Y X} \\
\textit{rpr(j)}:\qquad\quad\  \  &amp;\texttt{8 7 6 5 4 3 2 1 8} \\
\textit{sgn}:\qquad\qquad\ \   &amp;\texttt{- - - - - - + - +}
\end{aligned}
\]</div>
<p>对于 <span class="arithmatex">\(rpr(0)\)</span>，<span class="arithmatex">\(subpat\)</span> 为 <span class="arithmatex">\(\texttt{BYXCDEYX}\)</span>，在 <span class="arithmatex">\(pat[0]\)</span> 之前的最右边合理重现只能是 <span class="arithmatex">\(\texttt{[(BYXCDEYX)]ABYXCDEYX}\)</span>，也就是最右边合理重现位置为 -8，即 <span class="arithmatex">\(rpr(j)=-8\)</span>；</p>
<p>对于 <span class="arithmatex">\(rpr(1)\)</span>，<span class="arithmatex">\(subpat\)</span> 为 <span class="arithmatex">\(\texttt{YXCDEYX}\)</span>，在 <span class="arithmatex">\(pat[1]\)</span> 之前的最右边合理重现只能是 <span class="arithmatex">\(\texttt{[(YXCDEYX)]ABYXCDEYX}\)</span>，<span class="arithmatex">\(rpr(j)=-7\)</span>；</p>
<p>对于 <span class="arithmatex">\(rpr(2)\)</span>，<span class="arithmatex">\(subpat\)</span> 为 <span class="arithmatex">\(\texttt{XCDEYX}\)</span>，在 <span class="arithmatex">\(pat[2]\)</span> 之前的最右边合理重现只能是 <span class="arithmatex">\(\texttt{[(XCDEYX)]ABYXCDEYX}\)</span>，<span class="arithmatex">\(rpr(j)=-6\)</span>；</p>
<p>对于 <span class="arithmatex">\(rpr(3)\)</span>，<span class="arithmatex">\(subpat\)</span> 为 <span class="arithmatex">\(\texttt{CDEYX}\)</span>，在 <span class="arithmatex">\(pat[3]\)</span> 之前的最右边合理重现只能是 <span class="arithmatex">\(\texttt{[(CDEYX)]ABYXCDEYX}\)</span>，<span class="arithmatex">\(rpr(j)=-5\)</span>；</p>
<p>对于 <span class="arithmatex">\(rpr(4)\)</span>，<span class="arithmatex">\(subpat\)</span> 为 <span class="arithmatex">\(\texttt{DEYX}\)</span>，在 <span class="arithmatex">\(pat[4]\)</span> 之前的最右边合理重现只能是 <span class="arithmatex">\(\texttt{[(DEYX)]ABYXCDEYX}\)</span>，<span class="arithmatex">\(rpr(j)=-4\)</span>；</p>
<p>对于 <span class="arithmatex">\(rpr(5)\)</span>，<span class="arithmatex">\(subpat\)</span> 为 <span class="arithmatex">\(\texttt{EYX}\)</span>，在 <span class="arithmatex">\(pat[5]\)</span> 之前的最右边合理重现只能是 <span class="arithmatex">\(\texttt{[(EYX)]ABYXCDEYX}\)</span>，<span class="arithmatex">\(rpr(j)=-3\)</span>；</p>
<p>对于 <span class="arithmatex">\(rpr(6)\)</span>，<span class="arithmatex">\(subpat\)</span> 为 <span class="arithmatex">\(\texttt{YX}\)</span>，因为 <span class="arithmatex">\(string[2\dots 3]=string[7\dots 8]\)</span> 并且有 <span class="arithmatex">\(string[6]\neq string[1]\)</span>，所以在 <span class="arithmatex">\(pat[6]\)</span> 之前的最右边的合理重现是 <span class="arithmatex">\(\texttt{AB[YX]CDEYX}\)</span>，<span class="arithmatex">\(rpr(j)=2\)</span>；</p>
<p>对于 <span class="arithmatex">\(rpr(7)\)</span>，<span class="arithmatex">\(subpat\)</span> 为 <span class="arithmatex">\(\texttt{X}\)</span>，虽然 <span class="arithmatex">\(string[3]=string[8]\)</span> 但是因为 <span class="arithmatex">\(string[2] = string[7]\)</span>，所以在 <span class="arithmatex">\(pat[7]\)</span> 之前的最右边的合理重现是 <span class="arithmatex">\(\texttt{[X]ABYXCDEYX}\)</span>，<span class="arithmatex">\(rpr(j)=-1\)</span>;</p>
<p>对于 <span class="arithmatex">\(rpr(8)\)</span>，根据 <span class="arithmatex">\(delta_2\)</span> 定义，<span class="arithmatex">\(rpr(patlastpos)=patlastpos\)</span>，得到 <span class="arithmatex">\(rpr(8)=8\)</span>。</p>
<h3 id="_7">对匹配算法的一个改进<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<p>最后，实践过程中考虑到搜索过程中估计有 80% 的时间用在了 <strong>观察 1</strong> 的跳转上，也就是 <span class="arithmatex">\(string[i]\)</span> 和 <span class="arithmatex">\(pat[patlastpos]\)</span> 不匹配，然后跳跃整个 <span class="arithmatex">\(patlen\)</span> 进行下一次匹配的过程。</p>
<p>于是，可以为此进行特别的优化：</p>
<p>我们定义一个 <span class="arithmatex">\(delta0\)</span>：</p>
<div class="arithmatex">\[
\begin{array}{ll}
\textbf{int}\ delta0(\textbf{char}\ char) \\
\qquad \textbf{if}\ char=pat[patlastpos] \\
\qquad\qquad \textbf{return}\ large\ \ \text{// large为一个整数，需要满足large&gt;stringlastpos+patlen} \\
\qquad \textbf{return}\ delta1(char)
\end{array}
\]</div>
<p>用 <span class="arithmatex">\(delta0\)</span> 代替 <span class="arithmatex">\(delta_1\)</span>，得到改进后的匹配算法：</p>
<div class="arithmatex">\[
\begin{array}{ll}
i \gets patlastpos \\
\textbf{loop} \\
\qquad\textbf{if} \ i &gt; stringlastpos \\
\qquad\qquad\textbf{return}\ false\\
\\
\qquad\textbf{while}\ i &lt; stringlen \\
\qquad\qquad i \gets i+delta0(string(i)) \ \ \text{// 除非string[i]和pat末尾字符匹配，否则至多向下滑动patlen }\\\
\qquad\textbf{if}\ i \leqslant\ large \qquad\qquad\qquad\qquad \text{//此时表示string上没有一个字符和pat末尾字符匹配}\ \\
\qquad\qquad\textbf{return}\ false\\
\\
\qquad i \gets i-large \\
\qquad j \gets patlastpos. \\
\qquad\textbf{while}\ j \geqslant\ 0 \ and \  string[i]=pat[j]\\
\qquad \qquad j \gets j-1 \\
\qquad \qquad i \gets i-1 \\
\\
\qquad \textbf{if}\ j &lt; 0 \\
\qquad \qquad \textbf{return}\ i+1 \\
\qquad i \gets i+max(delta_1(string[i]), delta_2(j)) \\
\\
\end{array}
\]</div>
<p>其中 <span class="arithmatex">\(large\)</span> 起到多重作用，一是类似后面介绍的 Horspool 算法进行快速的坏字符跳转，二是辅助检测字符串搜索是否完成。</p>
<p>经过改进，比起原算法，在做 <strong>观察 1</strong> 跳转时不必每次进行 <span class="arithmatex">\(delta_2\)</span> 的多余计算，使得在通常字符集下搜索字符串的性能有了明显的提升。</p>
<h2 id="delta2">delta2 构建细节<a class="headerlink" href="#delta2" title="Permanent link">&para;</a></h2>
<h3 id="_8">引入<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h3>
<p>在 1977 年 10 月的<em>Communications of the ACM</em>上，Boyer、Moor 的论文<sup id="fnref:bm"><a class="footnote-ref" href="#fn:bm">1</a></sup>中只描述了 <span class="arithmatex">\(delta_2\)</span> 静态表，</p>
<p>构造 <span class="arithmatex">\(delta_2\)</span> 的具体实现的讨论出现在 1977 年 6 月 Knuth、Morris、Pratt 在<em>SIAM Journal on Computing</em>上正式联合发表的 KMP 算法的论文<sup id="fnref:kmp"><a class="footnote-ref" href="#fn:kmp">2</a></sup>。</p>
<h3 id="_9">朴素算法<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<p>在介绍 Knuth 的 <span class="arithmatex">\(delta_2\)</span> 构建算法之前，根据定义，我们会有一个适用于小规模问题的朴素算法：</p>
<ol>
<li>对于 <code>[0, patlen)</code> 区间的每一个位置 <code>i</code>，根据 <code>subpat</code> 的长度确定其重现位置的区间，也就是 <code>[-subpatlen, i]</code>；</li>
<li>可能的重现位置按照从右到左进行逐字符比较，寻找符合 <span class="arithmatex">\(delta_2\)</span> 要求的最右边 <span class="arithmatex">\(subpat\)</span> 的重现位置；</li>
<li>最后别忘了令 <span class="arithmatex">\(delta_2(lastpos)= 0\)</span>。</li>
</ol>
<details class="note" open="open">
<summary>实现</summary>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Rust</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-0-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-0-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-0-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-0-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-0-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-0-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-0-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-0-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-0-10">10</a></span>
<span class="normal"><a href="#__codelineno-0-11">11</a></span>
<span class="normal"><a href="#__codelineno-0-12">12</a></span>
<span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">cmp</span><span class="p">::</span><span class="nb">PartialEq</span><span class="p">;</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">build_delta_2_table_naive</span><span class="p">(</span><span class="n">p</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="p">[</span><span class="k">impl</span><span class="w"> </span><span class="nb">PartialEq</span><span class="p">])</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="kt">usize</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">patlen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">len</span><span class="p">();</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">lastpos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">patlen</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">delta_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[];</span>
<a id="__codelineno-0-7" name="__codelineno-0-7"></a>
<a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="n">patlen</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">subpatlen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">lastpos</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">isize</span><span class="p">;</span>
<a id="__codelineno-0-10" name="__codelineno-0-10"></a>
<a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">subpatlen</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="w">            </span><span class="n">delta_2</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="w">            </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="n">subpatlen</span><span class="o">..</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">isize</span><span class="p">).</span><span class="n">rev</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="w">            </span><span class="c1">// subpat 匹配</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="o">..</span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">subpatlen</span><span class="p">)</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="w">            </span><span class="p">.</span><span class="n">zip</span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="o">..</span><span class="n">patlen</span><span class="p">)</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="w">            </span><span class="p">.</span><span class="n">all</span><span class="p">(</span><span class="o">|</span><span class="p">(</span><span class="n">rpr_index</span><span class="p">,</span><span class="w"> </span><span class="n">subpat_index</span><span class="p">)</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">rpr_index</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="n">rpr_index</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">usize</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="n">subpat_index</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="w">                    </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="w">                </span><span class="kc">false</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="w">            </span><span class="p">})</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="w">            </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">p</span><span class="p">[(</span><span class="n">j</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">usize</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="w">            </span><span class="p">{</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="w">                </span><span class="n">delta_2</span><span class="p">.</span><span class="n">push</span><span class="p">((</span><span class="n">lastpos</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">isize</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">usize</span><span class="p">);</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="w">                </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="w">    </span><span class="n">delta_2</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</details>
<p>特别地，对 Rust 语言特性进行必要地解释，下不赘述：</p>
<ul>
<li><code>usize</code> 和 <code>isize</code> 是和内存指针同字节数的无符号整数和有符号整数，在 32 位机上相当于 <code>u32</code> 和 <code>i32</code>，64 位机上相当于 <code>u64</code> 和 <code>i64</code>。</li>
<li>索引数组、向量、分片时使用 <code>usize</code> 类型的数字（因为在做内存上的随机访问并且下标不能为负值），所以如果需要处理负值要用 <code>isize</code>，而进行索引时又要用 <code>usize</code>，这就看到使用 <code>as</code> 关键字进行二者之间的显式转换。</li>
<li><code>impl PartialEq</code> 只是用作泛型，可以同时支持 <code>Unicode</code> 编码的 <code>char</code> 和二进制的 <code>u8</code>。</li>
</ul>
<p>显然，该暴力算法的时间复杂度为 <span class="arithmatex">\(O(n^3)\)</span>。</p>
<h3 id="_10">高效算法<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h3>
<p>下面我们要介绍的是时间复杂度为 <span class="arithmatex">\(O(n)\)</span>，但是需要额外 <span class="arithmatex">\(O(n)\)</span> 空间复杂度的高效算法。</p>
<p>虽然 1977 年 Knuth 提出了这个构建方法，然而他的原始版本的构建算法存在一个缺陷，实际上对于某些 <span class="arithmatex">\(pat\)</span> 产生不出符合定义的 <span class="arithmatex">\(delta_2\)</span>。</p>
<p>Rytter 在 1980 年<em>SIAM Journal on Computing</em>上发表的文章<sup id="fnref:rytter"><a class="footnote-ref" href="#fn:rytter">3</a></sup>对此提出了修正，以下是 <span class="arithmatex">\(delta_2\)</span> 的构建算法：</p>
<p>首先考虑到 <span class="arithmatex">\(delta_2\)</span> 的定义比较复杂，我们按照 <span class="arithmatex">\(subpat\)</span> 的重现位置进行分类，每一类进行单独处理，这是高效实现的关键思路。</p>
<p>按照重现位置由远到近，也就是偏移量由大到小，分成如下几类：</p>
<ol>
<li>
<p>整个 <span class="arithmatex">\(subpat\)</span> 重现位置完全在 <span class="arithmatex">\(pat\)</span> 左边的，比如 <span class="arithmatex">\(\texttt{[(EYX)]ABYXCDEYX}\)</span>，此时 <span class="arithmatex">\(delta_2(j) = patlastpos\times 2 - j\)</span>；</p>
</li>
<li>
<p><span class="arithmatex">\(subpat\)</span> 的重现有一部分在 <span class="arithmatex">\(pat\)</span> 左边，有一部分是 <span class="arithmatex">\(pat\)</span> 头部，比如 <span class="arithmatex">\(\texttt{[(XX)ABC]XXXABC}\)</span>，此时 <span class="arithmatex">\(patlastpos &lt; delta_2(j) &lt; patlastpos\times 2 - j\)</span>；
    我们把 <span class="arithmatex">\(subpat\)</span> 完全在 <span class="arithmatex">\(pat\)</span> 头部的的边际情况也归类在这里（当然根据实现也可以归类在下边），比如 <span class="arithmatex">\(\texttt{[ABC]XXXABC}\)</span>，此时 <span class="arithmatex">\(patlastpos = delta_2(j)\)</span>；</p>
</li>
<li>
<p><span class="arithmatex">\(subpat\)</span> 的重现完全在 <span class="arithmatex">\(pat\)</span> 中，比如 <span class="arithmatex">\(\texttt{AB[YX]CDEYX}\)</span>，此时 <span class="arithmatex">\(delta_2(j) &lt; patlastpos\)</span>。</p>
</li>
</ol>
<p>现在来讨论如何高效地计算这三种情况：</p>
<h4 id="_11">第一种情况<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h4>
<p>这是最简单的情况，只需一次遍历并且可以顺便将 <span class="arithmatex">\(delta_2\)</span> 初始化。</p>
<h4 id="_12">第二种情况<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h4>
<p>我们观察什么时候会出现 <span class="arithmatex">\(subpat\)</span> 的重现一部分在 <span class="arithmatex">\(pat\)</span> 左边，一部分是 <span class="arithmatex">\(pat\)</span> 的头部的情况呢？应该是 <span class="arithmatex">\(subpat\)</span> 的某个后缀和 <span class="arithmatex">\(pat\)</span> 的某个前缀相等，</p>
<p>比如之前的例子：</p>
<div class="arithmatex">\[
\begin{aligned}
\textit{j}:\qquad\qquad\quad\ \ &amp;\texttt{0 1 2 3 4 5 6 7 8} \\
\textit{pat}:\qquad\qquad\ \  &amp;\texttt{A B C X X X A B C} \\
\end{aligned}
\]</div>
<p><span class="arithmatex">\(delta_2(3)\)</span> 的重现 <span class="arithmatex">\(\texttt{[(XX)ABC]XXXABC}\)</span>，<span class="arithmatex">\(subpat\)</span> <span class="arithmatex">\(\texttt{XXABC}\)</span> 的后缀与 pat 前缀中，有相等的，是 <span class="arithmatex">\(\texttt{ABC}\)</span>。</p>
<p><em>实际上对第二种和第三种情况的计算的关键都需要前缀函数的计算和和应用</em></p>
<p>那么只要 <span class="arithmatex">\(j\)</span> 取值使得 <span class="arithmatex">\(subpat\)</span> 包含这个相等的后缀，那么就可以得到第二种情况的 <span class="arithmatex">\(subpat\)</span> 的重现，对于例子，我们只需要使得 <span class="arithmatex">\(j \leqslant 5\)</span>，</p>
<p>而当 <span class="arithmatex">\(j = 5\)</span> 时，就是 <span class="arithmatex">\(subpat\)</span> 完全在 <span class="arithmatex">\(pat\)</span> 头部的边际情况。</p>
<p>可以计算此时的 <span class="arithmatex">\(delta_2(j)\)</span>：</p>
<p>设此时这对相等的前后缀长度为 <span class="arithmatex">\(\textit{prefixlen}\)</span>，可知 <span class="arithmatex">\(subpatlen = patlastpos - j\)</span>，那么在 <span class="arithmatex">\(pat\)</span> 左边的部分长度是 <span class="arithmatex">\(subpatlen-\textit{prefixlen}\)</span>，</p>
<p>而 <span class="arithmatex">\(rpr(j) = -(subpatlen-\textit{prefixlen})\)</span>，所以得到 <span class="arithmatex">\(delta_2(j) = patlastpos - rpr(j) = patlastpos \times 2 - j - \textit{prefixlen}\)</span>。</p>
<p>其后面可能会有多对相等的前缀和后缀，比如：</p>
<div class="arithmatex">\[
\begin{aligned}
\textit{j}:\qquad\qquad\quad\ \ &amp;\texttt{0 1 2 3 4 5 6 7 8 9} \\
\textit{pat}:\qquad\qquad\ \  &amp;\texttt{A B A A B A A B A A} \\
\end{aligned}
\]</div>
<p>在 <span class="arithmatex">\(j\leq2\)</span> 处有 <span class="arithmatex">\(\texttt{ABAABAA}\)</span>，<span class="arithmatex">\(2&lt; j \leq 5\)</span> 处有 <span class="arithmatex">\(\texttt{ABAA}\)</span>，在 <span class="arithmatex">\(5&lt;j\leq8\)</span> 处有 <span class="arithmatex">\(\texttt{A}\)</span></p>
<p>Knuth 算法的缺陷是只考虑了最长的那一对的情况，但实际上我们要考虑所有 <span class="arithmatex">\(subpat\)</span> 后缀与 <span class="arithmatex">\(pat\)</span> 前缀相等的情况，等同于计算 <span class="arithmatex">\(pat\)</span> 所有真后缀和真前缀相等的情况，并按照长度从大到小，<span class="arithmatex">\(j\)</span> 分区间计算不同的 <span class="arithmatex">\(delta_2(j)\)</span>。</p>
<p>利用前缀函数和逆向运用计算前缀函数的状态转移方程：<span class="arithmatex">\(j^{(n)} = \pi[j^{(n-1)}-1]\)</span>，以得到 <span class="arithmatex">\(pat\)</span> 所有相等的真前缀和真后缀长度。从 <span class="arithmatex">\(\pi[patlastpos]\)</span> 开始作为最长一对的长度，然后通过逆向运行状态转移方程，得到下一个次长相等真前缀和真后缀的长度。</p>
<p>如此就完成了第二种情况的 <span class="arithmatex">\(delta_2\)</span> 的计算。</p>
<h4 id="_13">第三种情况<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h4>
<p><span class="arithmatex">\(subpat\)</span> 的重现恰好就在 <span class="arithmatex">\(pat\)</span> 中（不包括 <span class="arithmatex">\(pat\)</span> 的头部），也就是按照从右到左的顺序，在 <span class="arithmatex">\(pat[0\dots patlastpos-1]\)</span> 中寻找 <span class="arithmatex">\(subpat\)</span>。</p>
<p><em>如果用 BM 算法解决，我们就得到了一个 BM 的递归实现的第三种情况，结束条件是 <span class="arithmatex">\(patlen \leqslant  2\)</span></em></p>
<p>而且根据 <span class="arithmatex">\(delta_2\)</span> 的定义，找到的 <span class="arithmatex">\(subpat\)</span> 的重现的下一个（也就是左边一个）字符和作为 <span class="arithmatex">\(pat\)</span> 后缀的 <span class="arithmatex">\(subpat\)</span> 的下一个字符不能一样。</p>
<p>这就很好地启发了我们，可以使用类似于计算前缀函数的过程计算第三种情况，只不过是左右反过来的前缀函数：</p>
<ul>
<li>两个指针分别指向子串的左端点和子串最长公共前后缀的「前缀」位置，从右向左移动，在发现指向的两个字符相等时继续移动，此时相当于「前缀」变大；</li>
<li>当两个字符不相等时，之前相等的部分就满足了 <span class="arithmatex">\(delta_2\)</span> 对重现的要求，并且回退指向「前缀」位置的指针直到构成新的字符相等或者出界。</li>
</ul>
<p>同前缀函数一样，需要一个辅助数组，用于回退，可以使用之前计算第二种情况所生成的前缀数组的空间。</p>
<h3 id="_14">实现<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h3>
<details class="note">
<summary>上述实现</summary>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Rust</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-1-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-1-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-1-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-1-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-1-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-1-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-1-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-1-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-1-10">10</a></span>
<span class="normal"><a href="#__codelineno-1-11">11</a></span>
<span class="normal"><a href="#__codelineno-1-12">12</a></span>
<span class="normal"><a href="#__codelineno-1-13">13</a></span>
<span class="normal"><a href="#__codelineno-1-14">14</a></span>
<span class="normal"><a href="#__codelineno-1-15">15</a></span>
<span class="normal"><a href="#__codelineno-1-16">16</a></span>
<span class="normal"><a href="#__codelineno-1-17">17</a></span>
<span class="normal"><a href="#__codelineno-1-18">18</a></span>
<span class="normal"><a href="#__codelineno-1-19">19</a></span>
<span class="normal"><a href="#__codelineno-1-20">20</a></span>
<span class="normal"><a href="#__codelineno-1-21">21</a></span>
<span class="normal"><a href="#__codelineno-1-22">22</a></span>
<span class="normal"><a href="#__codelineno-1-23">23</a></span>
<span class="normal"><a href="#__codelineno-1-24">24</a></span>
<span class="normal"><a href="#__codelineno-1-25">25</a></span>
<span class="normal"><a href="#__codelineno-1-26">26</a></span>
<span class="normal"><a href="#__codelineno-1-27">27</a></span>
<span class="normal"><a href="#__codelineno-1-28">28</a></span>
<span class="normal"><a href="#__codelineno-1-29">29</a></span>
<span class="normal"><a href="#__codelineno-1-30">30</a></span>
<span class="normal"><a href="#__codelineno-1-31">31</a></span>
<span class="normal"><a href="#__codelineno-1-32">32</a></span>
<span class="normal"><a href="#__codelineno-1-33">33</a></span>
<span class="normal"><a href="#__codelineno-1-34">34</a></span>
<span class="normal"><a href="#__codelineno-1-35">35</a></span>
<span class="normal"><a href="#__codelineno-1-36">36</a></span>
<span class="normal"><a href="#__codelineno-1-37">37</a></span>
<span class="normal"><a href="#__codelineno-1-38">38</a></span>
<span class="normal"><a href="#__codelineno-1-39">39</a></span>
<span class="normal"><a href="#__codelineno-1-40">40</a></span>
<span class="normal"><a href="#__codelineno-1-41">41</a></span>
<span class="normal"><a href="#__codelineno-1-42">42</a></span>
<span class="normal"><a href="#__codelineno-1-43">43</a></span>
<span class="normal"><a href="#__codelineno-1-44">44</a></span>
<span class="normal"><a href="#__codelineno-1-45">45</a></span>
<span class="normal"><a href="#__codelineno-1-46">46</a></span>
<span class="normal"><a href="#__codelineno-1-47">47</a></span>
<span class="normal"><a href="#__codelineno-1-48">48</a></span>
<span class="normal"><a href="#__codelineno-1-49">49</a></span>
<span class="normal"><a href="#__codelineno-1-50">50</a></span>
<span class="normal"><a href="#__codelineno-1-51">51</a></span>
<span class="normal"><a href="#__codelineno-1-52">52</a></span>
<span class="normal"><a href="#__codelineno-1-53">53</a></span>
<span class="normal"><a href="#__codelineno-1-54">54</a></span>
<span class="normal"><a href="#__codelineno-1-55">55</a></span>
<span class="normal"><a href="#__codelineno-1-56">56</a></span>
<span class="normal"><a href="#__codelineno-1-57">57</a></span>
<span class="normal"><a href="#__codelineno-1-58">58</a></span>
<span class="normal"><a href="#__codelineno-1-59">59</a></span>
<span class="normal"><a href="#__codelineno-1-60">60</a></span>
<span class="normal"><a href="#__codelineno-1-61">61</a></span>
<span class="normal"><a href="#__codelineno-1-62">62</a></span>
<span class="normal"><a href="#__codelineno-1-63">63</a></span>
<span class="normal"><a href="#__codelineno-1-64">64</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">cmp</span><span class="p">::</span><span class="nb">PartialEq</span><span class="p">;</span>
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="k">use</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">cmp</span><span class="p">::</span><span class="n">min</span><span class="p">;</span>
<a id="__codelineno-1-3" name="__codelineno-1-3"></a>
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">build_delta_2_table_improved_minghu6</span><span class="p">(</span><span class="n">p</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="p">[</span><span class="k">impl</span><span class="w"> </span><span class="nb">PartialEq</span><span class="p">])</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="kt">usize</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">patlen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">len</span><span class="p">();</span>
<a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">lastpos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">patlen</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">delta_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Vec</span><span class="p">::</span><span class="n">with_capacity</span><span class="p">(</span><span class="n">patlen</span><span class="p">);</span>
<a id="__codelineno-1-8" name="__codelineno-1-8"></a>
<a id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="w">    </span><span class="c1">// 第一种情况</span>
<a id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="w">    </span><span class="c1">// delta_2[j] = lastpos * 2 - j</span>
<a id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="n">patlen</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-12" name="__codelineno-1-12"></a><span class="w">        </span><span class="n">delta_2</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">lastpos</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<a id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-14" name="__codelineno-1-14"></a>
<a id="__codelineno-1-15" name="__codelineno-1-15"></a><span class="w">    </span><span class="c1">// 第二种情况</span>
<a id="__codelineno-1-16" name="__codelineno-1-16"></a><span class="w">    </span><span class="c1">// lastpos &lt;= delata2[j] = lastpos * 2 - j</span>
<a id="__codelineno-1-17" name="__codelineno-1-17"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">pi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">compute_pi</span><span class="p">(</span><span class="n">p</span><span class="p">);</span><span class="w">  </span><span class="c1">// 计算前缀函数</span>
<a id="__codelineno-1-18" name="__codelineno-1-18"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lastpos</span><span class="p">;</span>
<a id="__codelineno-1-19" name="__codelineno-1-19"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">last_i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lastpos</span><span class="p">;</span><span class="w"> </span><span class="c1">// 只是为了初始化</span>
<a id="__codelineno-1-20" name="__codelineno-1-20"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-21" name="__codelineno-1-21"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">start</span><span class="p">;</span>
<a id="__codelineno-1-22" name="__codelineno-1-22"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">end</span><span class="p">;</span>
<a id="__codelineno-1-23" name="__codelineno-1-23"></a>
<a id="__codelineno-1-24" name="__codelineno-1-24"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">lastpos</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-25" name="__codelineno-1-25"></a><span class="w">            </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-1-26" name="__codelineno-1-26"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-27" name="__codelineno-1-27"></a><span class="w">            </span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">patlen</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">pi</span><span class="p">[</span><span class="n">last_i</span><span class="p">];</span>
<a id="__codelineno-1-28" name="__codelineno-1-28"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-1-29" name="__codelineno-1-29"></a>
<a id="__codelineno-1-30" name="__codelineno-1-30"></a><span class="w">        </span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">patlen</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-1-31" name="__codelineno-1-31"></a>
<a id="__codelineno-1-32" name="__codelineno-1-32"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">start</span><span class="o">..</span><span class="n">end</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-33" name="__codelineno-1-33"></a><span class="w">            </span><span class="n">delta_2</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lastpos</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
<a id="__codelineno-1-34" name="__codelineno-1-34"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-1-35" name="__codelineno-1-35"></a>
<a id="__codelineno-1-36" name="__codelineno-1-36"></a><span class="w">        </span><span class="n">last_i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<a id="__codelineno-1-37" name="__codelineno-1-37"></a><span class="w">        </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-1-38" name="__codelineno-1-38"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-39" name="__codelineno-1-39"></a>
<a id="__codelineno-1-40" name="__codelineno-1-40"></a><span class="w">    </span><span class="c1">// 第三种情况</span>
<a id="__codelineno-1-41" name="__codelineno-1-41"></a><span class="w">    </span><span class="c1">// delata2[j] &lt; lastpos</span>
<a id="__codelineno-1-42" name="__codelineno-1-42"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lastpos</span><span class="p">;</span>
<a id="__codelineno-1-43" name="__codelineno-1-43"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">patlen</span><span class="p">;</span>
<a id="__codelineno-1-44" name="__codelineno-1-44"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pi</span><span class="p">;</span>
<a id="__codelineno-1-45" name="__codelineno-1-45"></a><span class="w">    </span><span class="k">loop</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-46" name="__codelineno-1-46"></a><span class="w">        </span><span class="n">f</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">t</span><span class="p">;</span>
<a id="__codelineno-1-47" name="__codelineno-1-47"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">patlen</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-48" name="__codelineno-1-48"></a><span class="w">            </span><span class="c1">// 使用min函数保证后面可能的回退不会覆盖前面的数据</span>
<a id="__codelineno-1-49" name="__codelineno-1-49"></a><span class="w">            </span><span class="n">delta_2</span><span class="p">[</span><span class="n">t</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="n">delta_2</span><span class="p">[</span><span class="n">t</span><span class="p">],</span><span class="w"> </span><span class="n">lastpos</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">j</span><span class="p">);</span>
<a id="__codelineno-1-50" name="__codelineno-1-50"></a><span class="w">            </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">[</span><span class="n">t</span><span class="p">];</span>
<a id="__codelineno-1-51" name="__codelineno-1-51"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-1-52" name="__codelineno-1-52"></a>
<a id="__codelineno-1-53" name="__codelineno-1-53"></a><span class="w">        </span><span class="n">t</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-1-54" name="__codelineno-1-54"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-55" name="__codelineno-1-55"></a><span class="w">            </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-1-56" name="__codelineno-1-56"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-1-57" name="__codelineno-1-57"></a><span class="w">        </span><span class="n">j</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-1-58" name="__codelineno-1-58"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-1-59" name="__codelineno-1-59"></a>
<a id="__codelineno-1-60" name="__codelineno-1-60"></a><span class="w">    </span><span class="c1">// 没有实际意义，只是为了完整定义</span>
<a id="__codelineno-1-61" name="__codelineno-1-61"></a><span class="w">    </span><span class="n">delta_2</span><span class="p">[</span><span class="n">lastpos</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-1-62" name="__codelineno-1-62"></a>
<a id="__codelineno-1-63" name="__codelineno-1-63"></a><span class="w">    </span><span class="n">delta_2</span>
<a id="__codelineno-1-64" name="__codelineno-1-64"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</details>
<h2 id="galil">Galil 规则对多次匹配时最坏情况的改善<a class="headerlink" href="#galil" title="Permanent link">&para;</a></h2>
<h3 id="_15">关于后缀匹配算法的多次匹配问题<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h3>
<p>之前的搜索算法只涉及到在 <span class="arithmatex">\(string\)</span> 中寻找第一次 <span class="arithmatex">\(pat\)</span> 匹配的情况，而对与在 <span class="arithmatex">\(string\)</span> 中寻找全部 <span class="arithmatex">\(pat\)</span> 的匹配的情况有很多不同的算法思路，这个问题的核心关注点是：</p>
<p><strong>如何利用之前匹配成功的字符的信息，将最坏情况下的时间复杂度降为线性。</strong></p>
<p>在原始的成功匹配后，简单的 <span class="arithmatex">\(string\)</span> 的指针向后滑动 <span class="arithmatex">\(patlen\)</span> 距离后重新开始后缀匹配，这会导致最坏情况下回到 <span class="arithmatex">\(O(mn)\)</span> 的时间复杂度（按照惯例，<span class="arithmatex">\(m\)</span> 为 <span class="arithmatex">\(patlen\)</span>，<span class="arithmatex">\(n\)</span> 为 <span class="arithmatex">\(stringlen\)</span>，下同）。</p>
<p>比如一个极端的例子：<span class="arithmatex">\(pat\)</span>：<span class="arithmatex">\(\texttt{AAA}\)</span>，<span class="arithmatex">\(string\)</span>：<span class="arithmatex">\(\texttt{AAAAA}\dots\)</span>。</p>
<p>对此 Knuth 提出来的一个方法是用一个「数量有限」的状态的集合来记录 <span class="arithmatex">\(patlen\)</span> 长度的字符，这种算法保证 <span class="arithmatex">\(string\)</span> 上每一个字符最多比较一次，但代价是这个「数量有限」的状态可能规模并不小，对于一个字符彼此不相等的 <span class="arithmatex">\(pat\)</span>，需要 <span class="arithmatex">\(\dfrac{1}{2}m^{2}+m\)</span> 个状态。</p>
<p>下面介绍的思路简单且不需要额外预处理开销的 Galil 算法<sup id="fnref:galil-rule"><a class="footnote-ref" href="#fn:galil-rule">4</a></sup>。</p>
<h3 id="galil_1">Galil 规则<a class="headerlink" href="#galil_1" title="Permanent link">&para;</a></h3>
<p>假定一个 <span class="arithmatex">\(pat\)</span>，它是某个子串 <span class="arithmatex">\(U\)</span> 重复 n 次构成的字符串 <span class="arithmatex">\(UUUU\dots\)</span> 的前缀，那么我们称 <span class="arithmatex">\(U\)</span> 为 <span class="arithmatex">\(pat\)</span> 的一个周期。</p>
<p>比如，<span class="arithmatex">\(pat: \texttt{ABCABCAB}\)</span>，是 <span class="arithmatex">\(\texttt{ABC}\)</span> 的重复 <span class="arithmatex">\(\texttt{ABCABCABC}\)</span> 的前缀，所以 <span class="arithmatex">\(\texttt{ABC}\)</span> 的长度 <span class="arithmatex">\(3\)</span> 就是这个 <span class="arithmatex">\(pat\)</span> 的周期长度，也即 <span class="arithmatex">\(pat\)</span> 满足 <span class="arithmatex">\(pat[i] = pat[i+3]\)</span>。</p>
<p><span class="arithmatex">\(pat\)</span> 至少拥有一个长度为它自身的周期，我们规定最短的周期为 <span class="arithmatex">\(k\)</span>，<span class="arithmatex">\(k\leq patlen\)</span>。</p>
<p>在搜索过程中，假如我们的 <span class="arithmatex">\(pat\)</span> 成功地完成了一次匹配，那么依照周期的特点，实际上只需将 <span class="arithmatex">\(string\)</span> 向后滑动 <span class="arithmatex">\(k\)</span> 个字符，比较这 <span class="arithmatex">\(k\)</span> 个字符是否对应相等就可以直接判断是否存在 <span class="arithmatex">\(pat\)</span> 的又一个匹配。</p>
<p>为计算这个最短周期的长度，我们假设已知 <span class="arithmatex">\(pat\)</span> 的相等的一对前缀 - 后缀，设它们的长度为 <span class="arithmatex">\(\textit{prefixlen}\)</span>，那么有 <span class="arithmatex">\(pat[i] = pat[i+(patlen-\textit{prefixlen})]\)</span>。从而得到长度为 <span class="arithmatex">\(patlen-\textit{prefixlen}\)</span> 的周期，</p>
<p>当我们知道 <span class="arithmatex">\(pat\)</span> 最长的那一对相等的前缀 - 后缀，我们就得到了 <span class="arithmatex">\(pat\)</span> 最短的周期。</p>
<p>而最长相等的前后缀长度，<span class="arithmatex">\(\pi[patlastpos]\)</span>，已经在我们在计算 <span class="arithmatex">\(delta_2\)</span> 的过程中，所以实际不需要额外的预处理时间和空间，就能将后缀匹配算法最坏情况的时间复杂度改善成线性。</p>
<details class="note">
<summary>结合上述优化的 BM 的搜索算法最终实现</summary>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Rust</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-2-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-2-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-2-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-2-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-2-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-2-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-2-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-2-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-2-10">10</a></span>
<span class="normal"><a href="#__codelineno-2-11">11</a></span>
<span class="normal"><a href="#__codelineno-2-12">12</a></span>
<span class="normal"><a href="#__codelineno-2-13">13</a></span>
<span class="normal"><a href="#__codelineno-2-14">14</a></span>
<span class="normal"><a href="#__codelineno-2-15">15</a></span>
<span class="normal"><a href="#__codelineno-2-16">16</a></span>
<span class="normal"><a href="#__codelineno-2-17">17</a></span>
<span class="normal"><a href="#__codelineno-2-18">18</a></span>
<span class="normal"><a href="#__codelineno-2-19">19</a></span>
<span class="normal"><a href="#__codelineno-2-20">20</a></span>
<span class="normal"><a href="#__codelineno-2-21">21</a></span>
<span class="normal"><a href="#__codelineno-2-22">22</a></span>
<span class="normal"><a href="#__codelineno-2-23">23</a></span>
<span class="normal"><a href="#__codelineno-2-24">24</a></span>
<span class="normal"><a href="#__codelineno-2-25">25</a></span>
<span class="normal"><a href="#__codelineno-2-26">26</a></span>
<span class="normal"><a href="#__codelineno-2-27">27</a></span>
<span class="normal"><a href="#__codelineno-2-28">28</a></span>
<span class="normal"><a href="#__codelineno-2-29">29</a></span>
<span class="normal"><a href="#__codelineno-2-30">30</a></span>
<span class="normal"><a href="#__codelineno-2-31">31</a></span>
<span class="normal"><a href="#__codelineno-2-32">32</a></span>
<span class="normal"><a href="#__codelineno-2-33">33</a></span>
<span class="normal"><a href="#__codelineno-2-34">34</a></span>
<span class="normal"><a href="#__codelineno-2-35">35</a></span>
<span class="normal"><a href="#__codelineno-2-36">36</a></span>
<span class="normal"><a href="#__codelineno-2-37">37</a></span>
<span class="normal"><a href="#__codelineno-2-38">38</a></span>
<span class="normal"><a href="#__codelineno-2-39">39</a></span>
<span class="normal"><a href="#__codelineno-2-40">40</a></span>
<span class="normal"><a href="#__codelineno-2-41">41</a></span>
<span class="normal"><a href="#__codelineno-2-42">42</a></span>
<span class="normal"><a href="#__codelineno-2-43">43</a></span>
<span class="normal"><a href="#__codelineno-2-44">44</a></span>
<span class="normal"><a href="#__codelineno-2-45">45</a></span>
<span class="normal"><a href="#__codelineno-2-46">46</a></span>
<span class="normal"><a href="#__codelineno-2-47">47</a></span>
<span class="normal"><a href="#__codelineno-2-48">48</a></span>
<span class="normal"><a href="#__codelineno-2-49">49</a></span>
<span class="normal"><a href="#__codelineno-2-50">50</a></span>
<span class="normal"><a href="#__codelineno-2-51">51</a></span>
<span class="normal"><a href="#__codelineno-2-52">52</a></span>
<span class="normal"><a href="#__codelineno-2-53">53</a></span>
<span class="normal"><a href="#__codelineno-2-54">54</a></span>
<span class="normal"><a href="#__codelineno-2-55">55</a></span>
<span class="normal"><a href="#__codelineno-2-56">56</a></span>
<span class="normal"><a href="#__codelineno-2-57">57</a></span>
<span class="normal"><a href="#__codelineno-2-58">58</a></span>
<span class="normal"><a href="#__codelineno-2-59">59</a></span>
<span class="normal"><a href="#__codelineno-2-60">60</a></span>
<span class="normal"><a href="#__codelineno-2-61">61</a></span>
<span class="normal"><a href="#__codelineno-2-62">62</a></span>
<span class="normal"><a href="#__codelineno-2-63">63</a></span>
<span class="normal"><a href="#__codelineno-2-64">64</a></span>
<span class="normal"><a href="#__codelineno-2-65">65</a></span>
<span class="normal"><a href="#__codelineno-2-66">66</a></span>
<span class="normal"><a href="#__codelineno-2-67">67</a></span>
<span class="normal"><a href="#__codelineno-2-68">68</a></span>
<span class="normal"><a href="#__codelineno-2-69">69</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="cp">#[cfg(target_pointer_width = </span><span class="s">&quot;64&quot;</span><span class="cp">)]</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="k">const</span><span class="w"> </span><span class="n">LARGE</span><span class="p">:</span><span class="w"> </span><span class="kt">usize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">10_000_000_000_000_000_000</span><span class="p">;</span>
<a id="__codelineno-2-3" name="__codelineno-2-3"></a>
<a id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="cp">#[cfg(not(target_pointer_width = </span><span class="s">&quot;64&quot;</span><span class="cp">))]</span>
<a id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="k">const</span><span class="w"> </span><span class="n">LARGE</span><span class="p">:</span><span class="w"> </span><span class="kt">usize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2_000_000_000</span><span class="p">;</span>
<a id="__codelineno-2-6" name="__codelineno-2-6"></a>
<a id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">BMPattern</span><span class="o">&lt;&#39;</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="w">    </span><span class="n">pat_bytes</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="o">&#39;</span><span class="na">a</span><span class="w"> </span><span class="p">[</span><span class="kt">u8</span><span class="p">],</span>
<a id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="w">    </span><span class="n">delta_1</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="kt">usize</span><span class="p">;</span><span class="w"> </span><span class="mi">256</span><span class="p">],</span>
<a id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="w">    </span><span class="n">delta_2</span><span class="p">:</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="kt">usize</span><span class="o">&gt;</span><span class="p">,</span>
<a id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="w">    </span><span class="n">k</span><span class="p">:</span><span class="w"> </span><span class="kt">usize</span><span class="w">  </span><span class="c1">// pat的最短周期长度</span>
<a id="__codelineno-2-12" name="__codelineno-2-12"></a><span class="p">}</span>
<a id="__codelineno-2-13" name="__codelineno-2-13"></a>
<a id="__codelineno-2-14" name="__codelineno-2-14"></a><span class="k">impl</span><span class="o">&lt;&#39;</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="n">BMPattern</span><span class="o">&lt;&#39;</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-15" name="__codelineno-2-15"></a><span class="w">    </span><span class="c1">// ...</span>
<a id="__codelineno-2-16" name="__codelineno-2-16"></a>
<a id="__codelineno-2-17" name="__codelineno-2-17"></a><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">find_all</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="kt">usize</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-18" name="__codelineno-2-18"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[];</span>
<a id="__codelineno-2-19" name="__codelineno-2-19"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">string_bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">string</span><span class="p">.</span><span class="n">as_bytes</span><span class="p">();</span>
<a id="__codelineno-2-20" name="__codelineno-2-20"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">stringlen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">string_bytes</span><span class="p">.</span><span class="n">len</span><span class="p">();</span>
<a id="__codelineno-2-21" name="__codelineno-2-21"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">patlen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">pat_bytes</span><span class="p">.</span><span class="n">len</span><span class="p">();</span>
<a id="__codelineno-2-22" name="__codelineno-2-22"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">pat_last_pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">patlen</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-2-23" name="__codelineno-2-23"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">string_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pat_last_pos</span><span class="p">;</span>
<a id="__codelineno-2-24" name="__codelineno-2-24"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">pat_index</span><span class="p">;</span>
<a id="__codelineno-2-25" name="__codelineno-2-25"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">l0</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="n">patlen</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">k</span><span class="p">;</span>
<a id="__codelineno-2-26" name="__codelineno-2-26"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-2-27" name="__codelineno-2-27"></a>
<a id="__codelineno-2-28" name="__codelineno-2-28"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="n">string_index</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">stringlen</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-29" name="__codelineno-2-29"></a><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">old_string_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">string_index</span><span class="p">;</span>
<a id="__codelineno-2-30" name="__codelineno-2-30"></a>
<a id="__codelineno-2-31" name="__codelineno-2-31"></a><span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="n">string_index</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">stringlen</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-32" name="__codelineno-2-32"></a><span class="w">                </span><span class="n">string_index</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">delta0</span><span class="p">(</span><span class="n">string_bytes</span><span class="p">[</span><span class="n">string_index</span><span class="p">]);</span>
<a id="__codelineno-2-33" name="__codelineno-2-33"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-2-34" name="__codelineno-2-34"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">string_index</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">LARGE</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-35" name="__codelineno-2-35"></a><span class="w">                </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-2-36" name="__codelineno-2-36"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-2-37" name="__codelineno-2-37"></a>
<a id="__codelineno-2-38" name="__codelineno-2-38"></a><span class="w">            </span><span class="n">string_index</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">LARGE</span><span class="p">;</span>
<a id="__codelineno-2-39" name="__codelineno-2-39"></a>
<a id="__codelineno-2-40" name="__codelineno-2-40"></a><span class="w">            </span><span class="c1">// 如果string_index发生移动，意味着自从上次成功匹配后发生了至少一次的失败匹配。</span>
<a id="__codelineno-2-41" name="__codelineno-2-41"></a><span class="w">            </span><span class="c1">// 此时需要将Galil规则的二次匹配的偏移量归零。</span>
<a id="__codelineno-2-42" name="__codelineno-2-42"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">old_string_index</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">string_index</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-43" name="__codelineno-2-43"></a><span class="w">                </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-2-44" name="__codelineno-2-44"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-2-45" name="__codelineno-2-45"></a>
<a id="__codelineno-2-46" name="__codelineno-2-46"></a><span class="w">            </span><span class="n">pat_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pat_last_pos</span><span class="p">;</span>
<a id="__codelineno-2-47" name="__codelineno-2-47"></a>
<a id="__codelineno-2-48" name="__codelineno-2-48"></a><span class="w">            </span><span class="k">while</span><span class="w"> </span><span class="n">pat_index</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">string_bytes</span><span class="p">[</span><span class="n">string_index</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">pat_bytes</span><span class="p">[</span><span class="n">pat_index</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-49" name="__codelineno-2-49"></a><span class="w">                </span><span class="n">string_index</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-2-50" name="__codelineno-2-50"></a><span class="w">                </span><span class="n">pat_index</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-2-51" name="__codelineno-2-51"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-2-52" name="__codelineno-2-52"></a>
<a id="__codelineno-2-53" name="__codelineno-2-53"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">pat_index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">string_bytes</span><span class="p">[</span><span class="n">string_index</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">pat_bytes</span><span class="p">[</span><span class="n">pat_index</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-54" name="__codelineno-2-54"></a><span class="w">                </span><span class="n">result</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">string_index</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">l</span><span class="p">);</span>
<a id="__codelineno-2-55" name="__codelineno-2-55"></a>
<a id="__codelineno-2-56" name="__codelineno-2-56"></a><span class="w">                </span><span class="n">string_index</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">pat_last_pos</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">k</span><span class="p">;</span>
<a id="__codelineno-2-57" name="__codelineno-2-57"></a><span class="w">                </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">l0</span><span class="p">;</span>
<a id="__codelineno-2-58" name="__codelineno-2-58"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-59" name="__codelineno-2-59"></a><span class="w">                </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-2-60" name="__codelineno-2-60"></a><span class="w">                </span><span class="n">string_index</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">max</span><span class="p">(</span>
<a id="__codelineno-2-61" name="__codelineno-2-61"></a><span class="w">                    </span><span class="bp">self</span><span class="p">.</span><span class="n">delta_1</span><span class="p">[</span><span class="n">string_bytes</span><span class="p">[</span><span class="n">string_index</span><span class="p">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">usize</span><span class="p">],</span>
<a id="__codelineno-2-62" name="__codelineno-2-62"></a><span class="w">                    </span><span class="bp">self</span><span class="p">.</span><span class="n">delta_2</span><span class="p">[</span><span class="n">pat_index</span><span class="p">],</span>
<a id="__codelineno-2-63" name="__codelineno-2-63"></a><span class="w">                </span><span class="p">);</span>
<a id="__codelineno-2-64" name="__codelineno-2-64"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-2-65" name="__codelineno-2-65"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-2-66" name="__codelineno-2-66"></a>
<a id="__codelineno-2-67" name="__codelineno-2-67"></a><span class="w">        </span><span class="n">result</span>
<a id="__codelineno-2-68" name="__codelineno-2-68"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-2-69" name="__codelineno-2-69"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</details>
<h3 id="_16">最坏情况在实践中性能影响<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h3>
<p>从实践的角度上说，理论上的最坏情况并不容易影响性能表现，哪怕是很小的只有 4 的字符集的随机文本测试下这种最坏情况的影响也小到难以观察。</p>
<p>也因此如果没有很好地设计，使用 Galil 法则会拖累一点平均的性能表现，但对于一些极端特殊的 <span class="arithmatex">\(pat\)</span> 和 <span class="arithmatex">\(string\)</span> 比如例子中的：<span class="arithmatex">\(pat\)</span>：<span class="arithmatex">\(\texttt{AAA}\)</span>，<span class="arithmatex">\(string\)</span>：<span class="arithmatex">\(\texttt{AAAAA}\dots\)</span>，Galil 规则的应用确实会使得性能表现提高数倍。</p>
<h2 id="_17">改进算法<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h2>
<h3 id="simplified-boyermoore">Simplified Boyer–Moore 算法<a class="headerlink" href="#simplified-boyermoore" title="Permanent link">&para;</a></h3>
<p>BM 算法最复杂的地方就在于 <span class="arithmatex">\(delta_2\)</span> 表（也就是好后缀表）的构建，而实践中发现，在一般的字符集上的匹配性能主要依靠 <span class="arithmatex">\(delta_1\)</span> 表（也就是坏字符表），于是出现了仅仅使用 <span class="arithmatex">\(delta_1\)</span> 表的简化版 BM 算法，通常性能和原版差距很小。</p>
<h3 id="boyermoorehorspol">Boyer–Moore–Horspol 算法<a class="headerlink" href="#boyermoorehorspol" title="Permanent link">&para;</a></h3>
<p>Horspol 算法同样是基于坏字符的规则，在与 <span class="arithmatex">\(pat\)</span> 尾部对齐的字符上应用 <span class="arithmatex">\(delta_1\)</span>。效果类似于对原版匹配算法的改进，通常性能优于原版本。</p>
<details class="note" open="open">
<summary>实现</summary>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Rust</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-3-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-3-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-3-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-3-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-3-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-3-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-3-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-3-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-3-10">10</a></span>
<span class="normal"><a href="#__codelineno-3-11">11</a></span>
<span class="normal"><a href="#__codelineno-3-12">12</a></span>
<span class="normal"><a href="#__codelineno-3-13">13</a></span>
<span class="normal"><a href="#__codelineno-3-14">14</a></span>
<span class="normal"><a href="#__codelineno-3-15">15</a></span>
<span class="normal"><a href="#__codelineno-3-16">16</a></span>
<span class="normal"><a href="#__codelineno-3-17">17</a></span>
<span class="normal"><a href="#__codelineno-3-18">18</a></span>
<span class="normal"><a href="#__codelineno-3-19">19</a></span>
<span class="normal"><a href="#__codelineno-3-20">20</a></span>
<span class="normal"><a href="#__codelineno-3-21">21</a></span>
<span class="normal"><a href="#__codelineno-3-22">22</a></span>
<span class="normal"><a href="#__codelineno-3-23">23</a></span>
<span class="normal"><a href="#__codelineno-3-24">24</a></span>
<span class="normal"><a href="#__codelineno-3-25">25</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">HorspoolPattern</span><span class="o">&lt;&#39;</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="w">    </span><span class="n">pat_bytes</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="o">&#39;</span><span class="na">a</span><span class="w"> </span><span class="p">[</span><span class="kt">u8</span><span class="p">],</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="w">    </span><span class="n">bm_bc</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="kt">usize</span><span class="p">;</span><span class="w"> </span><span class="mi">256</span><span class="p">],</span>
<a id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="p">}</span>
<a id="__codelineno-3-5" name="__codelineno-3-5"></a>
<a id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="k">impl</span><span class="o">&lt;&#39;</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="n">HorspoolPattern</span><span class="o">&lt;&#39;</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="w">    </span><span class="c1">// ...</span>
<a id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">find_all</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="kt">usize</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-9" name="__codelineno-3-9"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[];</span>
<a id="__codelineno-3-10" name="__codelineno-3-10"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">string_bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">string</span><span class="p">.</span><span class="n">as_bytes</span><span class="p">();</span>
<a id="__codelineno-3-11" name="__codelineno-3-11"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">stringlen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">string_bytes</span><span class="p">.</span><span class="n">len</span><span class="p">();</span>
<a id="__codelineno-3-12" name="__codelineno-3-12"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">pat_last_pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">pat_bytes</span><span class="p">.</span><span class="n">len</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-3-13" name="__codelineno-3-13"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">string_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pat_last_pos</span><span class="p">;</span>
<a id="__codelineno-3-14" name="__codelineno-3-14"></a>
<a id="__codelineno-3-15" name="__codelineno-3-15"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="n">string_index</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">stringlen</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-16" name="__codelineno-3-16"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">&amp;</span><span class="n">string_bytes</span><span class="p">[</span><span class="n">string_index</span><span class="o">-</span><span class="n">pat_last_pos</span><span class="o">..</span><span class="n">string_index</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">pat_bytes</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-17" name="__codelineno-3-17"></a><span class="w">                </span><span class="n">result</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">string_index</span><span class="o">-</span><span class="n">pat_last_pos</span><span class="p">);</span>
<a id="__codelineno-3-18" name="__codelineno-3-18"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-3-19" name="__codelineno-3-19"></a>
<a id="__codelineno-3-20" name="__codelineno-3-20"></a><span class="w">            </span><span class="n">string_index</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">bm_bc</span><span class="p">[</span><span class="n">string_bytes</span><span class="p">[</span><span class="n">string_index</span><span class="p">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">usize</span><span class="p">];</span>
<a id="__codelineno-3-21" name="__codelineno-3-21"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-3-22" name="__codelineno-3-22"></a>
<a id="__codelineno-3-23" name="__codelineno-3-23"></a><span class="w">        </span><span class="n">result</span>
<a id="__codelineno-3-24" name="__codelineno-3-24"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-3-25" name="__codelineno-3-25"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</details>
<h3 id="boyermooresunday">Boyer–Moore–Sunday 算法<a class="headerlink" href="#boyermooresunday" title="Permanent link">&para;</a></h3>
<p>Sunday 算法同样是利用坏字符规则，只不过相比 Horspool 它更进一步，直接关注 <span class="arithmatex">\(pat\)</span> 尾部对齐的那个字符的下一个字符。</p>
<p>实现它只需要稍微修改 <span class="arithmatex">\(delta_1\)</span> 表，相当于在 <span class="arithmatex">\(patlen+1\)</span> 长度的 <span class="arithmatex">\(pat\)</span> 上进行构建。</p>
<p>Sunday 算法通常用作一般情况下实现最简单而且平均表现最好之一的实用算法，通常性能比 Horspool 和 BM 要好一点。</p>
<details class="note" open="open">
<summary>实现</summary>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Rust</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-4-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-4-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-4-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-4-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-4-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-4-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-4-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-4-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-4-10">10</a></span>
<span class="normal"><a href="#__codelineno-4-11">11</a></span>
<span class="normal"><a href="#__codelineno-4-12">12</a></span>
<span class="normal"><a href="#__codelineno-4-13">13</a></span>
<span class="normal"><a href="#__codelineno-4-14">14</a></span>
<span class="normal"><a href="#__codelineno-4-15">15</a></span>
<span class="normal"><a href="#__codelineno-4-16">16</a></span>
<span class="normal"><a href="#__codelineno-4-17">17</a></span>
<span class="normal"><a href="#__codelineno-4-18">18</a></span>
<span class="normal"><a href="#__codelineno-4-19">19</a></span>
<span class="normal"><a href="#__codelineno-4-20">20</a></span>
<span class="normal"><a href="#__codelineno-4-21">21</a></span>
<span class="normal"><a href="#__codelineno-4-22">22</a></span>
<span class="normal"><a href="#__codelineno-4-23">23</a></span>
<span class="normal"><a href="#__codelineno-4-24">24</a></span>
<span class="normal"><a href="#__codelineno-4-25">25</a></span>
<span class="normal"><a href="#__codelineno-4-26">26</a></span>
<span class="normal"><a href="#__codelineno-4-27">27</a></span>
<span class="normal"><a href="#__codelineno-4-28">28</a></span>
<span class="normal"><a href="#__codelineno-4-29">29</a></span>
<span class="normal"><a href="#__codelineno-4-30">30</a></span>
<span class="normal"><a href="#__codelineno-4-31">31</a></span>
<span class="normal"><a href="#__codelineno-4-32">32</a></span>
<span class="normal"><a href="#__codelineno-4-33">33</a></span>
<span class="normal"><a href="#__codelineno-4-34">34</a></span>
<span class="normal"><a href="#__codelineno-4-35">35</a></span>
<span class="normal"><a href="#__codelineno-4-36">36</a></span>
<span class="normal"><a href="#__codelineno-4-37">37</a></span>
<span class="normal"><a href="#__codelineno-4-38">38</a></span>
<span class="normal"><a href="#__codelineno-4-39">39</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">SundayPattern</span><span class="o">&lt;&#39;</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="w">    </span><span class="n">pat_bytes</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="o">&#39;</span><span class="na">a</span><span class="w"> </span><span class="p">[</span><span class="kt">u8</span><span class="p">],</span>
<a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="w">    </span><span class="n">sunday_bc</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="kt">usize</span><span class="p">;</span><span class="w"> </span><span class="mi">256</span><span class="p">],</span>
<a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="p">}</span>
<a id="__codelineno-4-5" name="__codelineno-4-5"></a>
<a id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="k">impl</span><span class="o">&lt;&#39;</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="n">SundayPattern</span><span class="o">&lt;&#39;</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="w">    </span><span class="c1">// ...</span>
<a id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">build_sunday_bc</span><span class="p">(</span><span class="n">p</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="o">&#39;</span><span class="na">a</span><span class="w"> </span><span class="p">[</span><span class="kt">u8</span><span class="p">])</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="p">[</span><span class="kt">usize</span><span class="p">;</span><span class="w"> </span><span class="mi">256</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">sunday_bc_table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">p</span><span class="p">.</span><span class="n">len</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="mi">256</span><span class="p">];</span>
<a id="__codelineno-4-10" name="__codelineno-4-10"></a>
<a id="__codelineno-4-11" name="__codelineno-4-11"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="n">p</span><span class="p">.</span><span class="n">len</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-12" name="__codelineno-4-12"></a><span class="w">            </span><span class="n">sunday_bc_table</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">usize</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">len</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<a id="__codelineno-4-13" name="__codelineno-4-13"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-4-14" name="__codelineno-4-14"></a>
<a id="__codelineno-4-15" name="__codelineno-4-15"></a><span class="w">        </span><span class="n">sunday_bc_table</span>
<a id="__codelineno-4-16" name="__codelineno-4-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-4-17" name="__codelineno-4-17"></a>
<a id="__codelineno-4-18" name="__codelineno-4-18"></a><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">find_all</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="kt">usize</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-19" name="__codelineno-4-19"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[];</span>
<a id="__codelineno-4-20" name="__codelineno-4-20"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">string_bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">string</span><span class="p">.</span><span class="n">as_bytes</span><span class="p">();</span>
<a id="__codelineno-4-21" name="__codelineno-4-21"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">pat_last_pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">pat_bytes</span><span class="p">.</span><span class="n">len</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-4-22" name="__codelineno-4-22"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">stringlen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">string_bytes</span><span class="p">.</span><span class="n">len</span><span class="p">();</span>
<a id="__codelineno-4-23" name="__codelineno-4-23"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">string_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pat_last_pos</span><span class="p">;</span>
<a id="__codelineno-4-24" name="__codelineno-4-24"></a>
<a id="__codelineno-4-25" name="__codelineno-4-25"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="n">string_index</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">stringlen</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-26" name="__codelineno-4-26"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">&amp;</span><span class="n">string_bytes</span><span class="p">[</span><span class="n">string_index</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">pat_last_pos</span><span class="o">..</span><span class="n">string_index</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">pat_bytes</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-27" name="__codelineno-4-27"></a><span class="w">                </span><span class="n">result</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">string_index</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">pat_last_pos</span><span class="p">);</span>
<a id="__codelineno-4-28" name="__codelineno-4-28"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-4-29" name="__codelineno-4-29"></a>
<a id="__codelineno-4-30" name="__codelineno-4-30"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">string_index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">stringlen</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-31" name="__codelineno-4-31"></a><span class="w">                </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-4-32" name="__codelineno-4-32"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-4-33" name="__codelineno-4-33"></a>
<a id="__codelineno-4-34" name="__codelineno-4-34"></a><span class="w">            </span><span class="n">string_index</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">sunday_bc</span><span class="p">[</span><span class="n">string_bytes</span><span class="p">[</span><span class="n">string_index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">usize</span><span class="p">];</span>
<a id="__codelineno-4-35" name="__codelineno-4-35"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-4-36" name="__codelineno-4-36"></a>
<a id="__codelineno-4-37" name="__codelineno-4-37"></a><span class="w">        </span><span class="n">result</span>
<a id="__codelineno-4-38" name="__codelineno-4-38"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-4-39" name="__codelineno-4-39"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</details>
<h3 id="bmhbnfs">BMHBNFS 算法<a class="headerlink" href="#bmhbnfs" title="Permanent link">&para;</a></h3>
<p>该算法结合了 Horspool 和 Sunday，是 CPython 实现 <code>stringlib</code> 模块时用到的 <code>find</code> 的算法<sup id="fnref:b5s"><a class="footnote-ref" href="#fn:b5s">5</a></sup>，以下简称 B5S。</p>
<p>B5S 基本思路是：</p>
<ol>
<li>
<p>按照后缀匹配的思路，首先比较 <span class="arithmatex">\(patlastpos\)</span> 位置对应的字符是否相等，如果相等就比较 <span class="arithmatex">\(0\dots patlastpos-1\)</span> 对应位置的字符是否相等，如果仍然相等，那么就发现一个匹配；</p>
</li>
<li>
<p>如果任何一个阶段发生不匹配，就进入跳转阶段；</p>
</li>
<li>
<p>在跳转阶段，首先观察 <span class="arithmatex">\(patlastpos\)</span> 位置的下一个字符是否在 <span class="arithmatex">\(pat\)</span> 中，如果不在，直接向右滑动 <span class="arithmatex">\(patlen+1\)</span>，这是 Sunday 算法的最大利用；</p>
<p>如果这个字符在 <span class="arithmatex">\(pat\)</span> 中，对 <span class="arithmatex">\(patlastpos\)</span> 处的字符利用 <span class="arithmatex">\(delta_1\)</span> 进行 Horspool 跳转。</p>
</li>
</ol>
<p>而根据时间节省还是空间节省为第一目标，算法会有差别巨大的不同实现。</p>
<h4 id="_18">时间节省版本<a class="headerlink" href="#_18" title="Permanent link">&para;</a></h4>
<details class="note" open="open">
<summary>实现</summary>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Rust</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span>
<span class="normal"><a href="#__codelineno-5-12">12</a></span>
<span class="normal"><a href="#__codelineno-5-13">13</a></span>
<span class="normal"><a href="#__codelineno-5-14">14</a></span>
<span class="normal"><a href="#__codelineno-5-15">15</a></span>
<span class="normal"><a href="#__codelineno-5-16">16</a></span>
<span class="normal"><a href="#__codelineno-5-17">17</a></span>
<span class="normal"><a href="#__codelineno-5-18">18</a></span>
<span class="normal"><a href="#__codelineno-5-19">19</a></span>
<span class="normal"><a href="#__codelineno-5-20">20</a></span>
<span class="normal"><a href="#__codelineno-5-21">21</a></span>
<span class="normal"><a href="#__codelineno-5-22">22</a></span>
<span class="normal"><a href="#__codelineno-5-23">23</a></span>
<span class="normal"><a href="#__codelineno-5-24">24</a></span>
<span class="normal"><a href="#__codelineno-5-25">25</a></span>
<span class="normal"><a href="#__codelineno-5-26">26</a></span>
<span class="normal"><a href="#__codelineno-5-27">27</a></span>
<span class="normal"><a href="#__codelineno-5-28">28</a></span>
<span class="normal"><a href="#__codelineno-5-29">29</a></span>
<span class="normal"><a href="#__codelineno-5-30">30</a></span>
<span class="normal"><a href="#__codelineno-5-31">31</a></span>
<span class="normal"><a href="#__codelineno-5-32">32</a></span>
<span class="normal"><a href="#__codelineno-5-33">33</a></span>
<span class="normal"><a href="#__codelineno-5-34">34</a></span>
<span class="normal"><a href="#__codelineno-5-35">35</a></span>
<span class="normal"><a href="#__codelineno-5-36">36</a></span>
<span class="normal"><a href="#__codelineno-5-37">37</a></span>
<span class="normal"><a href="#__codelineno-5-38">38</a></span>
<span class="normal"><a href="#__codelineno-5-39">39</a></span>
<span class="normal"><a href="#__codelineno-5-40">40</a></span>
<span class="normal"><a href="#__codelineno-5-41">41</a></span>
<span class="normal"><a href="#__codelineno-5-42">42</a></span>
<span class="normal"><a href="#__codelineno-5-43">43</a></span>
<span class="normal"><a href="#__codelineno-5-44">44</a></span>
<span class="normal"><a href="#__codelineno-5-45">45</a></span>
<span class="normal"><a href="#__codelineno-5-46">46</a></span>
<span class="normal"><a href="#__codelineno-5-47">47</a></span>
<span class="normal"><a href="#__codelineno-5-48">48</a></span>
<span class="normal"><a href="#__codelineno-5-49">49</a></span>
<span class="normal"><a href="#__codelineno-5-50">50</a></span>
<span class="normal"><a href="#__codelineno-5-51">51</a></span>
<span class="normal"><a href="#__codelineno-5-52">52</a></span>
<span class="normal"><a href="#__codelineno-5-53">53</a></span>
<span class="normal"><a href="#__codelineno-5-54">54</a></span>
<span class="normal"><a href="#__codelineno-5-55">55</a></span>
<span class="normal"><a href="#__codelineno-5-56">56</a></span>
<span class="normal"><a href="#__codelineno-5-57">57</a></span>
<span class="normal"><a href="#__codelineno-5-58">58</a></span>
<span class="normal"><a href="#__codelineno-5-59">59</a></span>
<span class="normal"><a href="#__codelineno-5-60">60</a></span>
<span class="normal"><a href="#__codelineno-5-61">61</a></span>
<span class="normal"><a href="#__codelineno-5-62">62</a></span>
<span class="normal"><a href="#__codelineno-5-63">63</a></span>
<span class="normal"><a href="#__codelineno-5-64">64</a></span>
<span class="normal"><a href="#__codelineno-5-65">65</a></span>
<span class="normal"><a href="#__codelineno-5-66">66</a></span>
<span class="normal"><a href="#__codelineno-5-67">67</a></span>
<span class="normal"><a href="#__codelineno-5-68">68</a></span>
<span class="normal"><a href="#__codelineno-5-69">69</a></span>
<span class="normal"><a href="#__codelineno-5-70">70</a></span>
<span class="normal"><a href="#__codelineno-5-71">71</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">B5STimePattern</span><span class="o">&lt;&#39;</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="w">    </span><span class="n">pat_bytes</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="o">&#39;</span><span class="na">a</span><span class="w"> </span><span class="p">[</span><span class="kt">u8</span><span class="p">],</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="w">    </span><span class="n">alphabet</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="kt">bool</span><span class="p">;</span><span class="mi">256</span><span class="p">],</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="w">    </span><span class="n">bm_bc</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="kt">usize</span><span class="p">;</span><span class="mi">256</span><span class="p">],</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="w">    </span><span class="n">k</span><span class="p">:</span><span class="w"> </span><span class="kt">usize</span>
<a id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="p">}</span>
<a id="__codelineno-5-7" name="__codelineno-5-7"></a>
<a id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="k">impl</span><span class="o">&lt;&#39;</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="n">B5STimePattern</span><span class="o">&lt;&#39;</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">new</span><span class="p">(</span><span class="n">pat</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="o">&#39;</span><span class="na">a</span><span class="w"> </span><span class="kt">str</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">Self</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-10" name="__codelineno-5-10"></a><span class="w">        </span><span class="fm">assert_ne!</span><span class="p">(</span><span class="n">pat</span><span class="p">.</span><span class="n">len</span><span class="p">(),</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-5-11" name="__codelineno-5-11"></a>
<a id="__codelineno-5-12" name="__codelineno-5-12"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">pat_bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pat</span><span class="p">.</span><span class="n">as_bytes</span><span class="p">();</span>
<a id="__codelineno-5-13" name="__codelineno-5-13"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">alphabet</span><span class="p">,</span><span class="w"> </span><span class="n">bm_bc</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B5STimePattern</span><span class="p">::</span><span class="n">build</span><span class="p">(</span><span class="n">pat_bytes</span><span class="p">);</span>
<a id="__codelineno-5-14" name="__codelineno-5-14"></a>
<a id="__codelineno-5-15" name="__codelineno-5-15"></a><span class="w">        </span><span class="n">B5STimePattern</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">pat_bytes</span><span class="p">,</span><span class="w"> </span><span class="n">alphabet</span><span class="p">,</span><span class="w"> </span><span class="n">bm_bc</span><span class="p">,</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-5-16" name="__codelineno-5-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-5-17" name="__codelineno-5-17"></a>
<a id="__codelineno-5-18" name="__codelineno-5-18"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="n">p</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="o">&#39;</span><span class="na">a</span><span class="w"> </span><span class="p">[</span><span class="kt">u8</span><span class="p">])</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="p">([</span><span class="kt">bool</span><span class="p">;</span><span class="mi">256</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="kt">usize</span><span class="p">;</span><span class="mi">256</span><span class="p">],</span><span class="w"> </span><span class="kt">usize</span><span class="p">)</span><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-5-19" name="__codelineno-5-19"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">alphabet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="kc">false</span><span class="p">;</span><span class="mi">256</span><span class="p">];</span>
<a id="__codelineno-5-20" name="__codelineno-5-20"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">bm_bc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="n">p</span><span class="p">.</span><span class="n">len</span><span class="p">();</span><span class="w"> </span><span class="mi">256</span><span class="p">];</span>
<a id="__codelineno-5-21" name="__codelineno-5-21"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">lastpos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">len</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-5-22" name="__codelineno-5-22"></a>
<a id="__codelineno-5-23" name="__codelineno-5-23"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="n">lastpos</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-24" name="__codelineno-5-24"></a><span class="w">            </span><span class="n">alphabet</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">usize</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<a id="__codelineno-5-25" name="__codelineno-5-25"></a><span class="w">            </span><span class="n">bm_bc</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">usize</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lastpos</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<a id="__codelineno-5-26" name="__codelineno-5-26"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-5-27" name="__codelineno-5-27"></a>
<a id="__codelineno-5-28" name="__codelineno-5-28"></a><span class="w">        </span><span class="n">alphabet</span><span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="n">lastpos</span><span class="p">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">usize</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
<a id="__codelineno-5-29" name="__codelineno-5-29"></a>
<a id="__codelineno-5-30" name="__codelineno-5-30"></a><span class="w">        </span><span class="p">(</span><span class="n">alphabet</span><span class="p">,</span><span class="w"> </span><span class="n">bm_bc</span><span class="p">,</span><span class="w"> </span><span class="n">compute_k</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
<a id="__codelineno-5-31" name="__codelineno-5-31"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-5-32" name="__codelineno-5-32"></a>
<a id="__codelineno-5-33" name="__codelineno-5-33"></a><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">find_all</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="kt">str</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="kt">usize</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-34" name="__codelineno-5-34"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[];</span>
<a id="__codelineno-5-35" name="__codelineno-5-35"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">string_bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">string</span><span class="p">.</span><span class="n">as_bytes</span><span class="p">();</span>
<a id="__codelineno-5-36" name="__codelineno-5-36"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">pat_last_pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">pat_bytes</span><span class="p">.</span><span class="n">len</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-5-37" name="__codelineno-5-37"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">patlen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">pat_bytes</span><span class="p">.</span><span class="n">len</span><span class="p">();</span>
<a id="__codelineno-5-38" name="__codelineno-5-38"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">stringlen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">string_bytes</span><span class="p">.</span><span class="n">len</span><span class="p">();</span>
<a id="__codelineno-5-39" name="__codelineno-5-39"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">string_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pat_last_pos</span><span class="p">;</span>
<a id="__codelineno-5-40" name="__codelineno-5-40"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pat_last_pos</span><span class="p">;</span>
<a id="__codelineno-5-41" name="__codelineno-5-41"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">offset0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">k</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-5-42" name="__codelineno-5-42"></a>
<a id="__codelineno-5-43" name="__codelineno-5-43"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="n">string_index</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">stringlen</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-44" name="__codelineno-5-44"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">string_bytes</span><span class="p">[</span><span class="n">string_index</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">pat_bytes</span><span class="p">[</span><span class="n">pat_last_pos</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-45" name="__codelineno-5-45"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="o">&amp;</span><span class="n">string_bytes</span><span class="p">[</span><span class="n">string_index</span><span class="o">-</span><span class="n">offset</span><span class="o">..</span><span class="n">string_index</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="n">pat_bytes</span><span class="p">[</span><span class="n">pat_last_pos</span><span class="o">-</span><span class="n">offset</span><span class="o">..</span><span class="n">pat_last_pos</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-46" name="__codelineno-5-46"></a><span class="w">                    </span><span class="n">result</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">string_index</span><span class="o">-</span><span class="n">pat_last_pos</span><span class="p">);</span>
<a id="__codelineno-5-47" name="__codelineno-5-47"></a>
<a id="__codelineno-5-48" name="__codelineno-5-48"></a><span class="w">                    </span><span class="n">offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">offset0</span><span class="p">;</span>
<a id="__codelineno-5-49" name="__codelineno-5-49"></a>
<a id="__codelineno-5-50" name="__codelineno-5-50"></a><span class="w">                    </span><span class="c1">// Galil rule</span>
<a id="__codelineno-5-51" name="__codelineno-5-51"></a><span class="w">                    </span><span class="n">string_index</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">k</span><span class="p">;</span>
<a id="__codelineno-5-52" name="__codelineno-5-52"></a><span class="w">                    </span><span class="k">continue</span><span class="p">;</span>
<a id="__codelineno-5-53" name="__codelineno-5-53"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-5-54" name="__codelineno-5-54"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-5-55" name="__codelineno-5-55"></a>
<a id="__codelineno-5-56" name="__codelineno-5-56"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">string_index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">stringlen</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-57" name="__codelineno-5-57"></a><span class="w">                </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-5-58" name="__codelineno-5-58"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-5-59" name="__codelineno-5-59"></a>
<a id="__codelineno-5-60" name="__codelineno-5-60"></a><span class="w">            </span><span class="n">offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pat_last_pos</span><span class="p">;</span>
<a id="__codelineno-5-61" name="__codelineno-5-61"></a>
<a id="__codelineno-5-62" name="__codelineno-5-62"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">!</span><span class="bp">self</span><span class="p">.</span><span class="n">alphabet</span><span class="p">[</span><span class="n">string_bytes</span><span class="p">[</span><span class="n">string_index</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">usize</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-63" name="__codelineno-5-63"></a><span class="w">                </span><span class="n">string_index</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">patlen</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">  </span><span class="c1">// sunday</span>
<a id="__codelineno-5-64" name="__codelineno-5-64"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-65" name="__codelineno-5-65"></a><span class="w">                </span><span class="n">string_index</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">bm_bc</span><span class="p">[</span><span class="n">string_bytes</span><span class="p">[</span><span class="n">string_index</span><span class="p">]</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="kt">usize</span><span class="p">];</span><span class="w">  </span><span class="c1">// horspool</span>
<a id="__codelineno-5-66" name="__codelineno-5-66"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-5-67" name="__codelineno-5-67"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-5-68" name="__codelineno-5-68"></a>
<a id="__codelineno-5-69" name="__codelineno-5-69"></a><span class="w">        </span><span class="n">result</span>
<a id="__codelineno-5-70" name="__codelineno-5-70"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-5-71" name="__codelineno-5-71"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</details>
<p>该版本的 B5S 性能表现非常理想，在目前介绍的后缀匹配系列算法中是通常情况下是最快的。</p>
<h4 id="_19">空间节省版本<a class="headerlink" href="#_19" title="Permanent link">&para;</a></h4>
<p>同样在 CPython <code>stringlib</code> 中实现，使用了两个整数近似取代了字符表和 <span class="arithmatex">\(delta_1\)</span> 的作用，极大地节省了空间：</p>
<ol>
<li>
<p>用一个简单的 Bloom 过滤器取代字符表（alphabet）</p>
<details class="note" open="open">
<summary>实现</summary>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Rust</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span>
<span class="normal"><a href="#__codelineno-6-11">11</a></span>
<span class="normal"><a href="#__codelineno-6-12">12</a></span>
<span class="normal"><a href="#__codelineno-6-13">13</a></span>
<span class="normal"><a href="#__codelineno-6-14">14</a></span>
<span class="normal"><a href="#__codelineno-6-15">15</a></span>
<span class="normal"><a href="#__codelineno-6-16">16</a></span>
<span class="normal"><a href="#__codelineno-6-17">17</a></span>
<span class="normal"><a href="#__codelineno-6-18">18</a></span>
<span class="normal"><a href="#__codelineno-6-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">BytesBloomFilter</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="w">    </span><span class="n">mask</span><span class="p">:</span><span class="w"> </span><span class="kt">u64</span><span class="p">,</span>
<a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="p">}</span>
<a id="__codelineno-6-4" name="__codelineno-6-4"></a>
<a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="k">impl</span><span class="w"> </span><span class="n">BytesBloomFilter</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">new</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">Self</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="w">        </span><span class="n">SimpleBloomFilter</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="w">            </span><span class="n">mask</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-11" name="__codelineno-6-11"></a>
<a id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">insert</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">byte</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="kt">u8</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-13" name="__codelineno-6-13"></a><span class="w">        </span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">mask</span><span class="p">)</span><span class="w"> </span><span class="o">|=</span><span class="w"> </span><span class="mi">1</span><span class="k">u64</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">byte</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">63</span><span class="p">);</span>
<a id="__codelineno-6-14" name="__codelineno-6-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-15" name="__codelineno-6-15"></a>
<a id="__codelineno-6-16" name="__codelineno-6-16"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">contains</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="kt">u8</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-17" name="__codelineno-6-17"></a><span class="w">        </span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">mask</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="k">u64</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">(</span><span class="n">byte</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mi">63</span><span class="p">)))</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span>
<a id="__codelineno-6-18" name="__codelineno-6-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-19" name="__codelineno-6-19"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</details>
<p>Bloom 过滤器设设计通过牺牲准确率（实际还有运行时间）来极大地节省存储空间的 <code>Set</code> 类型的数据结构，它的特点是会将集合中不存在的项误判为存在（False Positives，简称 FP），但不会把集合中存在的项判断为不存在（False Negatives，简称 FN），因此使用它可能会因为 FP 而没有得到最大的字符跳转，但不会因为 FN 而跳过本应匹配的字符。</p>
<p>理论上分析，上述「Bloom 过滤器」的实现在 <span class="arithmatex">\(pat\)</span> 长度在 50 个 Bytes 时，FP 概率约为 0.5，而 <span class="arithmatex">\(pat\)</span> 长度在 10 个 Bytes 时，FP 概率约为 0.15。</p>
<p>虽然这不是一个标准的 Bloom 过滤器，首先它实际上没有使用一个真正的哈希函数，实际上它只是一个字符映射，将 0-255 的字节映射为它的前六位构成的数。</p>
<p>但考虑到我们在内存上的进行字符搜索，这种简化就非常重要，即使用目前已知最快的非加密哈希算法 <a href="https://cyan4973.github.io/xxHash/">xxHash</a>，计算所需要的时间仍比它高一个数量级。</p>
<p>另外当 pat 在 30 字节以下时，为了达到最佳的 FP 概率，需要不止一个哈希函数。但这么做意义不大，因为用装有两个 <code>u128</code> 数字的数组就已经可以构建字符表的全字符集。</p>
</li>
<li>
<p>使用 <span class="arithmatex">\(delta_1(pat[patlastpos])\)</span> 代替整个 <span class="arithmatex">\(delta_1\)</span></p>
<p>观察 <span class="arithmatex">\(delta_1\)</span>，最常使用处就是后缀匹配时第一个字符就不匹配是最常见的不匹配的情况，于是令 <code>skip = delta1(pat[patlastpos])</code>，</p>
<p>在第一阶段不匹配时，直接向下滑动 <code>skip</code> 个字符；但当第二阶段不配时，因为缺乏整个 <span class="arithmatex">\(delta_1\)</span> 的信息，只能向下滑动一个字符。</p>
<details class="note" open="open">
<summary>实现</summary>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Rust</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span>
<span class="normal"><a href="#__codelineno-7-11">11</a></span>
<span class="normal"><a href="#__codelineno-7-12">12</a></span>
<span class="normal"><a href="#__codelineno-7-13">13</a></span>
<span class="normal"><a href="#__codelineno-7-14">14</a></span>
<span class="normal"><a href="#__codelineno-7-15">15</a></span>
<span class="normal"><a href="#__codelineno-7-16">16</a></span>
<span class="normal"><a href="#__codelineno-7-17">17</a></span>
<span class="normal"><a href="#__codelineno-7-18">18</a></span>
<span class="normal"><a href="#__codelineno-7-19">19</a></span>
<span class="normal"><a href="#__codelineno-7-20">20</a></span>
<span class="normal"><a href="#__codelineno-7-21">21</a></span>
<span class="normal"><a href="#__codelineno-7-22">22</a></span>
<span class="normal"><a href="#__codelineno-7-23">23</a></span>
<span class="normal"><a href="#__codelineno-7-24">24</a></span>
<span class="normal"><a href="#__codelineno-7-25">25</a></span>
<span class="normal"><a href="#__codelineno-7-26">26</a></span>
<span class="normal"><a href="#__codelineno-7-27">27</a></span>
<span class="normal"><a href="#__codelineno-7-28">28</a></span>
<span class="normal"><a href="#__codelineno-7-29">29</a></span>
<span class="normal"><a href="#__codelineno-7-30">30</a></span>
<span class="normal"><a href="#__codelineno-7-31">31</a></span>
<span class="normal"><a href="#__codelineno-7-32">32</a></span>
<span class="normal"><a href="#__codelineno-7-33">33</a></span>
<span class="normal"><a href="#__codelineno-7-34">34</a></span>
<span class="normal"><a href="#__codelineno-7-35">35</a></span>
<span class="normal"><a href="#__codelineno-7-36">36</a></span>
<span class="normal"><a href="#__codelineno-7-37">37</a></span>
<span class="normal"><a href="#__codelineno-7-38">38</a></span>
<span class="normal"><a href="#__codelineno-7-39">39</a></span>
<span class="normal"><a href="#__codelineno-7-40">40</a></span>
<span class="normal"><a href="#__codelineno-7-41">41</a></span>
<span class="normal"><a href="#__codelineno-7-42">42</a></span>
<span class="normal"><a href="#__codelineno-7-43">43</a></span>
<span class="normal"><a href="#__codelineno-7-44">44</a></span>
<span class="normal"><a href="#__codelineno-7-45">45</a></span>
<span class="normal"><a href="#__codelineno-7-46">46</a></span>
<span class="normal"><a href="#__codelineno-7-47">47</a></span>
<span class="normal"><a href="#__codelineno-7-48">48</a></span>
<span class="normal"><a href="#__codelineno-7-49">49</a></span>
<span class="normal"><a href="#__codelineno-7-50">50</a></span>
<span class="normal"><a href="#__codelineno-7-51">51</a></span>
<span class="normal"><a href="#__codelineno-7-52">52</a></span>
<span class="normal"><a href="#__codelineno-7-53">53</a></span>
<span class="normal"><a href="#__codelineno-7-54">54</a></span>
<span class="normal"><a href="#__codelineno-7-55">55</a></span>
<span class="normal"><a href="#__codelineno-7-56">56</a></span>
<span class="normal"><a href="#__codelineno-7-57">57</a></span>
<span class="normal"><a href="#__codelineno-7-58">58</a></span>
<span class="normal"><a href="#__codelineno-7-59">59</a></span>
<span class="normal"><a href="#__codelineno-7-60">60</a></span>
<span class="normal"><a href="#__codelineno-7-61">61</a></span>
<span class="normal"><a href="#__codelineno-7-62">62</a></span>
<span class="normal"><a href="#__codelineno-7-63">63</a></span>
<span class="normal"><a href="#__codelineno-7-64">64</a></span>
<span class="normal"><a href="#__codelineno-7-65">65</a></span>
<span class="normal"><a href="#__codelineno-7-66">66</a></span>
<span class="normal"><a href="#__codelineno-7-67">67</a></span>
<span class="normal"><a href="#__codelineno-7-68">68</a></span>
<span class="normal"><a href="#__codelineno-7-69">69</a></span>
<span class="normal"><a href="#__codelineno-7-70">70</a></span>
<span class="normal"><a href="#__codelineno-7-71">71</a></span>
<span class="normal"><a href="#__codelineno-7-72">72</a></span>
<span class="normal"><a href="#__codelineno-7-73">73</a></span>
<span class="normal"><a href="#__codelineno-7-74">74</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">B5SSpacePattern</span><span class="o">&lt;&#39;</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="w">    </span><span class="n">pat_bytes</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="o">&#39;</span><span class="na">a</span><span class="w"> </span><span class="p">[</span><span class="kt">u8</span><span class="p">],</span>
<a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="w">    </span><span class="n">alphabet</span><span class="p">:</span><span class="w"> </span><span class="nc">BytesBloomFilter</span><span class="p">,</span>
<a id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="w">    </span><span class="n">skip</span><span class="p">:</span><span class="w"> </span><span class="kt">usize</span><span class="p">,</span>
<a id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="p">}</span>
<a id="__codelineno-7-6" name="__codelineno-7-6"></a>
<a id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="k">impl</span><span class="o">&lt;&#39;</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="n">B5SSpacePattern</span><span class="o">&lt;&#39;</span><span class="na">a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">new</span><span class="p">(</span><span class="n">pat</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="o">&#39;</span><span class="na">a</span><span class="w"> </span><span class="kt">str</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">Self</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-9" name="__codelineno-7-9"></a><span class="w">        </span><span class="fm">assert_ne!</span><span class="p">(</span><span class="n">pat</span><span class="p">.</span><span class="n">len</span><span class="p">(),</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-7-10" name="__codelineno-7-10"></a>
<a id="__codelineno-7-11" name="__codelineno-7-11"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">pat_bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pat</span><span class="p">.</span><span class="n">as_bytes</span><span class="p">();</span>
<a id="__codelineno-7-12" name="__codelineno-7-12"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="p">(</span><span class="n">alphabet</span><span class="p">,</span><span class="w"> </span><span class="n">skip</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">B5SSpacePattern</span><span class="p">::</span><span class="n">build</span><span class="p">(</span><span class="n">pat_bytes</span><span class="p">);</span>
<a id="__codelineno-7-13" name="__codelineno-7-13"></a>
<a id="__codelineno-7-14" name="__codelineno-7-14"></a><span class="w">        </span><span class="n">B5SSpacePattern</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">pat_bytes</span><span class="p">,</span><span class="w"> </span><span class="n">alphabet</span><span class="p">,</span><span class="w"> </span><span class="n">skip</span><span class="p">}</span>
<a id="__codelineno-7-15" name="__codelineno-7-15"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-7-16" name="__codelineno-7-16"></a>
<a id="__codelineno-7-17" name="__codelineno-7-17"></a><span class="w">    </span><span class="k">fn</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="n">p</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="o">&#39;</span><span class="na">a</span><span class="w"> </span><span class="p">[</span><span class="kt">u8</span><span class="p">])</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">BytesBloomFilter</span><span class="p">,</span><span class="w"> </span><span class="kt">usize</span><span class="p">)</span><span class="w">  </span><span class="p">{</span>
<a id="__codelineno-7-18" name="__codelineno-7-18"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">alphabet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BytesBloomFilter</span><span class="p">::</span><span class="n">new</span><span class="p">();</span>
<a id="__codelineno-7-19" name="__codelineno-7-19"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">lastpos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">len</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-7-20" name="__codelineno-7-20"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">skip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p</span><span class="p">.</span><span class="n">len</span><span class="p">();</span>
<a id="__codelineno-7-21" name="__codelineno-7-21"></a>
<a id="__codelineno-7-22" name="__codelineno-7-22"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="mi">0</span><span class="o">..</span><span class="n">p</span><span class="p">.</span><span class="n">len</span><span class="p">()</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-23" name="__codelineno-7-23"></a><span class="w">            </span><span class="n">alphabet</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="o">&amp;</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
<a id="__codelineno-7-24" name="__codelineno-7-24"></a>
<a id="__codelineno-7-25" name="__codelineno-7-25"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">p</span><span class="p">[</span><span class="n">lastpos</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-26" name="__codelineno-7-26"></a><span class="w">                </span><span class="n">skip</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">lastpos</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
<a id="__codelineno-7-27" name="__codelineno-7-27"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-7-28" name="__codelineno-7-28"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-7-29" name="__codelineno-7-29"></a>
<a id="__codelineno-7-30" name="__codelineno-7-30"></a><span class="w">        </span><span class="n">alphabet</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="o">&amp;</span><span class="n">p</span><span class="p">[</span><span class="n">lastpos</span><span class="p">]);</span>
<a id="__codelineno-7-31" name="__codelineno-7-31"></a>
<a id="__codelineno-7-32" name="__codelineno-7-32"></a><span class="w">        </span><span class="p">(</span><span class="n">alphabet</span><span class="p">,</span><span class="w"> </span><span class="n">skip</span><span class="p">)</span>
<a id="__codelineno-7-33" name="__codelineno-7-33"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-7-34" name="__codelineno-7-34"></a>
<a id="__codelineno-7-35" name="__codelineno-7-35"></a><span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="nf">find_all</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">string</span><span class="p">:</span><span class="w"> </span><span class="kp">&amp;</span><span class="o">&#39;</span><span class="na">a</span><span class="w"> </span><span class="kt">str</span><span class="p">)</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nb">Vec</span><span class="o">&lt;</span><span class="kt">usize</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-36" name="__codelineno-7-36"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[];</span>
<a id="__codelineno-7-37" name="__codelineno-7-37"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">string_bytes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">string</span><span class="p">.</span><span class="n">as_bytes</span><span class="p">();</span>
<a id="__codelineno-7-38" name="__codelineno-7-38"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">pat_last_pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">pat_bytes</span><span class="p">.</span><span class="n">len</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-7-39" name="__codelineno-7-39"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">patlen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">pat_bytes</span><span class="p">.</span><span class="n">len</span><span class="p">();</span>
<a id="__codelineno-7-40" name="__codelineno-7-40"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="n">stringlen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">string_bytes</span><span class="p">.</span><span class="n">len</span><span class="p">();</span>
<a id="__codelineno-7-41" name="__codelineno-7-41"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="k">mut</span><span class="w"> </span><span class="n">string_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pat_last_pos</span><span class="p">;</span>
<a id="__codelineno-7-42" name="__codelineno-7-42"></a>
<a id="__codelineno-7-43" name="__codelineno-7-43"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="n">string_index</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">stringlen</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-44" name="__codelineno-7-44"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">string_bytes</span><span class="p">[</span><span class="n">string_index</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">pat_bytes</span><span class="p">[</span><span class="n">pat_last_pos</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-45" name="__codelineno-7-45"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="o">&amp;</span><span class="n">string_bytes</span><span class="p">[</span><span class="n">string_index</span><span class="o">-</span><span class="n">pat_last_pos</span><span class="o">..</span><span class="n">string_index</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="n">pat_bytes</span><span class="p">[</span><span class="o">..</span><span class="n">patlen</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-46" name="__codelineno-7-46"></a><span class="w">                    </span><span class="n">result</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">string_index</span><span class="o">-</span><span class="n">pat_last_pos</span><span class="p">);</span>
<a id="__codelineno-7-47" name="__codelineno-7-47"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-7-48" name="__codelineno-7-48"></a>
<a id="__codelineno-7-49" name="__codelineno-7-49"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">string_index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">stringlen</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-50" name="__codelineno-7-50"></a><span class="w">                    </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-7-51" name="__codelineno-7-51"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-7-52" name="__codelineno-7-52"></a>
<a id="__codelineno-7-53" name="__codelineno-7-53"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="o">!</span><span class="bp">self</span><span class="p">.</span><span class="n">alphabet</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="o">&amp;</span><span class="n">string_bytes</span><span class="p">[</span><span class="n">string_index</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-54" name="__codelineno-7-54"></a><span class="w">                    </span><span class="n">string_index</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">patlen</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">  </span><span class="c1">// sunday</span>
<a id="__codelineno-7-55" name="__codelineno-7-55"></a><span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-56" name="__codelineno-7-56"></a><span class="w">                    </span><span class="n">string_index</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="bp">self</span><span class="p">.</span><span class="n">skip</span><span class="p">;</span><span class="w">  </span><span class="c1">// horspool</span>
<a id="__codelineno-7-57" name="__codelineno-7-57"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-7-58" name="__codelineno-7-58"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-59" name="__codelineno-7-59"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">string_index</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">stringlen</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-60" name="__codelineno-7-60"></a><span class="w">                    </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-7-61" name="__codelineno-7-61"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-7-62" name="__codelineno-7-62"></a>
<a id="__codelineno-7-63" name="__codelineno-7-63"></a><span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="o">!</span><span class="bp">self</span><span class="p">.</span><span class="n">alphabet</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="o">&amp;</span><span class="n">string_bytes</span><span class="p">[</span><span class="n">string_index</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-64" name="__codelineno-7-64"></a><span class="w">                    </span><span class="n">string_index</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">patlen</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w">  </span><span class="c1">// sunday</span>
<a id="__codelineno-7-65" name="__codelineno-7-65"></a><span class="w">                </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-66" name="__codelineno-7-66"></a><span class="w">                    </span><span class="n">string_index</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="__codelineno-7-67" name="__codelineno-7-67"></a><span class="w">                </span><span class="p">}</span>
<a id="__codelineno-7-68" name="__codelineno-7-68"></a><span class="w">            </span><span class="p">}</span>
<a id="__codelineno-7-69" name="__codelineno-7-69"></a>
<a id="__codelineno-7-70" name="__codelineno-7-70"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-7-71" name="__codelineno-7-71"></a>
<a id="__codelineno-7-72" name="__codelineno-7-72"></a><span class="w">        </span><span class="n">result</span>
<a id="__codelineno-7-73" name="__codelineno-7-73"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-7-74" name="__codelineno-7-74"></a><span class="p">}</span>
</code></pre></div></td></tr></table></div>
</details>
<p>这个版本的算法相较于前面的后缀匹配算法不够快，但差距不大，性能仍然优于 KMP，得益于它至多两个 <code>u64</code> 的整数的优秀空间复杂度。</p>
</li>
</ol>
<h2 id="_20">理论分析<a class="headerlink" href="#_20" title="Permanent link">&para;</a></h2>
<p>以下是一般字符集下各算法的表现，纵坐标类似于执行开销（cost 指匹配成功 m 个字符后失配时的代价，skip 指发生失配时向下滑动 k 个字符的概率），越小性能越好。横坐标为模式字符串 pat 的长度：</p>
<p><img alt="字符串搜索算法性能对比图" src="../images/BM/plot256.svg" /></p>
<p>在较小字符集（DNA {A, C, T, G} 碱基对序列）中的表现：</p>
<p><img alt="小字符集下字符串搜索算法性能对比图" src="../images/BM/plot4.svg" /></p>
<p>综上，在较大的字符集，比如日常搜索的过程中，BoyerMoore 系列算法的优越表现，其中主要依赖 <span class="arithmatex">\(delta_1\)</span> 表实现字符跳转；</p>
<p>另一方面，在较小的字符集里，<span class="arithmatex">\(delta_1\)</span> 的作用下降，而 <span class="arithmatex">\(delta_2\)</span> 的作用得到了体现。</p>
<p>如果有一定富裕空间的情况下，完整的空间复杂度为 <span class="arithmatex">\(O(m)\)</span> 的 BoyerMoore 算法更加通用，综合表现最优。</p>
<h2 id="_21">参考资料与注释<a class="headerlink" href="#_21" title="Permanent link">&para;</a></h2>
<div class="footnote">
<hr />
<ol>
<li id="fn:bm">
<p><a href="https://dl.acm.org/doi/10.1145/359842.359859">1977 年 Boyer–Moore 算法论文</a>&#160;<a class="footnote-backref" href="#fnref:bm" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:kmp">
<p><a href="https://epubs.siam.org/doi/abs/10.1137/0206024">1977 年 KMP 算法论文</a>&#160;<a class="footnote-backref" href="#fnref:kmp" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:rytter">
<p><a href="https://epubs.siam.org/doi/10.1137/0209037">1980 年 Rytter 纠正 Knuth 的论文</a>&#160;<a class="footnote-backref" href="#fnref:rytter" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
<li id="fn:galil-rule">
<p><a href="https://doi.org/10.1145%2F359146.359148">1979 年介绍 Galil 算法的论文</a>&#160;<a class="footnote-backref" href="#fnref:galil-rule" title="Jump back to footnote 4 in the text">&#8617;</a></p>
</li>
<li id="fn:b5s">
<p><a href="http://effbot.org/zone/stringlib.htm#BMHBNFS">B5S 算法的介绍</a>&#160;<a class="footnote-backref" href="#fnref:b5s" title="Jump back to footnote 5 in the text">&#8617;</a></p>
</li>
</ol>
</div>
<!--
  Copyright (c) 2016-2023 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Render date of last update -->


<!-- Render date of creation -->


<!-- ---------------------------------------------------------------------- -->

<!-- Render authors -->


<!-- ---------------------------------------------------------------------- -->

<!-- Render committers from GitHub -->


<!-- Render committers from GitLab -->


<!-- Render committers -->


<!-- ---------------------------------------------------------------------- -->

<!-- Determine date of last update -->

  

  <!-- Determine date of creation -->
  


<!-- Source file information -->

<!--
  Copyright (c) 2016-2023 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Determine feedback configuration -->

  


<!-- Determine whether to show feedback -->


<!-- Was this page helpful? -->

  <form class="md-feedback" name="feedback" hidden>
    <fieldset>
      <legend class="md-feedback__title">
        此页面有帮助吗？
      </legend>
      <div class="md-feedback__inner">

        <!-- Feedback ratings -->
        <div class="md-feedback__list">
          
            <button
              class="md-feedback__icon md-icon"
              type="submit"
              title="This page was helpful"
              data-md-value="1"
            >
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M5 9v12H1V9zm4 12a2 2 0 0 1-2-2V9c0-.55.22-1.05.59-1.41L14.17 1l1.06 1.06c.27.27.44.64.44 1.05l-.03.32L14.69 8H21a2 2 0 0 1 2 2v2c0 .26-.05.5-.14.73l-3.02 7.05C19.54 20.5 18.83 21 18 21zm0-2h9.03L21 12v-2h-8.79l1.13-5.32L9 9.03z"/></svg>
            </button>
          
            <button
              class="md-feedback__icon md-icon"
              type="submit"
              title="This page could be improved"
              data-md-value="0"
            >
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 15V3h4v12zM15 3a2 2 0 0 1 2 2v10c0 .55-.22 1.05-.59 1.41L9.83 23l-1.06-1.06c-.27-.27-.44-.64-.44-1.06l.03-.31.95-4.57H3a2 2 0 0 1-2-2v-2c0-.26.05-.5.14-.73l3.02-7.05C4.46 3.5 5.17 3 6 3zm0 2H5.97L3 12v2h8.78l-1.13 5.32L15 14.97z"/></svg>
            </button>
          
        </div>

        <!-- Feedback rating notes (shown after submission) -->
        <div class="md-feedback__note">
          
            <div data-md-value="1" hidden>
              

              <!-- Determine title -->
              
                
              

              <!-- Replace {url} and {title} placeholders in note -->
              谢谢你的反馈！
            </div>
          
            <div data-md-value="0" hidden>
              

              <!-- Determine title -->
              
                
              

              <!-- Replace {url} and {title} placeholders in note -->
              Thanks for your feedback! Help us improve this page by using our <a href="https://marketingplatform.google.com/about/analytics/" target="_blank" rel="noopener">feedback form</a>.
            </div>
          
        </div>
      </div>
    </fieldset>
  </form>

<!--
  Copyright (c) 2016-2023 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Comment system -->





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  回到页面顶部
</button>
        
      </main>
      
        <style>
  .md-footer {
      background-color: #f0f0f0;
  }
</style>


<!-- Footer -->
<footer class="md-footer">

  <!-- Link to previous and/or next page -->
  
    
  

  <!-- Further information -->
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; gzh
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
   
      <font color="#B9B9B9">
      <div class="footer-visit-count" style="display: flex; justify-content: center; align-items: center;color: #000;">
        本站访问量：<script async src="//finicounter.eu.org/finicounter.js"></script>
        <span id="finicount_views"></span>    &nbsp;|&nbsp;
        <footer>
          <a href="https://icp.gov.moe/?keyword=20230640" target="_blank">萌ICP备20230640号</a>
        </footer>
      </div>
      </font>

        <style>
          .footer-visit-count {
              height: fit-content;
              min-height: 55px; /* 根据实际情况调整此高度 */
              color: #000;
          }
          </style>
        
          <div class="md-social">
  
    
    
    
    
    <a href="https://cdn.jsdelivr.net/gh/Gongzihang6/Pictures@main/Medias/%E6%88%91%E7%9A%84%E5%BE%AE%E4%BF%A1%E4%BA%8C%E7%BB%B4%E7%A0%81.png" target="_blank" rel="noopener" title="Wechat" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M385.2 167.6c6.4 0 12.6.3 18.8 1.1C387.4 90.3 303.3 32 207.7 32 100.5 32 13 104.8 13 197.4c0 53.4 29.3 97.5 77.9 131.6l-19.3 58.6 68-34.1c24.4 4.8 43.8 9.7 68.2 9.7 6.2 0 12.1-.3 18.3-.8-4-12.9-6.2-26.6-6.2-40.8-.1-84.9 72.9-154 165.3-154m-104.5-52.9c14.5 0 24.2 9.7 24.2 24.4 0 14.5-9.7 24.2-24.2 24.2-14.8 0-29.3-9.7-29.3-24.2.1-14.7 14.6-24.4 29.3-24.4m-136.4 48.6c-14.5 0-29.3-9.7-29.3-24.2 0-14.8 14.8-24.4 29.3-24.4 14.8 0 24.4 9.7 24.4 24.4 0 14.6-9.6 24.2-24.4 24.2M563 319.4c0-77.9-77.9-141.3-165.4-141.3-92.7 0-165.4 63.4-165.4 141.3S305 460.7 397.6 460.7c19.3 0 38.9-5.1 58.6-9.9l53.4 29.3-14.8-48.6C534 402.1 563 363.2 563 319.4m-219.1-24.5c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.8 0 24.4 9.7 24.4 19.3 0 10-9.7 19.6-24.4 19.6m107.1 0c-9.7 0-19.3-9.7-19.3-19.6 0-9.7 9.7-19.3 19.3-19.3 14.5 0 24.4 9.7 24.4 19.3.1 10-9.9 19.6-24.4 19.6"/></svg>
    </a>
  
    
    
    
    
    <a href="https://t.me/gongzihang" target="_blank" rel="noopener" title="telegram" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M248 8C111.033 8 0 119.033 0 256s111.033 248 248 248 248-111.033 248-248S384.967 8 248 8m114.952 168.66c-3.732 39.215-19.881 134.378-28.1 178.3-3.476 18.584-10.322 24.816-16.948 25.425-14.4 1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25 5.342-39.5 3.652-3.793 67.107-61.51 68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608 69.142-14.845 10.194-26.894 9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7 18.45-13.7 108.446-47.248 144.628-62.3c68.872-28.647 83.183-33.623 92.511-33.789 2.052-.034 6.639.474 9.61 2.885a10.45 10.45 0 0 1 3.53 6.716 43.8 43.8 0 0 1 .417 9.769"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/ZihangGong28792" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M389.2 48h70.6L305.6 224.2 487 464H345L233.7 318.6 106.5 464H35.8l164.9-188.5L26.8 48h145.6l100.5 132.9zm-24.8 373.8h39.1L151.1 88h-42z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/Gongzihang6" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:<zihanggong24@gmail.com>" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M64 112c-8.8 0-16 7.2-16 16v22.1l172.5 141.6c20.7 17 50.4 17 71.1 0L464 150.1V128c0-8.8-7.2-16-16-16zM48 212.2V384c0 8.8 7.2 16 16 16h384c8.8 0 16-7.2 16-16V212.2L322 328.8c-38.4 31.5-93.7 31.5-132 0zM0 128c0-35.3 28.7-64 64-64h384c35.3 0 64 28.7 64 64v256c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://space.bilibili.com/688234000/lists" target="_blank" rel="noopener" title="space.bilibili.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M488.6 104.1c16.7 18.1 24.4 39.7 23.3 65.7v202.4c-.4 26.4-9.2 48.1-26.5 65.1-17.2 17-39.1 25.9-65.5 26.7H92.02c-26.45-.8-48.21-9.8-65.28-27.2C9.682 419.4.767 396.5 0 368.2V169.8c.767-26 9.682-47.6 26.74-65.7C43.81 87.75 65.57 78.77 92.02 78h29.38L96.05 52.19c-5.75-5.73-8.63-13-8.63-21.79 0-8.8 2.88-16.06 8.63-21.797C101.8 2.868 109.1 0 117.9 0q13.2 0 21.9 8.603L213.1 78h88l74.5-69.397C381.7 2.868 389.2 0 398 0q13.2 0 21.9 8.603c5.7 5.737 8.6 12.997 8.6 21.797 0 8.79-2.9 16.06-8.6 21.79L394.6 78h29.3c26.4.77 48 9.75 64.7 26.1m-38.8 69.7c-.4-9.6-3.7-17.4-10.7-23.5-5.2-6.1-14-9.4-22.7-9.8H96.05c-9.59.4-17.45 3.7-23.58 9.8-6.14 6.1-9.4 13.9-9.78 23.5v194.4c0 9.2 3.26 17 9.78 23.5s14.38 9.8 23.58 9.8H416.4c9.2 0 17-3.3 23.3-9.8s9.7-14.3 10.1-23.5zm-264.3 42.7c6.3 6.3 9.7 14.1 10.1 23.2V273c-.4 9.2-3.7 16.9-9.8 23.2-6.2 6.3-14 9.5-23.6 9.5s-17.5-3.2-23.6-9.5-9.4-14-9.8-23.2v-33.3c.4-9.1 3.8-16.9 10.1-23.2s13.2-9.6 23.3-10c9.2.4 17 3.7 23.3 10m191.5 0c6.3 6.3 9.7 14.1 10.1 23.2V273c-.4 9.2-3.7 16.9-9.8 23.2s-14 9.5-23.6 9.5-17.4-3.2-23.6-9.5c-7-6.3-9.4-14-9.7-23.2v-33.3c.3-9.1 3.7-16.9 10-23.2s14.1-9.6 23.3-10c9.2.4 17 3.7 23.3 10"/></svg>
    </a>
  
</div>
        
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            


  


<h4>Cookie consent</h4>
<p>我们也使用cookies来识别您的重复访问和偏好来衡量我们文档的有效性以及用户是否找到他们要找的东西。 如果你同意,你可以帮助我们让我们的网站更好</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
    
      
        
  
  
    
    
  
  <li class="task-list-item">
    <label class="task-list-control">
      <input type="checkbox" name="analytics" checked>
      <span class="task-list-indicator"></span>
      Google Analytics
    </label>
  </li>

      
    
    
      
        
  
  
    
    
  
  <li class="task-list-item">
    <label class="task-list-control">
      <input type="checkbox" name="github" checked>
      <span class="task-list-indicator"></span>
      GitHub
    </label>
  </li>

      
    
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">同意</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">管理设定</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script>
    
    
      
      <script id="__config" type="application/json">{"base": "../../../../../..", "features": ["announce.dismiss", "navigation.tracking", "navigation.tabs", "navigation.sections", "navigation.top", "navigation.footer", "search.suggest", "search.highlight", "search.share", "navigation.expand", "navigation.indexes", "content.tabs.link", "content.tooltips", "content.code.copy", "content.code.select", "content.code.annotate"], "search": "../../../../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}, "version": null}</script>
    
    
      <script src="../../../../../../assets/javascripts/bundle.13a4f30d.min.js"></script>
      
        <script src="../../../../../../javascripts/extra.js"></script>
      
        <script src="../../../../../../javascripts/config_mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="../../../../../../javascripts/简历.js"></script>
      
    
  </body>
</html>